# 1. Project Organization and File Colocation

ë¼ìš°íŒ… í´ë” ë° íŒŒì¼ ê·œì¹™ ì™¸ì—, Next.jsëŠ” í”„ë¡œì íŠ¸ íŒŒì¼ì„ êµ¬ì„±í•˜ê±°ë‚˜ ë°°ì¹˜í•˜ëŠ” ë°©ì‹ì— ëŒ€í•´ íŠ¹ë³„í•œ ì˜ê²¬ì„ ì œì‹œí•˜ì§€ ì•ŠëŠ”ë‹¤.

ì´ íŒŒíŠ¸ëŠ” í”„ë¡œì íŠ¸ë¥¼ êµ¬ì„±í•˜ëŠ”ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ë³¸ ë™ì‘ê³¼ ê¸°ëŠ¥ì„ ê³µìœ í•œë‹¤.

## 1.1 ì•ˆì „í•œ íŒŒì¼ ë°°ì¹˜ (ê¸°ë³¸ ë™ì‘)

`app` ë””ë ‰í† ë¦¬ì•ˆì—, ì¤‘ì²©ëœ í´ë” ê³„ì¸µì´ ë¼ìš°íŠ¸ êµ¬ì¡°ë¥¼ ì •ì˜í•œë‹¤.

ê° í´ë”ë“¤ì€ ë¼ìš°íŠ¸ ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ë‚˜íƒ€ë‚´ë©°, ì´ëŠ” URL ê²½ë¡œì˜ í•´ë‹¹ ì„¸ê·¸ë¨¼íŠ¸ì— ë§¤í•‘ëœë‹¤.

í•˜ì§€ë§Œ, ë¼ìš°íŠ¸ ì„¸ê·¸ë¨¼íŠ¸ëŠ” page.js ë˜ëŠ” route.js íŒŒì¼ì´ ì¶”ê°€ë˜ê¸° ì „ê¹Œì§€ í•´ë‹¹ ë¼ìš°íŠ¸ëŠ” ê³µê°œì ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤.

- ë¼ìš°íŠ¸ê°€ ê³µê°œì ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë ¤ë©´ í•´ë‹¹ ì„¸ê·¸ë¨¼íŠ¸ ì´ë¦„ì˜ í´ë”ì— page.js or route.js íŒŒì¼ ì¡´ì¬í•´ì•¼í•¨.
- ë¼ìš°íŠ¸ê°€ ê³µê°œë˜ì–´ë„, page.js or route.js íŒŒì¼ì´ ë°˜í™˜í•˜ëŠ” ë‚´ìš©ë§Œ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬ë¨.
  - ë‹¤ë¥¸ íŒŒì¼ëª…ì€ ë…¸ì¶œ ì•ˆë¨.

<aside>
ğŸŒŸ

ì•Œì•„ë‘ë©´ ì¢‹ì€ ì 

- pages ë””ë ‰í† ë¦¬ì™€ app ë””ë ‰í† ë¦¬ëŠ” ë‹¤ë¥´ë‹¤. pages ë””ë ‰í† ë¦¬ ë‚´ì˜ ëª¨ë“  íŒŒì¼ì€ ë¼ìš°íŠ¸ë¡œ ê°„ì£¼ëœë‹¤.
- íŒŒì¼ì„ app ë””ë ‰í† ë¦¬ ë‚´ì— ë°°ì¹˜í•  ìˆ˜ëŠ” ìˆìœ¼ë‚˜, ê·¸ë ‡ê²Œ í•´ì•¼ë§Œ í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤. ì›í•œë‹¤ë©´, app ë””ë ‰í† ë¦¬ ë°–ì— ë°°ì¹˜í•  ìˆ˜ë„ ìˆë‹¤.
</aside>

## 1.2 í”„ë¡œì íŠ¸ êµ¬ì¡°í™” ê¸°ëŠ¥

### 1.2.1 ë¹„ê³µê°œ í´ë”

í´ë” ì´ë¦„ ì•ì— `_` ë¥¼ ë¶™ì—¬ ë¹„ê³µê°œ í´ë” ìƒì„±.

ë¼ìš°íŒ… ì‹œìŠ¤í…œì—ì„œ ì œì™¸ë˜ë©°, í•´ë‹¹ í´ë”ì™€ í•˜ìœ„ í´ë”ë“¤ì€ ë¼ìš°íŒ…ì—ì„œ ì œì™¸ëœë‹¤.

- UI ë¡œì§ê³¼ ë¼ìš°íŒ… ë¡œì§ì„ ë¶„ë¦¬í•  ë•Œ
- í”„ë¡œì íŠ¸ ë° Next.js ìƒíƒœê³„ ì „ë°˜ì—ì„œ ë‚´ë¶€ íŒŒì¼ì„ ì¼ê´€ë˜ê²Œ êµ¬ì„±í•  ë•Œ
- ì½”ë“œ ì—ë””í„°ì—ì„œ íŒŒì¼ì„ ì •ë ¬í•˜ê±°ë‚˜ ê·¸ë£¹í™”í•  ë•Œ
- í–¥í›„ Next.js íŒŒì¼ ì»¨ë²¤ì…˜ê³¼ ì ì¬ì  ë„¤ì´ë° ì¶©ëŒ ë°©ì§€

<aside>
ğŸŒŸ

ì•Œì•„ë‘ë©´ ì¢‹ì€ ì 

- í”„ë ˆì„ì›Œí¬ì˜ ê´€ë¡€ëŠ” ì•„ë‹ˆì§€ë§Œ, ë¹„ê³µê°œ í´ë” ì™¸ë¶€ì— ìˆëŠ” íŒŒì¼ë„ ë™ì¼í•œ ë°‘ì¤„(`_`) íŒ¨í„´ì„ ì‚¬ìš©í•˜ì—¬ "ë¹„ê³µê°œ"ë¡œ í‘œì‹œí•˜ëŠ” ê²ƒì„ ê³ ë ¤í•  ìˆ˜ ìˆë‹¤.
- URL ì„¸ê·¸ë¨¼íŠ¸ê°€ ë°‘ì¤„ë¡œ ì‹œì‘í•´ì•¼ í•˜ëŠ” ê²½ìš°, í´ë” ì´ë¦„ì— URL ì¸ì½”ë”©ëœ ê°’ì¸ `%5F`ë¥¼ ë¶™ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. `%5FfolderName`
</aside>

### 1.2.2 ë¼ìš°íŠ¸ ê·¸ë£¹

í´ë” ì´ë¦„ì„ ê´„í˜¸ë¡œ ê°ì‹¸ë©´ ë¼ìš°íŠ¸ ê·¸ë£¹ì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

êµ¬ì¡°ì  ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©ë˜ë©°, ë¼ìš°íŠ¸ì˜ URL ê²½ë¡œì— í¬í•¨ë˜ì§€ ì•ŠìŒì„ ë‚˜íƒ€ë‚¸ë‹¤.

- ì‚¬ì´íŠ¸ ì„¹ì…˜, ì˜ë„, íŒ€ë³„ë¡œ ë¼ìš°íŠ¸ë¥¼ ê·¸ë£¹í™”
- ë™ì¼í•œ ì„¸ê·¸ë¨¼íŠ¸ ë ˆë²¨ ë‚´ì—ì„œ ì¤‘ì²©ëœ ë ˆì´ì•„ì›ƒ ìƒì„±
  - ì—¬ëŸ¬ ì¤‘ì²© ë ˆì´ì•„ì›ƒ ìƒì„±
  - ê³µí†µ ì„¸ê·¸ë¨¼íŠ¸ ë‚´ ì¼ë¶€ ë¼ìœ¼íŠ¸ì— ë ˆì´ì•„ì›ƒ ì¶”ê°€

### 1.2.3 `src` ë””ë ‰í† ë¦¬

Next.jsëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ(`app` ì„ í¬í•¨í•´ì„œ)ë¥¼ ì„ íƒì ìœ¼ë¡œ src ë””ë ‰í† ë¦¬ ì•ˆì— ì €ì¥í•˜ëŠ” ê²ƒì„ ì§€ì›í•œë‹¤.

ì´ëŠ” í”„ë¡œì íŠ¸ ì„¤ì • íŒŒì¼(ì£¼ë¡œ ë£¨íŠ¸ì— ìœ„ì¹˜)ê³¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œë¥¼ ë¶„ë¦¬í•œë‹¤.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/a43c8b7f-e77d-47de-a59c-f74de1fb0eee/354d3a3a-777d-4d9b-b039-b0c49e0b028c/image.png)

### 1.2.4 module path aliases (ëª¨ë“ˆ ê²½ë¡œ ë³„ì¹­)

Next.jsëŠ” ëª¨ë“ˆ ê²½ë¡œì— ëŒ€í•œ ë³„ì¹­ì„ ì •ì˜í•  ìˆ˜ ìˆì–´, ê¹Šì´ ì¤‘ì²©ëœ íŒŒì¼ ê°„ì˜ importë¥¼ ì½ê³  ìœ ì§€ ê´€ë¦¬í•˜ê¸° ì‰½ê²Œ ë§Œë“ ë‹¤.

## í”„ë¡œì íŠ¸ êµ¬ì¡°í™” ì „ëµ

í”„ë¡œì íŠ¸ íŒŒì¼ê³¼ í´ë”ë¥¼ êµ¬ì„±í•˜ëŠ” ë° ìˆì–´ ì •ë‹µì€ ì—†ë‹¤.

ì¤‘ìš”í•œ ì ì€ íŒ€ê³¼ ìì‹ ì—ê²Œ ì í•©í•œ ì „ëµì„ ì„ íƒí•˜ê³  ì¼ê´€ì„±ì„ ìœ ì§€í•˜ëŠ” ê²ƒì´ë‹¤.

1. app ë””ë ‰í† ë¦¬ ì™¸ë¶€ì— í”„ë¡œì íŠ¸ íŒŒì¼ ì €ì¥

   ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/a43c8b7f-e77d-47de-a59c-f74de1fb0eee/d928a017-c496-4cfb-b795-029b8227d50e/image.png)

- ëª¨ë“  ì½”ë“œë¥¼ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ê³µìœ  í´ë”ë¡œ ì €ì¥í•˜ê³ , app í•˜ìœ„ëŠ” ìˆœì „íˆ ë¼ìš°íŒ… ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©

1. app ë‚´ë¶€ì˜ ìƒìœ„ í´ë”ì— í”„ë¡œì íŠ¸ íŒŒì¼ ì €ì¥

   ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/a43c8b7f-e77d-47de-a59c-f74de1fb0eee/1e88fc21-2db1-45ca-8325-7ff52e55776a/image.png)

   - ëª¨ë“  ì½”ë“œë¥¼ app í´ë” ë‚´ë¶€ì˜ ê³µìœ  í´ë”ì— ì €ì¥

2. ê¸°ëŠ¥ ë˜ëŠ” ë¼ìš°íŠ¸ ë³„ë¡œ í”„ë¡œì íŠ¸ íŒŒì¼ ë¶„ë¦¬

   ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/a43c8b7f-e77d-47de-a59c-f74de1fb0eee/61dff1a8-614f-478f-8d74-af3a902ffdcd/image.png)

   - ì „ì—­ì ìœ¼ë¡œ ê³µìœ ë˜ëŠ” ì½”ë“œëŠ” ë£¨íŠ¸ app í´ë”ì— ì €ì¥í•˜ê³ , ë” êµ¬ì²´ì ì¸ ì½”ë“œëŠ” ì´ë¥¼ ì‚¬ìš©í•˜ëŠ” ë¼ìš°íŠ¸ ì„¸ê·¸ë¨¼íŠ¸ë¡œ ë‚˜ëˆ„ì–´ ì €ì¥

# 2. Dynamic Routes

ë™ì  ë¼ìš°íŒ…ì€ íŠ¹ì • ê²½ë¡œ ì„¸ê·¸ë¨¼íŠ¸ ì´ë¦„ì„ ì•Œ ìˆ˜ ì—†ì„ ë•Œ ì‚¬ìš©í•œë‹¤. ë™ì  ë°ì´í„°ë¡œë¶€í„° ìƒì„±ëœ ê²½ë¡œë¥¼ ìƒì„±í•˜ê³ , ìš”ì²­ ì‹œì ì— ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ì±„ìš°ê±°ë‚˜ ë¹Œë“œ ì‹œì ì— í”„ë¦¬ ë Œë”ë§í•  ìˆ˜ ìˆë‹¤.

## 2.1 ì»¨ë²¤ì…˜

ë™ì  ì„¸ê·¸ë¨¼íŠ¸ëŠ” í´ë” ì´ë¦„ì„ ëŒ€ê´„í˜¸ë¡œ ê°ì‹¸ëŠ” ë°©ì‹ìœ¼ë¡œ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

- [id]
- [slug]

ë™ì  ì„¸ê·¸ë¨¼íŠ¸ëŠ” `layout` , `page`, `route`, ê·¸ë¦¬ê³  `generateMetadata` í•¨ìˆ˜ì— propsë¡œ ì „ë‹¬ëœë‹¤.

### ì˜ˆì‹œ

ë¸”ë¡œê·¸ í”„ë¡œì íŠ¸ë¥¼ ì˜ˆë¡œ ë“¤ë©´, `app/blog/[slug]/page.js` ê²½ë¡œì—ì„œ `[slug]` ëŠ” ë¸”ë¡œê·¸ ê²Œì‹œê¸€ì˜ ë™ì  ì„¸ê·¸ë¨¼íŠ¸ ì—­í• ì„ í•œë‹¤.

```jsx
export default function Page({ params }: { params: { slug: string } }) {
  return <div>My Post: {params.slug}</div>;
}
```

## 2.2 ì •ì  ë§¤ê°œë³€ìˆ˜(Static Params) ìƒì„±

`generateStaticParams` í•¨ìˆ˜ëŠ” ë™ì  ì„¸ê·¸ë¨¼íŠ¸ì™€ í•¨ê»˜ ì‚¬ìš©í•˜ì—¬ ë¹Œë“œ ì‹œì ì— ì •ì  ê²½ë¡œë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

```jsx
// app/blog/[slug]/page.tsx

export async function generateStaticParams() {
  const posts = await fetch("https://.../posts").then((res) => res.json());

  return posts.map((post) => ({
    slug: post.slug,
  }));
}
```

`generateStaticParams` í•¨ìˆ˜ì˜ ì¥ì ì€ fetch ìš”ì²­ì„ í†µí•´ ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ìë™ìœ¼ë¡œ ë©”ëª¨ì´ì œì´ì…˜ í•´ì¤€ë‹¤ëŠ” ê²ƒì´ë‹¤. ë™ì¼í•œ ì¸ìˆ˜ì— ëŒ€í•´ì„œ `generateStaticParams`, layouts, pagesì—ì„œ í˜¸ì¶œë  ê²½ìš° í•œ ë²ˆë§Œ ìš”ì²­ëœë‹¤.

## 2.3 Catch-all Segments

`[...folderName]` ì™€ ê°™ì´ ëŒ€ê´„í˜¸ ë‚´ë¶€ì— ì¤„ì„í‘œ (â€¦)ë¥¼ ì¶”ê°€í•˜ë©´ íŠ¹ì • ì„¸ê·¸ë¨¼íŠ¸ ì´í›„ ëª¨ë“  ê²½ë¡œë¥¼ í¬ì°©í•  ìˆ˜ ìˆë‹¤.

`app/shop/[...slug]/page.js` ëŠ” ì•„ë˜ì™€ ê°™ì€ ê²½ë¡œì™€ ë§¤ì¹­ëœë‹¤.

- `/shop/clothes`
- `/shop/clothes/tops`
- `/shop/clothes/tops/t-shirts` ë“±

| **Route**                    | **Example URL** | **`params`**                |
| ---------------------------- | --------------- | --------------------------- |
| `app/shop/[...slug]/page.js` | `/shop/a`       | `{ slug: ['a'] }`           |
| `app/shop/[...slug]/page.js` | `/shop/a/b`     | `{ slug: ['a', 'b'] }`      |
| `app/shop/[...slug]/page.js` | `/shop/a/b/c`   | `{ slug: ['a', 'b', 'c'] }` |

## 2.4 Optional Catch-all Segments

Catch-All ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ì„ íƒì ìœ¼ë¡œ ë§Œë“¤ë ¤ë©´ ëŒ€ê´„í˜¸ë¥¼ í•œ ë²ˆ ë” ê°ì‹¸ `[[...folderName]]` í˜•íƒœë¡œ ì •ì˜í•œë‹¤.

:`app/shop/[[...slug]]/page.js`ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê²½ë¡œì™€ ë§¤ì¹­ëœë‹¤.

- `/shop`
- `/shop/clothes`
- `/shop/clothes/tops`
- `/shop/clothes/tops/t-shirts`

### ì°¨ì´ì 

- Catch-All: ë§¤ê°œë³€ìˆ˜ê°€ í•„ìš”. (`/shop` ì€ ë§¤ì¹­ë˜ì§€ ì•ŠìŒ)
- Optional Catch-All: ë§¤ê°œë³€ìˆ˜ê°€ ì—†ì–´ë„ ê²½ë¡œê°€ ë§¤ì¹­. (`/shop` í¬í•¨)

| **Route**                      | **Example URL** | **`params`**                |
| ------------------------------ | --------------- | --------------------------- |
| `app/shop/[[...slug]]/page.js` | `/shop`         | `{}`                        |
| `app/shop/[[...slug]]/page.js` | `/shop/a`       | `{ slug: ['a'] }`           |
| `app/shop/[[...slug]]/page.js` | `/shop/a/b`     | `{ slug: ['a', 'b'] }`      |
| `app/shop/[[...slug]]/page.js` | `/shop/a/b/c`   | `{ slug: ['a', 'b', 'c'] }` |

## 2.5 TypeScript

ì„¤ì •í•œ ë¼ìš°íŠ¸ ì„¸ê·¸ë¨¼íŠ¸ì— ë”°ë¼ params íƒ€ì…ì„ ì •ì˜í•œë‹¤.

| **Route**                           | **`params`Â Type Definition**             |
| ----------------------------------- | ---------------------------------------- |
| `app/blog/[slug]/page.js`           | `{ slug: string }`                       |
| `app/shop/[...slug]/page.js`        | `{ slug: string[] }`                     |
| `app/shop/[[...slug]]/page.js`      | `{ slug?: string[] }`                    |
| `app/[categoryId]/[itemId]/page.js` | `{ categoryId: string, itemId: string }` |

# 3. Parallel Routes (ë³‘ë ¬ ë¼ìš°íŠ¸)

ë™ì¼í•œ ë ˆì´ì•„ì›ƒ ë‚´ì—ì„œ í•˜ë‚˜ ì´ìƒì˜ í˜ì´ì§€ë¥¼ ë™ì‹œì— ë˜ëŠ” ì¡°ê±´ë¶€ë¡œ ë Œë”ë§í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.

ëŒ€ì‹œë³´ë“œë‚˜ ì†Œì…œ ì‚¬ì´íŠ¸ì˜ í”¼ë“œì²˜ëŸ¼ ë™ì ìœ¼ë¡œ ë³€í•˜ëŠ” ì„¹ì…˜ì—ì„œ ìœ ìš©í•˜ë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ëŒ€ì‹œë³´ë“œì—ì„œ parallel routeë¥¼ ì‚¬ìš©í•˜ì—¬ íŒ€ í˜ì´ì§€ì™€ ë¶„ì„ í˜ì´ì§€ë¥¼ ë™ì‹œì— ë Œë”ë§í•  ìˆ˜ ìˆë‹¤.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/a43c8b7f-e77d-47de-a59c-f74de1fb0eee/12b40496-a512-4020-9637-1c0cbf9512c3/image.png)

## 3.1 Slots

parallel routeëŠ” named slotsì„ ì‚¬ìš©í•˜ì—¬ ìƒì„±ëœë‹¤. ìŠ¬ë¡¯ì€ `@folder` ì™€ ê°™ì€ ê·œì¹™ìœ¼ë¡œ ì •ì˜ëœë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒ íŒŒì¼ êµ¬ì¡°ëŠ” `@analytics` ì™€ `@team` ì´ë¼ëŠ” ë‘ ìŠ¬ë¡¯ì„ ì •ì˜í•œë‹¤.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/a43c8b7f-e77d-47de-a59c-f74de1fb0eee/e602ac17-a6ef-49f5-b418-369b917b84c2/image.png)

### parallel route íŒŒì¼ ì‹œìŠ¤í…œ êµ¬ì¡°

ìŠ¬ë¡¯ì€ ê³µìœ ëœ ë¶€ëª¨ ë ˆì´ì•„ì›ƒì— propsë¡œ ì „ë‹¬ëœë‹¤.

ìœ„ ì˜ˆì‹œì˜ ê²½ìš°, `app/layout.js` ì•ˆì˜ ì»´í¬ë„ŒíŠ¸ê°€ `@analytics` ì™€ `@team` ìŠ¬ë¡¯ propsë¥¼ ë°›ê³ , `children` ê³¼ í•¨ê»˜ ë³‘ë ¬ì ìœ¼ë¡œ ê°™ì´ ë Œë”ë§í•  ìˆ˜ ìˆë‹¤.

```tsx
export default function Layout({
  children,
  team,
  analytics,
}: {
  children: React.ReactNode;
  analytics: React.ReactNode;
  team: React.ReactNode;
}) {
  return (
    <>
      {children}
      {team}
      {analytics}
    </>
  );
}
```

ìŠ¬ë¡¯ì€ ë¼ìš°íŠ¸ ì„¸ê·¸ë¨¼íŠ¸ê°€ ì•„ë‹ˆë¯€ë¡œ URL êµ¬ì¡°ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, `/@analytics/views`ì˜ URLì€ `/views` ì´ë‹¤. ì—¬ê¸°ì„œ `@analytics` ëŠ” ìŠ¬ë¡¯ì´ë¯€ë¡œ URLì— í¬í•¨ë˜ì§€ ì•ŠëŠ”ë‹¤.

<aside>
ğŸŒŸ

**ì•Œì•„ë‘ë©´ ì¢‹ì€ ì **

`children` propì€ ë¬µì‹œì ì¸ ìŠ¬ë¡¯(implicit slot)ìœ¼ë¡œ, í´ë”ì™€ ë§¤í•‘í•  í•„ìš”ê°€ ì—†ë‹¤.

ë”°ë¼ì„œ, `app/page.js` ëŠ” `app/@children/page.js` ì™€ ë™ì¼í•˜ë‹¤.

</aside>

## 3.2 Active state and navigation (í™œì„± ìƒíƒœì™€ ë‚´ë¹„ê²Œì´ì…˜)

ê¸°ë³¸ì ìœ¼ë¡œ Next.jsëŠ” ê° ìŠ¬ë¡¯ì˜ í™œì„± ìƒíƒœë¥¼ ì¶”ì í•œë‹¤.

ë‹¤ë§Œ, ìŠ¬ë¡¯ ë‚´ì—ì„œ ë Œë”ë§ëœ ì½˜í…ì¸ ëŠ” íƒìƒ‰ ìœ í˜•ì— ë”°ë¼ ë‹¬ë¼ì§„ë‹¤.

- ì†Œí”„íŠ¸ ë‚´ë¹„ê²Œì´ì…˜:
  - í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ íƒìƒ‰ ì‹œ, Next.jsëŠ” ìŠ¬ë¡¯ ë‚´ ì„œë¸Œ í˜ì´ì§€ë¥¼ ë³€ê²½í•˜ë©´ì„œ ë¶€ë¶„ì ìœ¼ë¡œ ë Œë”ë§í•œë‹¤. ì´ë•Œ, URLê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ìŠ¬ë¡¯ì˜ í™œì„± ì„œë¸Œí˜ì´ì§€ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ëœë‹¤.
- í•˜ë“œ ë‚´ë¹„ê²Œì´ì…˜:
  - ì „ì²´ í˜ì´ì§€ê°€ ìƒˆë¡œê³ ì¹¨ë˜ë©´, URLê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ìŠ¬ë¡¯ì˜ í™œì„± ìƒíƒœë¥¼ Next.jsê°€ íŒŒì•…í•  ìˆ˜ ì—†ë‹¤.
  - ì´ ê²½ìš°, í•´ë‹¹ ìŠ¬ë¡¯ì˜ `default.js` íŒŒì¼ì„ ë Œë”ë§í•˜ê±°ë‚˜, `default.js` ê°€ ì—†ìœ¼ë©´ 404 í˜ì´ì§€ê°€ ë Œë”ë§ëœë‹¤.
  - ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ë¼ìš°íŠ¸ì— ëŒ€í•´ 404ë¥¼ ë Œë”ë§í•¨ìœ¼ë¡œì¨, Parallel routeê°€ ì˜ë„ë˜ì§€ ì•Šì€ í˜ì´ì§€ì—ì„œ ì˜ëª» ë Œë”ë§ë˜ëŠ” ê²ƒì„ ë°©ì§€í•œë‹¤.

## 3.3 default.js

`default.js` íŒŒì¼ì„ ì •ì˜í•˜ì—¬ ì´ˆê¸° ë¡œë“œë‚˜ ì „ì²´ ìƒˆë¡œê³ ì¹¨ ì‹œ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ìŠ¬ë¡¯ì— ëŒ€í•œ í´ë°±ì„ ë Œë”ë§í•  ìˆ˜ ìˆë‹¤.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/a43c8b7f-e77d-47de-a59c-f74de1fb0eee/56fd26d3-3be4-46b1-85ae-28d8a8e0f978/image.png)

ìœ„ì˜ ì˜ˆì‹œì—ì„œ, `@team` ìŠ¬ë¡¯ì—ëŠ” `/settings` í˜ì´ì§€ê°€ ìˆì§€ë§Œ, `@analytics` ìŠ¬ë¡¯ì—ëŠ” ì—†ë‹¤.

- `/settings` ë¡œ ì´ë™ ì‹œ, `team` ìŠ¬ë¡¯ì€ `/settings` í˜ì´ì§€ë¥¼ ë Œë”ë§í•˜ê³ , `@analytics` ìŠ¬ë¡¯ì€ í˜„ì¬ í™œì„± ìƒíƒœì˜ í˜ì´ì§€ë¥¼ ìœ ì§€í•œë‹¤.
- ìƒˆë¡œê³ ì¹¨ ì‹œ, Next.jsëŠ” `@analytics` ìŠ¬ë¡¯ì— ëŒ€í•´ `default.js` ë¥¼ ë Œë”ë§í•œë‹¤. ë§Œì•½ `default.js` ê°€ ì—†ìœ¼ë©´ 404ê°€ ë Œë”ë§ëœë‹¤.
- childrenì€ ë¬µì‹œì  ìŠ¬ë¡¯ì´ë¯€ë¡œ, ë¶€ëª¨ í˜ì´ì§€ì˜ í™œì„± ìƒíƒœë¥¼ ë³µêµ¬í•  ìˆ˜ ì—†ì„ ë•Œ ì‚¬ìš©í•  í´ë°±ì„ ì œê³µí•˜ë ¤ë©´ `default.js` íŒŒì¼ì„ ìƒì„±í•´ì•¼ í•œë‹¤.

## 3.4 `useSelectedLayoutSegment(s)` í›…

`useSelectedLayoutSegment`ì™€ `useSelectedLayoutSegments`ëŠ” **parallelRoutesKey** ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ì•„ ìŠ¬ë¡¯ ë‚´ í™œì„± ë¼ìš°íŠ¸ ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ì½ì„ ìˆ˜ ìˆê²Œ í•œë‹¤.

```tsx
// app/layout.tsx
"use client";

import { useSelectedLayoutSegment } from "next/navigation";

export default function Layout({ auth }: { auth: React.ReactNode }) {
  const loginSegment = useSelectedLayoutSegment("auth");
  // ...
}
```

ìœ ì €ê°€ `app/@auth/login` ë¡œ ì´ë™ì‹œ, `loginSegment` ëŠ” â€œloginâ€ ë¬¸ìì—´ê³¼ ë™ì¼í•´ì§ˆ ê²ƒì´ë‹¤.

## 3.5 Examples

### 3.5.1 Conditonal Routes (ì¡°ê±´ë¶€ ë¼ìš°íŠ¸)

parallel routeë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • ì¡°ê±´(ì˜ˆë¥¼ ë“¤ì–´, ì‚¬ìš©ì ì—­í• )ì— ë”°ë¼ ë¼ìš°íŠ¸ë¥¼ ì¡°ê±´ë¶€ë¡œ ë Œë”ë§í•  ìˆ˜ ìˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, `/admin` ë˜ëŠ” `/user` ì—­í• ì— ë”°ë¼ ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ë¥¼ ë‹¤ë¥´ê²Œ ë Œë”ë§í•œë‹¤.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/a43c8b7f-e77d-47de-a59c-f74de1fb0eee/baf7f5e0-04ea-481e-a061-c29d0c78f4bc/image.png)

```tsx
import { checkUserRole } from "@/lib/auth";

export default function Layout({
  user,
  admin,
}: {
  user: React.ReactNode;
  admin: React.ReactNode;
}) {
  const role = checkUserRole();
  return <>{role === "admin" ? admin : user}</>;
}
```

### 3.5.2 Tab Groups

ìŠ¬ë¡¯ ë‚´ì— ë ˆì´ì•„ì›ƒì„ ì¶”ê°€í•˜ì—¬ ì‚¬ìš©ìê°€ ìŠ¬ë¡¯ì„ ë…ë¦½ì ìœ¼ë¡œ íƒìƒ‰í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/a43c8b7f-e77d-47de-a59c-f74de1fb0eee/30d8daf6-cd4b-4612-a34a-fcda238935e2/image.png)

```tsx
// app/@analytics/layout.tsx

import Link from "next/link";

export default function Layout({ children }: { children: React.ReactNode }) {
  return (
    <>
      <nav>
        {/* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */}
        <Link href="/page-views">Page Views</Link>
        <Link href="/visitors">Visitors</Link>
      </nav>
      {/* í˜„ì¬ í™œì„±í™”ëœ ì„œë¸Œí˜ì´ì§€ ë Œë”ë§ */}
      <div>{children}</div>
    </>
  );
}
```

- Link ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•´ ê° íƒ­ì— ì„œë¸Œ í˜ì´ì§€ë“¤ì„ ì—°ê²°í•œë‹¤.
- childrenì€ í˜„ì¬ í™œì„±í™”ëœ í˜ì´ì§€(ì„œë¸Œ í˜ì´ì§€)ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.
  - ì‚¬ìš©ìê°€ page-viewsë¥¼ í´ë¦­í•˜ë©´ `app/@analytics/page-views/page.tsx` ì½˜í…ì¸ ê°€ ë Œë”ë§ëœë‹¤.

**ë™ì‘ ë°©ì‹**

ì‚¬ìš©ìê°€ page-viewsë¡œ ì´ë™í•˜ë©´

- URL: `/page-views`
- chidlrenì—ëŠ” `app/@anayltics/page-views/page.tsx` ë Œë”ë§
- navëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ë˜ê³ , Page Views íƒ­ì´ í™œì„±í™” ë¨.

ìŠ¬ë¡¯(`@analytics` )ì˜ ì„œë¸Œ í˜ì´ì§€ ê°„ íƒìƒ‰ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ë©´ì„œë„, ë¶€ëª¨ ë ˆì´ì•„ì›ƒ(layout.tsx) êµ¬ì¡°ë¥¼ ìœ ì§€í•œë‹¤.

íƒ­ì´ ë‹¨ìˆœíˆ í˜ì´ì§€ ì „í™˜ë§Œ ì²˜ë¦¬í•œë‹¤ë©´ ë³‘ë ¬ ë¼ìš°íŠ¸ ëŒ€ì‹  ë¼ìš°íŠ¸ ê·¸ë£¹ìœ¼ë¡œ ì¶©ë¶„í•¨.

íƒ­ ê·¸ë£¹ì´ ë‹¤ë¥¸ ë³‘ë ¬ ìŠ¬ë¡¯ë“¤ê³¼ ë…ë¦½ì ìœ¼ë¡œ ë Œë”ë§ë  í•„ìš”ê°€ ì—†ë‹¤ë©´ parallel ë¼ìš°íŠ¸ëŠ” ë¶ˆí•„ìš”í•œ ë³µì¡ì„±ì„ ì´ˆë˜í•  ìˆ˜ìˆìŒ.

ìŠ¬ë¡¯ ê°„ ìƒíƒœë¥¼ ë…ë¦½ì ìœ¼ë¡œ ìœ ì§€í•˜ê³ , ì¡°ê±´ë¶€ ë Œë”ë§ ë“± ë³µì¡í•œ ì²˜ë¦¬ê°€ í•„ìš”í•˜ë‹¤ë©´ parallel routeê°€ ì í•©í•¨.

- â­ï¸ ì‹¤ìŠµ (ë¼ìš°íŠ¸ê·¸ë£¹ vs paralel route ê° ë°©ì‹ìœ¼ë¡œ íƒ­ ê·¸ë£¹ ë§Œë“¤ê³ , ìƒíƒœ ë…ë¦½ ê´€ë¦¬ ì´í•´í•˜ê¸°)
  ì•„ë˜ëŠ” íƒ­ ê·¸ë£¹ì„ ì˜ˆì‹œë¡œ **ìƒíƒœê°€ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬ë˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì‹¤ìŠµ ì½”ë“œ**ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ ì½”ë“œëŠ” **ë¼ìš°íŠ¸ ê·¸ë£¹**ê³¼ **ë³‘ë ¬ ë¼ìš°íŠ¸**ë¥¼ ê°ê° êµ¬í˜„í•œ ë’¤, ê° íƒ­ì˜ ìƒíƒœ(ì˜ˆ: ì¹´ìš´í„°)ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ”ì§€ë¥¼ ë¹„êµí•  ìˆ˜ ìˆê²Œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
  ***
  ## **1. ë¼ìš°íŠ¸ ê·¸ë£¹ìœ¼ë¡œ êµ¬í˜„í•œ íƒ­ ê·¸ë£¹**
  ### íŒŒì¼ êµ¬ì¡°
  ```
  plaintext
  ë³µì‚¬í¸ì§‘
  app/
  â”œâ”€â”€ (tabs)/
  â”‚   â”œâ”€â”€ page-views/
  â”‚   â”‚   â””â”€â”€ page.tsx
  â”‚   â””â”€â”€ visitors/
  â”‚       â””â”€â”€ page.tsx
  â””â”€â”€ layout.tsx

  ```
  ### ì½”ë“œ
  **`app/layout.tsx`**
  ```tsx
  typescript;
  ë³µì‚¬í¸ì§‘;
  import Link from "next/link";

  export default function Layout({ children }: { children: React.ReactNode }) {
    return (
      <>
        <nav>
          <Link href="/page-views">Page Views</Link>
          <Link href="/visitors">Visitors</Link>
        </nav>
        <div>{children}</div>
      </>
    );
  }
  ```
  **`app/(tabs)/page-views/page.tsx`**
  ```tsx
  typescript;
  ë³µì‚¬í¸ì§‘;
  ("use client");
  import { useState } from "react";

  export default function PageViews() {
    const [count, setCount] = useState(0);

    return (
      <div>
        <h1>Page Views</h1>
        <p>Count: {count}</p>
        <button onClick={() => setCount(count + 1)}>Increment</button>
      </div>
    );
  }
  ```
  **`app/(tabs)/visitors/page.tsx`**
  ```tsx
  typescript;
  ë³µì‚¬í¸ì§‘;
  ("use client");
  import { useState } from "react";

  export default function Visitors() {
    const [count, setCount] = useState(0);

    return (
      <div>
        <h1>Visitors</h1>
        <p>Count: {count}</p>
        <button onClick={() => setCount(count + 1)}>Increment</button>
      </div>
    );
  }
  ```
  ### ë™ì‘ í™•ì¸
  1. `/page-views`ì—ì„œ ì¹´ìš´í„°ë¥¼ ì¦ê°€ì‹œí‚¤ë©´, ìƒíƒœê°€ ì¦ê°€í•©ë‹ˆë‹¤.
  2. `/visitors`ë¡œ ì´ë™í•˜ë©´ ìƒíƒœëŠ” ì´ˆê¸°í™”ë©ë‹ˆë‹¤.
     - **ë¼ìš°íŠ¸ ê·¸ë£¹ì€ ìƒíƒœë¥¼ ìœ ì§€í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**
     - ìƒíƒœê°€ ì»´í¬ë„ŒíŠ¸ ë‹¨ìœ„ë¡œ ìƒˆë¡œ ë Œë”ë§ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
  ***
  ## **2. ë³‘ë ¬ ë¼ìš°íŠ¸ë¡œ êµ¬í˜„í•œ íƒ­ ê·¸ë£¹**
  ### íŒŒì¼ êµ¬ì¡°
  ```
  plaintext
  ë³µì‚¬í¸ì§‘
  app/
  â”œâ”€â”€ @tabs/
  â”‚   â”œâ”€â”€ page-views/
  â”‚   â”‚   â””â”€â”€ page.tsx
  â”‚   â”œâ”€â”€ visitors/
  â”‚   â”‚   â””â”€â”€ page.tsx
  â”‚   â””â”€â”€ default.js
  â””â”€â”€ layout.tsx

  ```
  ### ì½”ë“œ
  **`app/layout.tsx`**
  ```tsx
  typescript;
  ë³µì‚¬í¸ì§‘;
  export default function Layout({ tabs }: { tabs: React.ReactNode }) {
    return (
      <>
        <nav>
          <a href="/page-views">Page Views</a>
          <a href="/visitors">Visitors</a>
        </nav>
        <div>{tabs}</div>
      </>
    );
  }
  ```
  **`app/@tabs/page-views/page.tsx`**
  ```tsx
  typescript;
  ë³µì‚¬í¸ì§‘;
  ("use client");
  import { useState } from "react";

  export default function PageViews() {
    const [count, setCount] = useState(0);

    return (
      <div>
        <h1>Page Views</h1>
        <p>Count: {count}</p>
        <button onClick={() => setCount(count + 1)}>Increment</button>
      </div>
    );
  }
  ```
  **`app/@tabs/visitors/page.tsx`**
  ```tsx
  typescript;
  ë³µì‚¬í¸ì§‘;
  ("use client");
  import { useState } from "react";

  export default function Visitors() {
    const [count, setCount] = useState(0);

    return (
      <div>
        <h1>Visitors</h1>
        <p>Count: {count}</p>
        <button onClick={() => setCount(count + 1)}>Increment</button>
      </div>
    );
  }
  ```
  **`app/@tabs/default.js`**
  ```tsx
  typescript;
  ë³µì‚¬í¸ì§‘;
  export default function Default() {
    return <h1>Select a Tab</h1>;
  }
  ```
  ### ë™ì‘ í™•ì¸
  1. `/page-views`ì—ì„œ ì¹´ìš´í„°ë¥¼ ì¦ê°€ì‹œí‚¤ë©´ ìƒíƒœê°€ ì¦ê°€í•©ë‹ˆë‹¤.
  2. `/visitors`ë¡œ ì´ë™í•œ ë’¤, ë‹¤ì‹œ `/page-views`ë¡œ ëŒì•„ì˜¤ë©´ ìƒíƒœê°€ ìœ ì§€ë©ë‹ˆë‹¤.
     - **ë³‘ë ¬ ë¼ìš°íŠ¸ëŠ” ìŠ¬ë¡¯ ê°„ ìƒíƒœë¥¼ ë…ë¦½ì ìœ¼ë¡œ ìœ ì§€í•©ë‹ˆë‹¤.**
     - ê° ìŠ¬ë¡¯ì´ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
  ***
  ## **3. ë¼ìš°íŠ¸ ê·¸ë£¹ê³¼ ë³‘ë ¬ ë¼ìš°íŠ¸ì˜ ì°¨ì´ ë¹„êµ**
  | íŠ¹ì§•                          | ë¼ìš°íŠ¸ ê·¸ë£¹                           | ë³‘ë ¬ ë¼ìš°íŠ¸                                     |
  | ----------------------------- | ------------------------------------- | ----------------------------------------------- |
  | ìƒíƒœ ì´ˆê¸°í™” ì—¬ë¶€              | ë‹¤ë¥¸ íƒ­ìœ¼ë¡œ ì´ë™í•˜ë©´ ìƒíƒœê°€ ì´ˆê¸°í™”ë¨. | ë‹¤ë¥¸ íƒ­ìœ¼ë¡œ ì´ë™í•´ë„ ìƒíƒœê°€ ìœ ì§€ë¨.             |
  | ë…ë¦½ ìƒíƒœ ìœ ì§€                | ë¶ˆê°€ëŠ¥.                               | ê°€ëŠ¥.                                           |
  | ê° íƒ­ì˜ ë…ë¦½ì  ê´€ë¦¬ í•„ìš” ì—¬ë¶€ | ë‹¨ìˆœí•œ í˜ì´ì§€ ì „í™˜ì— ì í•©.            | ìƒíƒœë‚˜ ë°ì´í„°ë¥¼ ê°œë³„ì ìœ¼ë¡œ ê´€ë¦¬í•´ì•¼ í•  ë•Œ ì í•©. |

### 3.5.3 Modals

intercepting routesì™€ í•¨ê»˜ ëª¨ë‹¬ì„ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

1. URLì„ í†µí•´ ëª¨ë‹¬ ì½˜í…ì¸  ê³µìœ  ê°€ëŠ¥.
2. í˜ì´ì§€ê°€ ìƒˆë¡œê³ ì¹¨ ë˜ì–´ë„ ë¬¸ë§¥(Context)ë¥¼ ìœ ì§€í•˜ë©° ëª¨ë‹¬ì´ ë‹«íˆì§€ ì•ŠìŒ.
3. ë’¤ë¡œê°€ê¸° ì‹œ ì´ì „ ê²½ë¡œë¡œ ì´ë™í•˜ì§€ ì•Šê³  ëª¨ë‹¬ì„ ë‹«ì„ ìˆ˜ ìˆìŒ.
4. ì•ìœ¼ë¡œ ê°€ê¸° ì‹œ ëª¨ë‹¬ì„ ë‹¤ì‹œ ì—´ ìˆ˜ ìˆìŒ.

ì‚¬ìš©ìê°€ ë ˆì´ì•„ì›ƒì—ì„œ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ë„¤ë¹„ê²Œì‹œë…€ì„ í†µí•´ ë¡œê·¸ì¸ ëª¨ë‹¬ì„ ì—´ê±°ë‚˜, ë³„ë„ì˜ `/login` í˜ì´ì§€ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” UI íŒ¨í„´ì„ ê³ ë ¤í•œë‹¤.

- â­ï¸ TODO: ì‹¤ìŠµ

## 3.6 Loading and Error UI

parallel routeëŠ” ê° ìŠ¬ë¡¯ì„ ë…ë¦½ì ìœ¼ë¡œ ìŠ¤íŠ¸ë¦¬ë°í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ë¡œë“œ ì¤‘ ë˜ëŠ” ì—ëŸ¬ ìƒíƒœë¥¼ ìŠ¬ë¡¯ë³„ë¡œ ì •ì˜í•  ìˆ˜ ìˆë‹¤.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/a43c8b7f-e77d-47de-a59c-f74de1fb0eee/6b6bf943-54e3-483f-a199-ab22b3517295/image.png)

# 4. Intercepting Routes

ì¸í„°ì…‰íŒ… ë¼ìš°íŠ¸ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë‹¤ë£¬ ë¶€ë¶„ì— ìˆëŠ” ê²½ë¡œë¥¼ í˜„ì¬ ë ˆì´ì•„ì›ƒ ë‚´ì—ì„œ ë¡œë“œí•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.

ì‚¬ìš©ìê°€ ë‹¤ë¥¸ contextë¡œ ì „í™˜í•˜ì§€ ì•Šìœ¼ë©´ì„œ íŠ¹ì • ê²½ë¡œì˜ ì½˜í…ì¸ ë¥¼ í‘œì‹œí•˜ê³  ì‹¶ì„ ë•Œ ìœ ìš©í•˜ë‹¤.

ì˜ˆë¥¼ ë“¤ì–´,

- ì‚¬ìš©ìê°€ í”¼ë“œì—ì„œ ì‚¬ì§„ í´ë¦­ ì‹œ ì‚¬ì§„ ëª¨ë‹¬ì´ í‘œì‹œë˜ê³ , í”¼ë“œ ìœ„ì— ì˜¤ë²„ë ˆì´ ëœë‹¤.
- ì´ë•Œ Next.jsëŠ” ì‚¬ì§„ ê²½ë¡œë¥¼ ì¸í„°ì…‰íŠ¸í•˜ì—¬ URLì€ ë³€ê²½í•˜ì§€ë§Œ, ê¸°ì¡´ í”¼ë“œ ìœ„ì— ëª¨ë‹¬ì„ ì˜¤ë²„ë ˆì´ë¡œ ë ˆë„ë§í•œë‹¤.

## ì»¨ë²¤ì…˜

`(..)` ê·œì¹™ì„ ì‚¬ìš©í•œë‹¤. ê²½ë¡œ ì„¸ê·¸ë¨¼íŠ¸ì— ëŒ€í•´ì„œë§Œ ì‘ë™í•œë‹¤.

1. **(.)**: ê°™ì€ ë ˆë²¨ì˜ ì„¸ê·¸ë¨¼íŠ¸ì— ë§¤ì¹­.
2. **(..)**: í•œ ë ˆë²¨ ìœ„ì˜ ì„¸ê·¸ë¨¼íŠ¸ì— ë§¤ì¹­.
3. **(..)(..)**: ë‘ ë ˆë²¨ ìœ„ì˜ ì„¸ê·¸ë¨¼íŠ¸ì— ë§¤ì¹­.
4. **(...)**: ì• í”Œë¦¬ì¼€ì´ì…˜ ë£¨íŠ¸(`app` ë””ë ‰í† ë¦¬)ë¶€í„° ë§¤ì¹­.

<aside>
ğŸŒŸ

**ì•Œì•„ë‘ë©´ ì¢‹ì€ ì **
ì¸í„°ì…‰íŒ… ë¼ìš°íŠ¸ëŠ” ë ˆì´ì•„ì›ƒì„ ìœ ì§€í•˜ë©´ì„œë„ íŠ¹ì • ì½˜í…ì¸ ë¥¼ ì˜¤ë²„ë ˆì´í•˜ëŠ”ë° ê°•ë ¥í•œ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.

1. ë¡œê·¸ì¸ ëª¨ë‹¬: ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°”ì—ì„œ ì—´ë¦¬ì§€ë§Œ, `/login` ì „ìš© í˜ì´ì§€ë„ ì§€ì›.
2. ì¥ë°”êµ¬ë‹ˆ ëª¨ë‹¬: ì‚¬ì´ë“œë°”ì—ì„œ ì—´ë¦¬ì§€ë§Œ, `/cart` ì „ìš© í˜ì´ì§€ë„ ì§€ì›.
</aside>

# 5. Route Handlers

Route handlersëŠ” ì£¼ì–´ì§„ ê²½ë¡œì— ëŒ€í•´ ì›¹ ìš”ì²­(Request) ë° ì‘ë‹µ(Response) APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì»¤ìŠ¤í…€ ìš”ì²­ í•¸ë“¤ëŸ¬ë¥¼ ìƒì„±í•  ìˆ˜ìˆë„ë¡œ í•œë‹¤.

## 5.1 Route.js íŒŒì¼

Route handlersëŠ” app ë””ë ‰í† ë¦¬ ë‚´ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. pages ë””ë ‰í† ë¦¬ì˜ API Routesì™€ ë™ë“±í•˜ë©°, ë‘ ê°€ì§€ë¥¼ í•¨ê»˜ ì‚¬ìš©í•  í•„ìš”ëŠ” ì—†ë‹¤.

<aside>
ğŸŒŸ

**Route handlers vs API Routes**

1. API RouteëŠ” í•˜ë‚˜ì˜ íŒŒì¼ì—ì„œ ëª¨ë“  ë©”ì„œë“œë¥¼ ë¶„ê¸°í•˜ì§€ë§Œ, Route HandlersëŠ” ê° ë©”ì„œë“œë¥¼ í•¨ìˆ˜ë¡œ ëª…ì‹œí•¨.
2. Route HandlersëŠ” ê¸°ë³¸ ìºì‹±(íŠ¹íˆ GET)ê³¼ `NextRequest/NextResponse` í™•ì¥ ê¸°ëŠ¥ì„ ì§€ì›.
3. ë‘˜ ë‹¤ ì„œë²„ ë¡œì§ì„ ë‹´ë‹¹í•˜ì§€ë§Œ, Route Handlersê°€ ìŠ¤íŠ¸ë¦¬ë° ì§€ì› ë“± ë” í™•ì¥ì„± ìˆëŠ” ìœ í‹¸ ì œê³µ.
</aside>

### ì»¨ë²¤ì…˜

- `route.js/ts` ë¡œ íŒŒì¼ì„ ì •ì˜í•œë‹¤.
- `page.js` ì™€ ë™ì¼í•œ ë¼ìš°íŠ¸ ì„¸ê·¸ë¨¼íŠ¸ ë ˆë²¨ì— `route.js` íŒŒì¼ì´ ì¡´ì¬í•  ìˆ˜ ì—†ë‹¤.

## 5.2 ì§€ì›ë˜ëŠ” HTTP ë©”ì„œë“œ

- **GET**, **POST**, **PUT**, **PATCH**, **DELETE**, **HEAD**, **OPTIONS**
  - ì§€ì›ë˜ì§€ ì•ŠëŠ” ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ **405 Method Not Allowed** ì‘ë‹µì´ ë°˜í™˜ë¨.

## 5.3 í™•ì¥ëœ NextRequest ë° NextResponse API

ê¸°ë³¸ **Request** ë° **Response** ì™¸ì—ë„ **NextRequest**ì™€ **NextResponse**ë¥¼ í™•ì¥í•˜ì—¬ ì œê³µí•œë‹¤. (Web APIì— ì¶”ê°€ì ì¸ í¸ë¦¬í•œ ë©”ì„œë“œë“¤ì„ í™•ì¥í•œ ê²ƒì´ë¼ê³  ì´í•´í•˜ë©´ ë¨.)

## 5.4 ë™ì‘

### **ìºì‹±**

**GET ë©”ì„œë“œ** ì—ì„œ Response ê°ì²´ë¥¼ ì‚¬ìš©í•  ê²½ìš°, Route HandlersëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ìºì‹±ëœë‹¤.

```tsx
// app/items/route.ts
export async function GET() {
  const res = await fetch("https://data.mongodb-api.com/...", {
    headers: {
      "Content-Type": "application/json",
      "API-Key": process.env.DATA_API_KEY,
    },
  });
  const data = await res.json();

  return Response.json({ data });
}
```

- `Response.json()`ì€ TypeScript 5.2 ì´ìƒì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤. ì´ì „ ë²„ì „ì—ì„œëŠ” `NextResponse.json()`ì„ ì‚¬ìš©í•˜ì—¬ íƒ€ì´í•‘ëœ ì‘ë‹µì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

### ìºì‹± ë¹„í™œì„±í™”

1. GET ë©”ì„œë“œì—ì„œ `Request` ê°ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°.
2. ë‹¤ë¥¸ HTTP ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°.
3. ì¿ í‚¤, í—¤ë” ê°™ì€ ë™ì  ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°.
4. Segment Config Options ì—ì„œ ë™ì  ëª¨ë“œë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì§€ì •í•˜ëŠ” ê²½ìš°.

### POST ìš”ì²­

POST ë©”ì„œë“œëŠ” Route Handlerë¥¼ ë™ì ìœ¼ë¡œ í‰ê°€í•˜ë„ë¡ ë§Œë“ ë‹¤.

## 5.5 ì˜ˆì‹œ

### 1. ìºì‹œëœ ë°ì´í„° ì¬ê²€ì¦

`next.revalidate` ì˜µì…˜ì„ ì‚¬ìš©í•œë‹¤.

```tsx
// app/items/route.ts
export async function GET() {
  const res = await fetch("https://data.mongodb-api.com/...", {
    next: { revalidate: 60 }, // 60ì´ˆë§ˆë‹¤ ì¬ê²€ì¦
  });
  const data = await res.json();

  return Response.json(data);
}
```

### 2. Dynamic Functions

**Cookies**

`next/headers` ì—ì„œ ì œê³µí•˜ëŠ” `cookies` ë¥¼ ì‚¬ìš©í•´ ì¿ í‚¤ë¥¼ ì½ê±°ë‚˜ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

```tsx
// app/api/route.ts
import { cookies } from "next/headers";

export async function GET(request: Request) {
  const cookieStore = cookies();
  const token = cookieStore.get("token");

  return new Response("Hello, Next.js!", {
    status: 200,
    headers: { "Set-Cookie": `token=${token.value}` },
  });
}
```

**Headers**

`headers` ë¥¼ ì‚¬ìš©í•´ í—¤ë”ë¥¼ ì½ì„ ìˆ˜ ìˆìœ¼ë©°, ìƒˆë¡œìš´ í—¤ë”ë¥¼ ì„¤ì •í•˜ë ¤ë©´ `Response` ë¥¼ ë°˜í™˜í•´ì•¼ í•œë‹¤.

```tsx
// app/api/route.ts
import { headers } from "next/headers";

export async function GET(request: Request) {
  const headersList = headers();
  const referer = headersList.get("referer");

  return new Response("Hello, Next.js!", {
    status: 200,
    headers: { referer: referer },
  });
}
```

### 3. Redirects

`redirect` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ ìš”ì²­ì„ ë‹¤ë¥¸ ê²½ë¡œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•  ìˆ˜ ìˆë‹¤.

```tsx
// app/api/route.ts
import { redirect } from "next/navigation";

export async function GET(request: Request) {
  redirect("https://nextjs.org/");
}
```

### 4. Dynamic Route Segments (ë™ì  ë¼ìš°íŠ¸ ì„¸ê·¸ë¨¼íŠ¸)

```tsx
// app/items/[slug]/route.ts
export async function GET(
  request: Request,
  { params }: { params: { slug: string } }
) {
  const slug = params.slug; // 'a', 'b', or 'c'
}
```

### 5. URL Query Parameters

`NextRequest` ê°ì²´ì˜ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ì‰½ê²Œ ì²˜ë¦¬ í•  ìˆ˜ ìˆë‹¤.

```tsx
// app/api/search/route.ts
import { type NextRequest } from "next/server";

export function GET(request: NextRequest) {
  const searchParams = request.nextUrl.searchParams;
  const query = searchParams.get("query"); // URL: /api/search?query=hello
}
```

### 6. Streaming

```tsx
// app/api/chat/route.ts
import OpenAI from "openai";
import { OpenAIStream, StreamingTextResponse } from "ai";

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

export async function POST(req: Request) {
  const { messages } = await req.json();
  const response = await openai.chat.completions.create({
    model: "gpt-3.5-turbo",
    stream: true,
    messages,
  });

  const stream = OpenAIStream(response);

  return new StreamingTextResponse(stream);
}
```

### 7. Request Body

í‘œì¤€ Web API ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” `Request` bodyë¥¼ ì½ì„ ìˆ˜ ìˆë‹¤.

```tsx
export async function POST(request: Request) {
  const res = await request.json();
  return Response.json({ res });
}
```

### 8. Request Body FormData

request.formDataë¥¼ í†µí•´, FormDataë¥¼ ì½ì„ ìˆ˜ ìˆë‹¤.

formDataëŠ” ëª¨ë‘ ë¬¸ìì—´ì´ê¸° ë•Œë¬¸ì—, ìš”ì²­ì„ ê²€ì¦í•˜ê¸° ìœ„í•´ì„œ [**`zod-form-data`**](https://www.npmjs.com/package/zod-form-data) ë¥¼ ì‚¬ìš©í•˜ì—¬ ê²€ì¦í•˜ê³ , numberì™€ ê°™ì€ ì›í•˜ëŠ” í¬ë§·ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.

### 9. CORS

í‘œì¤€ Web API ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ì— CORS í—¤ë”ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

- ë§Œì•½ ì—¬ëŸ¬ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ì— CORS í—¤ë”ë¥¼ ì¶”ê°€í•˜ê³  ì‹¶ë‹¤ë©´, Middleware í˜¹ì€ next.config.js íŒŒì¼ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
-

```tsx
export const dynamic = "force-dynamic"; // defaults to auto

export async function GET(request: Request) {
  return new Response("Hello, Next.js!", {
    status: 200,
    headers: {
      "Access-Control-Allow-Origin": "*",
      "Access-Control-Allow-Methods": "GET, POST, PUT, DELETE, OPTIONS",
      "Access-Control-Allow-Headers": "Content-Type, Authorization",
    },
  });
}
```

### 10. Webhooks

ì¨ë“œíŒŒí‹° ì„œë¹„ìŠ¤ë¡œë¶€í„° ì›¹í›…ì„ ë°›ê¸° ìœ„í•´ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

Page Routerì˜ API Routesì™€ ë‹¤ë¥´ê²Œ, Route Handlerì—ì„œëŠ” bodyParserì„ ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ë‹¤.

ì¦‰ ì¶”ê°€ ì„¤ì • ì—†ì´ request ê°ì²´ë¡œë¶€í„° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

### 11. Edge and Node.js Runtimes

Route HandlerëŠ” Edgeì™€ Node.js ëŸ°íƒ€ì„ ëª¨ë‘ë¥¼ ë§¤ë„ëŸ½ê²Œ ì§€ì›í•˜ê¸° ìœ„í•´ ë™í˜•(isomorphic) Web APIë¥¼ ì œê³µí•œë‹¤. ì—¬ê¸°ì—ëŠ” ìŠ¤íŠ¸ë¦¬ë° ê¸°ëŠ¥ ì§€ì›ë„ í¬í•¨ëœë‹¤.

ë˜í•œ Pagesì™€ Layoutsì™€ ë™ì¼í•œ ë¼ìš°íŠ¸ ì„¸ê·¸ë¨¼íŠ¸ ì„¤ì • ë°©ì‹ì„ ì‚¬ìš©í•˜ë¯€ë¡œ, ì¼ë°˜ì ì¸ ì •ì  ì¬ìƒì„±(SSR) Route handerì™€ ê°™ì€ ì˜¤ë«ë™ì•ˆ ëŒ€ê¸°í•˜ë˜ ê¸°ëŠ¥ë„ ì§€ì›í•  ìˆ˜ ìˆë‹¤.

ëŸ°íƒ€ì„ì„ ì§ì ‘ ì§€ì •í•˜ë ¤ë©´ runtime ì„¸ê·¸ë¨¼íŠ¸ ì„¤ì • ì˜µì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```tsx
export const runtime = "edge"; // ê¸°ë³¸ê°’ì€ 'nodejs'
```

### 12. Non-UI Responses

`sitemap.xml` , `robots.txt`, `app icons` , open graph imagesì™€ ê°™ì€ UIê°€ ì—†ëŠ” ì½˜í…ì¸ ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆë‹¤.

```tsx
export const dynamic = "force-dynamic"; // defaults to auto

export async function GET() {
  return new Response(
    `<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0">
 
<channel>
  <title>Next.js Documentation</title>
  <link>https://nextjs.org/docs</link>
  <description>The React Framework for the Web</description>
</channel>
 
</rss>`,
    {
      headers: {
        "Content-Type": "text/xml",
      },
    }
  );
}
```

### 13. Segment Config Options

Route handlersëŠ” pagesì™€ layoutsê³¼ ë˜‘ê°™ì€ ë¼ìš°íŠ¸ ì„¸ê·¸ë¨¼íŠ¸ ì„¤ì •ì„ ì‚¬ìš©í•œë‹¤.

```tsx
export const dynamic = "auto";
export const dynamicParams = true;
export const revalidate = false;
export const fetchCache = "auto";
export const runtime = "nodejs";
export const preferredRegion = "auto";
```

# 6. Middleware

ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ìš”ì²­ì´ ì™„ë£Œë˜ê¸° ì „ì— ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.

ì´ë ‡ê²Œ í•´ì„œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ê¸°ë°˜ìœ¼ë¡œ, ì‘ë‹µì„ ìˆ˜ì •í•˜ê±°ë‚˜ ì¬ì‘ì„±(rewriting), ë¦¬ë””ë ‰ì…˜(redirecting), ìš”ì²­ í˜¹ì€ ì‘ë‹µ í—¤ë” ìˆ˜ì •, ë˜ëŠ” ì§ì ‘ ì‘ë‹µì„ ë°˜í™˜í•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

ë¯¸ë“¤ì›¨ì–´ëŠ” ìºì‹œëœ ì½˜í…ì¸ ê°€ ì „ë‹¬ë˜ê³  ë¼ìš°íŠ¸ê°€ ë§¤ì¹­ë˜ê¸° ì „ì— ì‹¤í–‰ëœë‹¤.

ì¦‰, ì‚¬ìš©ìê°€ ìš”ì²­í•œ í˜ì´ì§€ë‚˜ APIê°€ ìµœì¢…ì ìœ¼ë¡œ ê²°ì •(ë§¤ì¹­)ë˜ì–´ ì‘ë‹µí•˜ê¸° ì „ì—, ê·¸ë¦¬ê³  ì´ë¯¸ ìºì‹œë˜ì–´ ìˆëŠ” ì½˜í…ì¸ ë¥¼ Next.jsê°€ ë°”ë¡œ ë°˜í™˜í•˜ê¸° ì „ì— , ë¯¸ë“¤ì›¨ì–´ê°€ ë¨¼ì € ìš”ì²­ì„ ê°€ë¡œì±„ì–´ ë¡œì§ì„ ì²˜ë¦¬í•œë‹¤ëŠ” ëœ»ì´ë‹¤.

## 6.1 ì‚¬ìš© ì‚¬ë¡€

ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë¯¸ë“¤ì›¨ì–´ë¥¼ í†µí•©í•˜ë©´ ì„±ëŠ¥, ë¶€ì•ˆ, ì‚¬ìš©ì ê²½í—˜ ì¸¡ë©´ì—ì„œ í¬ê²Œ í–¥ìƒë  ìˆ˜ ìˆë‹¤.

1. ì¸ì¦ ë° ê¶Œí•œ ë¶€ì—¬ (Authentication and Authorization)
   - íŠ¹ì • í˜ì´ì§€ë‚˜ API ë¼ìš°íŠ¸ì— ì ‘ê·¼í•˜ê¸° ì „, ì‚¬ìš©ì ì‹ ì› í™•ì¸ ë° ì„¸ì…˜ ì¿ í‚¤ ê²€ì‚¬.
2. ì„œë²„ ì‚¬ì´ë“œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (Server-Side Redirects)
   - íŠ¹ì • ì¡°ê±´(ì˜ˆ: locale, ì‚¬ìš©ì ì—­í• )ì— ë”°ë¼ ì„œë²„ ë ˆë²¨ì—ì„œ ì‚¬ìš©ì ë¦¬ë‹¤ì´ë ‰íŠ¸.
3. ê²½ë¡œ ì¬ì‘ì„± (Path Rewriting)
   - A/B í…ŒìŠ¤íŠ¸, ê¸°ëŠ¥ ë¡¤ì•„ì›ƒ, ë ˆê±°ì‹œ ê²½ë¡œ ì§€ì› ë“±ì„ ìœ„í•´ ìš”ì²­ ì†ì„±ì— ë”°ë¼ ê²½ë¡œë¥¼ ë™ì ìœ¼ë¡œ ì¬ì‘ì„±í•´ API ë¼ìš°íŠ¸ë‚˜ í˜ì´ì§€ë¡œ ì—°ê²°.
4. ë´‡ ê°ì§€(Bot Detection)
   - ë´‡ íŠ¸ë˜í”½ì„ íƒì§€í•˜ê³  ì°¨ë‹¨í•˜ì—¬ ë¦¬ì†ŒìŠ¤ ë³´í˜¸.
5. ë¡œê¹… ë° ë¶„ì„
   - í˜ì´ì§€ë‚˜ APIê°€ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê¸° ì „, ìš”ì²­ ë°ì´í„°ë¥¼ ìº¡ì²˜í•˜ê³  ë¶„ì„.
6. ê¸°ëŠ¥ í”Œë˜ê¹…
   - ê¸°ëŠ¥ì„ ë™ì ìœ¼ë¡œ í™œì„±/ë¹„í™œì„±í™”í•˜ì—¬ ì›í™œí•œ ê¸°ëŠ¥ ë¡¤ì•„ì›ƒ í˜¹ì€ í…ŒìŠ¤íŠ¸ êµ¬í˜„.

**ë°˜ë©´, ë¯¸ë“¤ì›¨ì–´ê°€ ìµœì ì˜ ì ‘ê·¼ì´ ì•„ë‹Œ ê²½ìš°ë„ ìˆë‹¤.**

- ë³µì¡í•œ ë°ì´í„° í˜ì¹­ ë° ì¡°ì‘
  - ë¯¸ë“¤ì›¨ì–´ëŠ” ì§ì ‘ì ì¸ ë°ì´í„° í˜ì¹­ì´ë‚˜ ì¡°ì‘ì„ ìœ„í•´ ì„¤ê³„ë˜ì§€ ì•Šì•˜ë‹¤. ì´ëŸ° ì‘ì—…ì€ Route Handlersë‚˜ ì„œë²„ ì‚¬ì´ë“œ ìœ í‹¸ë¦¬í‹°ì—ì„œ ì²˜ë¦¬í•´ì•¼ í•œë‹¤.
- ê³ ë¹„ìš© ê³„ì‚° ì‘ì—…
  - ë¯¸ë“¤ì›¨ì–´ëŠ” ê°€ë²¼ìš°ë©° ë¹ ë¥´ê²Œ ì‘ë‹µí•´ì•¼ í•œë‹¤. ë¬´ê±°ìš´ ê³„ì‚°ì´ë‚˜ ì˜¤ë˜ ê±¸ë¦¬ëŠ” í”„ë¡œì„¸ìŠ¤ëŠ” ì „ìš© Route handlersì—ì„œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
- ëŒ€ê·œëª¨ ì„¸ì…˜ ê´€ë¦¬
  - ë¯¸ë“¤ì›¨ì–´ë¡œ ê°„ë‹¨í•œ ì„¸ì…˜ ì‘ì—…ì€ ê°€ëŠ¥í•˜ì§€ë§Œ, ê·œë¬˜ê°€ í° ì„¸ì…˜ ê´€ë¦¬ëŠ” ì¸ì¦ ì„œë¹„ìŠ¤ë‚˜ Route Handlersì—ì„œ ì „ë‹´í•˜ëŠ” ê²ƒì´ ê¶Œì¥ëœë‹¤.
- ì§ì ‘ì ì¸ ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…
  - ë¯¸ë“¤ì›¨ì–´ ì•ˆì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ì‚°ì„ ì§ì ‘ ìˆ˜í–‰í•˜ëŠ” ê²ƒì€ ê¶Œì¥ë˜ì§€ ì•ŠëŠ”ë‹¤. ë°ì´í„°ë² ì´ìŠ¤ ì—°ì‚°ì€ Route Handlersë‚˜ ì„œë²„ ì‚¬ì´ë“œ ìœ í‹¸ë¦¬í‹° ë‚´ì—ì„œ ì²˜ë¦¬í•˜ì.

## 6.2 ì»¨ë²¤ì…˜

í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `middleware.ts/js` íŒŒì¼ì„ ë§Œë“¤ì–´ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì •ì˜í•œë‹¤.

í”„ë¡œì íŠ¸ë‹¹ ì˜¤ì§ í•˜ë‚˜ì˜ ë¯¸ë“¤ì›¨ì–´ íŒŒì¼ë§Œ ì§€ì›ëœë‹¤. ê·¸ëŸ¬ë‚˜, ë¯¸ë“¤ì›¨ì–´ ë¡œì§ì„ ëª¨ë“ˆ ë‹¨ìœ„ë¡œ ë¶„ë¦¬í•œ ë’¤, ê° ê¸°ëŠ¥ë³„ .ts íŒŒì¼ë¡œ ë‚˜ëˆˆ ë‹¤ìŒ, ë©”ì¸ middleware íŒŒì¼ì—ì„œ ë¶ˆëŸ¬ì™€ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

ì´ë ‡ê²Œ í•˜ë©´ ë¼ìš°íŠ¸ ë³„ ë¯¸ë“¤ì›¨ì–´ ë¡œì§ì„ íš¨ìœ¨ì ìœ¼ë¡œ êµ¬ì„±í•˜ê³ , ë¯¸ë“¤ì›¨ì–´ íŒŒì¼ì—ì„œ ì¤‘ì•™ì§‘ì¤‘ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

ë¯¸ë“¤ì›¨ì–´ íŒŒì¼ì´ í•˜ë‚˜ë¼ëŠ” ì ì€ ì„¤ì •ì„ ë‹¨ìˆœí™”í•˜ê³ , ì¤‘ë³µì´ë‚˜ ì¶©ëŒì„ ë°©ì§€í•˜ë©°, ì—¬ëŸ¬ ë¯¸ë“¤ì›¨ì–´ ë ˆì´ì–´ê°€ ìƒì„±ë  ë•Œ ë°œìƒí•˜ëŠ” ì„±ëŠ¥ ë¬¸ì œë¥¼ í”¼í•˜ëŠ” ì¥ì ì´ ìˆë‹¤.

## 6.3 Matching Paths

ë¯¸ë“¤ì›¨ì–´ëŠ” í”„ë¡œì íŠ¸ ë‚´ ëª¨ë“  ê²¨ì˜¬ì— ëŒ€í•´ í˜¸ì¶œëœë‹¤. ë”°ë¼ì„œ íŠ¹ì • ë¼ìš°íŠ¸ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì‚¼ê±°ë‚˜(í˜¹ì€ ì œì™¸í•˜ë ¤ë©´), ë§¤ì²˜(matcher)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì •í™•íˆ ì„¤ì •í•´ì•¼ í•œë‹¤.

ì‹¤í–‰ ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

1. `next.config.js`ì˜ `headers`
2. `next.config.js`ì˜ `redirects`
3. **Middleware (ì¬ì‘ì„±, ë¦¬ë””ë ‰ì…˜ ë“±)**
4. `next.config.js`ì˜ `beforeFiles` (rewrites)
5. íŒŒì¼ì‹œìŠ¤í…œ ë¼ìš°íŠ¸(`public/`, `_next/static/`, `pages/`, `app/` ë“±)
6. `next.config.js`ì˜ `afterFiles` (rewrites)
7. **ë™ì  ë¼ìš°íŠ¸** (`/blog/[slug]`)
8. `next.config.js`ì˜ `fallback` (rewrites)

- **â­ï¸ Next.jsì—ì„œ ìš”ì²­ì´ ì²˜ë¦¬ë˜ëŠ” ìˆœì°¨ì ì¸ ê³¼ì • ì´í•´í•˜ê¸°**
  ## **ê°„ë‹¨ ì˜ˆì‹œ ì‹œë‚˜ë¦¬ì˜¤**
  ### **ìƒí™©**
  ì‚¬ìš©ìê°€ **`/old-route`** ì£¼ì†Œë¡œ ì ‘ê·¼í•œë‹¤. ì´ë•Œ ì‹¤ì œë¡œ ë³´ì—¬ì£¼ê³  ì‹¶ì€ í˜ì´ì§€ëŠ” **`/new-route`**ì´ì§€ë§Œ, ì ‘ê·¼ ì‹œ ëª‡ ê°€ì§€ ë‹¨ê³„ë¥¼ ê±°ì¹˜ê²Œ ëœë‹¤.
  1. **Headers**
     - ìš°ì„ , `next.config.js`ì˜ `headers` ì„¤ì •ì„ í™•ì¸í•œë‹¤.
     - `/old-route`ì— ëŒ€ì‘ë˜ëŠ” í—¤ë” ì„¤ì •ì´ ìˆë‹¤ë©´, í•´ë‹¹ í—¤ë”ë¥¼ **ì‘ë‹µ**ì— ì¶”ê°€í•˜ë„ë¡ ì¤€ë¹„í•œë‹¤. (í•˜ì§€ë§Œ ì‹¤ì œ ì‘ë‹µì„ ì•„ì§ ë‚´ë³´ë‚´ì§„ ì•ŠëŠ”ë‹¤.)
  2. **Redirects**
     - ì´ì–´ì„œ `next.config.js`ì˜ `redirects` ì„¤ì •ì„ ë³¸ë‹¤.
     - `/old-route`ê°€ **`/new-route`ë¡œ ë¦¬ë””ë ‰ì…˜**ë˜ëŠ” ì„¤ì •ì´ ë˜ì–´ ìˆë‹¤ë©´, **"ì•„, ì´ ìš”ì²­ì€ `/new-route`ë¡œ ê°€ì•¼ í•˜ëŠ”êµ¬ë‚˜"** í•˜ê³  **í´ë¼ì´ì–¸íŠ¸ì— 301(ë˜ëŠ” 307) ë¦¬ë””ë ‰ì…˜** ì‘ë‹µì„ ëŒë ¤ì¤„ ì¤€ë¹„ë¥¼ í•œë‹¤.
     - ì´ ì‹œì ì—ì„œ, ë§Œì•½ ë¦¬ë””ë ‰ì…˜ì´ ë°œìƒí•˜ë©´, ì‚¬ìš©ìëŠ” `/new-route`ë¡œ ìƒˆë¡­ê²Œ ìš”ì²­ì„ ë³´ë‚¸ë‹¤.
  3. **Middleware**
     - ë§Œì•½ 2ë‹¨ê³„ì—ì„œ ë¦¬ë””ë ‰ì…˜ì´ ì¼ì–´ë‚˜ì§€ ì•Šì•˜ë‹¤ë©´, ì´ì œ **ë¯¸ë“¤ì›¨ì–´**ê°€ ì‹¤í–‰ëœë‹¤.
     - ë¯¸ë“¤ì›¨ì–´ëŠ” **"ì´ ìš”ì²­ì´ `/old-route`ë„¤?** ê·¸ëŸ¬ë©´ `/another-route`ë¡œ ì¬ì‘ì„±(Rewrite)í•˜ì"\*\* ê°™ì€ ë¡œì§ì´ ë“¤ì–´ìˆì„ ìˆ˜ ìˆë‹¤.
     - í˜¹ì€ "ë¡œê·¸ì¸í•˜ì§€ ì•Šì•˜ìœ¼ë©´ `/login`ìœ¼ë¡œ ë¦¬ë””ë ‰ì…˜" ê°™ì€ ì¸ì¦ ë¡œì§ì„ ì²˜ë¦¬í•  ìˆ˜ë„ ìˆë‹¤.
  4. **BeforeFiles (Rewrites)**
     - ë¯¸ë“¤ì›¨ì–´ë¥¼ í†µê³¼í•˜ê³  ë‚˜ë©´, **ë¼ìš°íŠ¸ ë§¤ì¹­ ì „ì—** `beforeFiles`ì— ì„¤ì •ëœ **Rewrites**ê°€ ì‹¤í–‰ëœë‹¤.
     - ì—¬ê¸°ì„œë„ **"ì´ ìš”ì²­ì´ `/before-rewrite`ë©´ `/rewritten-before` ê²½ë¡œë¡œ ë°”ê¿”ì¤€ë‹¤"** ê°™ì€ ê·œì¹™ì´ ì ìš©ë  ìˆ˜ ìˆë‹¤.
  5. **íŒŒì¼ ì‹œìŠ¤í…œ ë¼ìš°íŠ¸**
     - ì´ì œ **ì‹¤ì œ** Next.jsì˜ íŒŒì¼ êµ¬ì¡°( `pages/`, `app/`, `public/` ë“±)ë¥¼ í™•ì¸í•œë‹¤.
     - *`/new-route`*ì™€ ë§¤ì¹­ë˜ëŠ” `pages/new-route.js`ê°€ ìˆìœ¼ë©´ ê·¸ í˜ì´ì§€ë¥¼ ë Œë”ë§í•œë‹¤.
     - ë§Œì•½ ë§¤ì¹­ë˜ëŠ” íŒŒì¼ì´ë‚˜ í´ë”ê°€ ì—†ìœ¼ë©´, ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°„ë‹¤.
  6. **AfterFiles (Rewrites)**
     - íŒŒì¼ ì‹œìŠ¤í…œì—ì„œ ë§¤ì¹­ì„ ì°¾ì§€ ëª»í•œ ê²½ìš°ì—ë§Œ **afterFiles**ê°€ ë™ì‘í•œë‹¤.
     - ì—¬ê¸°ì„œë„ ì¬ì‘ì„± ê·œì¹™ì´ ìˆìœ¼ë©´ ì ìš©í•œë‹¤. ì˜ˆ: `/after-rewrite` â†’ `/rewritten-after`.
  7. **ë™ì  ë¼ìš°íŠ¸**
     - ë§Œì•½ ìœ„ ë‹¨ê³„ë¥¼ ëª¨ë‘ í†µê³¼í–ˆì§€ë§Œ, ë™ì  ë¼ìš°íŠ¸(`/blog/[slug]`) ê°™ì€ ê²ƒê³¼ ë§¤ì¹­ë  ìˆ˜ ìˆë‹¤ë©´ ì—¬ê¸°ì„œ ì²˜ë¦¬í•œë‹¤.
     - ì˜ˆ: `/blog/some-post`ê°€ ì‹¤ì œ `/blog/[slug].js` íŒŒì¼ê³¼ ë§¤ì¹­ë˜ì–´ í˜ì´ì§€ë¥¼ ë Œë”ë§í•  ìˆ˜ ìˆë‹¤.
  8. **Fallback (Rewrites)**
     - ëê¹Œì§€ ì•„ë¬´ê²ƒë„ ë§¤ì¹­ë˜ì§€ ì•Šìœ¼ë©´, ë§ˆì§€ë§‰ì— `fallback` ê·œì¹™ì´ ì ìš©ë˜ì–´ ì˜ˆ: `/fallback/anything` â†’ `/404`ë¡œ ì¬ì‘ì„±í•œë‹¤.
     - ìµœì¢…ì ìœ¼ë¡œ **404** í˜ì´ì§€ê°€ ì‘ë‹µëœë‹¤.
  ***
  ## **ì´ ê³¼ì •ì„ ì—°ê²°í•´ ìƒê°í•´ ë³´ê¸°**
  1. **ì‚¬ìš©ì**ê°€ \**`/old-route`*ë¡œ ìš”ì²­
  2. **Headers ë‹¨ê³„**: ì´ ê²½ë¡œì— ì„¤ì •ëœ í—¤ë”ê°€ ìˆìœ¼ë©´ ì ìš©
  3. **Redirects ë‹¨ê³„**: `next.config.js`ì— `/old-route` â†’ `/new-route` ë¦¬ë””ë ‰íŠ¸ ê·œì¹™ì´ ìˆë‹¤ë©´ ë°”ë¡œ 301/307 ì‘ë‹µ
  4. ë§Œì•½ **ë¦¬ë””ë ‰íŠ¸ê°€ ì—†ê±°ë‚˜** ì´ë¯¸ `/new-route`ë¡œ ë°”ë€Œì—ˆìœ¼ë©´, **Middleware**ì—ì„œ ì¶”ê°€ ê²€ì‚¬ ë° ì¬ì‘ì„±
  5. **BeforeFiles**: í˜¹ì‹œ ë˜ ë‹¤ë¥¸ ì¬ì‘ì„± ê·œì¹™ì´ ìˆìœ¼ë©´ ì ìš©
  6. **íŒŒì¼ ì‹œìŠ¤í…œ ë¼ìš°íŠ¸**: `/new-route`ì— í•´ë‹¹í•˜ëŠ” `pages/new-route.js`ë¥¼ ì°¾ì•„ ë Œë”ë§ (ìˆë‹¤ë©´)
  7. **AfterFiles**: ê·¸ë˜ë„ ëª» ì°¾ìœ¼ë©´ afterFilesì˜ ì¬ì‘ì„± ê·œì¹™ í™•ì¸
  8. **ë™ì  ë¼ìš°íŠ¸**: `/blog/[slug]` ê°™ì€ ë™ì  ë¼ìš°íŠ¸ê°€ ë§ì„ ìˆ˜ë„ ìˆìœ¼ë‹ˆ í™•ì¸
  9. **Fallback**: ê²°êµ­ ëª¨ë“  ë‹¨ê³„ì—ì„œ ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ 404ë‚˜ íŠ¹ì • ê²½ë¡œë¡œ ì´ë™
  ì´ë ‡ê²Œ íë¦„ì„ **í•œ ë²ˆì˜ ìš”ì²­**ì— ëŒ€í•´ ìˆœì„œëŒ€ë¡œ ìƒê°í•´ ë³´ë©´:
  1. **"ì´ ìš”ì²­ì— ë§ê²Œ í—¤ë” ì„¸íŒ…í•  ê±° ìˆì–´?"**
  2. **"í˜¹ì‹œ ë°”ë¡œ ë¦¬ë””ë ‰ì…˜ ì‹œí‚¬ ê±°ì•¼?"**
  3. **"ë¯¸ë“¤ì›¨ì–´ì—ì„œ ë™ì  ë¡œì§(ê¶Œí•œ ì²´í¬ ë“±) ì‹¤í–‰í•  ê±° ìˆì–´?"**
  4. **"íŒŒì¼ ì°¾ê¸° ì „ì— URL ì¬ì‘ì„±í•  ê±° ìˆì–´?"**
  5. **"íŒŒì¼ ì‹œìŠ¤í…œì— ì¼ì¹˜í•˜ëŠ” í˜ì´ì§€ë‚˜ ì •ì  íŒŒì¼ ìˆì–´?"**
  6. **"íŒŒì¼ ì—†ìœ¼ë©´ afterFilesì—ì„œ ì¬ì‘ì„±í•  ê±°?"**
  7. **"ë™ì  ë¼ìš°íŠ¸ê°€ ë§¤ì¹­ë˜ëŠ”ì§€ í™•ì¸í• ê¹Œ?"**
  8. **"ì •ë§ ì•„ë¬´ê²ƒë„ ì—†ìœ¼ë©´ fallbackìœ¼ë¡œ 404 ì²˜ë¦¬"**
  ***
  ## **ì •ë¦¬**
  - **ì™œ ì´ ìˆœì„œì¸ì§€**:
    1. ìµœìš°ì„ ì ìœ¼ë¡œ **í—¤ë”** ì„¤ì •,
    2. **ì˜ëª»ëœ ê²½ë¡œ**ë¥¼ ë¹ ë¥´ê²Œ **ë¦¬ë””ë ‰ì…˜**,
    3. **ë¯¸ë“¤ì›¨ì–´**ë¡œ ë™ì  ì²˜ë¦¬,
    4. **ì •ì  ë¼ìš°íŠ¸ ë§¤ì¹­** ì „ì— `beforeFiles`,
    5. **íŒŒì¼ ì‹œìŠ¤í…œ ë§¤ì¹­**,
    6. ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ `afterFiles`,
    7. **ë™ì  ë¼ìš°íŠ¸**,
    8. ë§ˆì§€ë§‰ì— **fallback**.
  - **ì‹¤ë¬´**:
    - ì¸ì¦/ê¶Œí•œ ì²´í¬, ë‹¤êµ­ì–´ ë¦¬ë””ë ‰ì…˜, A/B í…ŒìŠ¤íŠ¸, ë ˆê±°ì‹œ URL ì •ë¦¬, ì •ì  íŒŒì¼ ì„œë¹™, 404 ì²˜ë¦¬ ë“± ë‹¤ì–‘í•œ ë¶€ë¶„ì— ì´ ë¡œì§ì´ í™œìš©ë¨.
    <aside>
    ğŸŒŸ
    
    **ì—­í•  ì •ë¦¬**
    
    - **headers** (next.config.js)
        - ì‘ë‹µ í—¤ë”ë¥¼ ë¯¸ë¦¬ ì„¸íŒ…í•˜ì—¬ **ë³´ì•ˆ, ìºì‹± ì •ì±…** ë“±ì„ ì„¤ì •í•œë‹¤.
    - **redirects** (next.config.js)
        - ì˜ëª»ëœ ê²½ë¡œë¥¼ **ìƒˆë¡œìš´ ê²½ë¡œ**ë¡œ ì´ë™ì‹œì¼œ **SEO**ì™€ **ì‚¬ìš©ì ê²½í—˜**ì„ ê°œì„ í•œë‹¤.
    - **Middleware**
        - ìš”ì²­ì„ ê°€ë¡œì±„ **ì¸ì¦**, **A/B í…ŒìŠ¤íŠ¸**, **ê¶Œí•œ ê²€ì‚¬** ë“±ì„ ë™ì ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.
    - **beforeFiles (rewrites)**
        - íŒŒì¼ ì‹œìŠ¤í…œ ë§¤ì¹­ ì „ **íŠ¹ì • ê²½ë¡œ**ë¥¼ **ìš°ì„ ì ìœ¼ë¡œ** ë‹¤ë¥¸ ê²½ë¡œë¡œ ë°”ê¾¼ë‹¤.
    - **íŒŒì¼ ì‹œìŠ¤í…œ ë¼ìš°íŠ¸**
        - Next.jsì˜ **ê¸°ë³¸ ë¼ìš°íŒ…**ì´ ë™ì‘, `pages/`, `public/` í´ë” ë“±ì—ì„œ ë§¤ì¹­ì„ ì‹œë„í•œë‹¤.
    - **afterFiles (rewrites)**
        - íŒŒì¼ ì‹œìŠ¤í…œ ë§¤ì¹­ ì‹¤íŒ¨ í›„ **ì¶”ê°€ì ìœ¼ë¡œ** ì¬ì‘ì„± ê·œì¹™ì„ ì ìš©í•œë‹¤.
    - **ë™ì  ë¼ìš°íŠ¸**
        - `/blog/[slug]` ê°™ì€ **ë™ì  URL**ì„ ì²˜ë¦¬í•´, ìœ ì—°í•œ ë¼ìš°íŒ… êµ¬í˜„í•œë‹¤.
    - **fallback (rewrites)**
        - ë§ˆì§€ë§‰ê¹Œì§€ ë§¤ì¹­ë˜ì§€ ì•Šìœ¼ë©´ ì´ ê·œì¹™ì´ ì ìš©ë˜ì–´, ë³´í†µ **404** í˜ì´ì§€ë¡œ ì²˜ë¦¬í•œë‹¤.
    </aside>
    
    - ì½”ë“œì™€ í•¨ê»˜ ì´í•´í•˜ê¸°
        
        ## **í´ë” êµ¬ì¡° ì˜ˆì‹œ**
        
        ```lua
        lua
        ë³µì‚¬
        my-next-app/
        â”œâ”€â”€ next.config.js
        â”œâ”€â”€ middleware.ts
        â””â”€â”€ pages/
            â”œâ”€â”€ about.js
            â”œâ”€â”€ new-route.js
            â”œâ”€â”€ rewritten-before.js
            â”œâ”€â”€ rewritten-after.js
            â”œâ”€â”€ fallback/
            â”‚   â””â”€â”€ index.js
            â”œâ”€â”€ blog/
            â”‚   â””â”€â”€ [slug].js
            â””â”€â”€ 404.js
        
        ```
        
        - **`next.config.js`**: Headers, Redirects, Rewrites ì„¤ì •
        - **`middleware.ts`**: ë¯¸ë“¤ì›¨ì–´ ë¡œì§
        - **`pages/`**: íŒŒì¼ ì‹œìŠ¤í…œ ë¼ìš°íŠ¸
            - `about.js`, `new-route.js` ë“±
            - `blog/[slug].js`: ë™ì  ë¼ìš°íŠ¸ ì˜ˆì‹œ
            - `fallback/index.js`: fallback rewrites ì˜ˆì‹œ
            - `404.js`: 404 í˜ì´ì§€
        
        ---
        
        ## **1. next.config.js**
        
        **ì„¤ëª…**
        
        1. **headers:** íŠ¹ì • ê²½ë¡œ(`/about`)ì— ëŒ€í•´ ì‘ë‹µ í—¤ë”ë¥¼ ì„¤ì •.
        2. **redirects:** `/old-route` â†’ `/new-route`ë¡œ ë¦¬ë””ë ‰ì…˜.
        3. **rewrites:**
            - **beforeFiles:** `/before-rewrite` â†’ `/rewritten-before`
            - **afterFiles:** `/after-rewrite` â†’ `/rewritten-after`
            - **fallback:** `/fallback/:path*` â†’ `/404`
        
        ```
        js
        ë³µì‚¬
        // next.config.js
        
        module.exports = {
          async headers() {
            return [
              {
                source: '/about',
                headers: [
                  { key: 'x-custom-header', value: 'my-custom-value' },
                  { key: 'Cache-Control', value: 'public, max-age=3600' },
                ],
              },
            ];
          },
        
          async redirects() {
            return [
              {
                source: '/old-route',
                destination: '/new-route',
                permanent: true, // 301 ë¦¬ë””ë ‰ì…˜
              },
            ];
          },
        
          async rewrites() {
            return {
              // (4) beforeFiles
              beforeFiles: [
                {
                  source: '/before-rewrite',
                  destination: '/rewritten-before',
                },
              ],
              // (6) afterFiles
              afterFiles: [
                {
                  source: '/after-rewrite',
                  destination: '/rewritten-after',
                },
              ],
              // (8) fallback
              fallback: [
                {
                  source: '/fallback/:path*',
                  destination: '/404',
                },
              ],
            };
          },
        };
        
        ```
        
        ### **ì–´ë–¤ ìˆœì„œë¡œ ì ìš©ë˜ëŠ”ê°€?**
        
        1. **headers** â†’ 2. **redirects** â†’ 3. (Middleware) â†’ 4. **beforeFiles** â†’ 5. **íŒŒì¼ ì‹œìŠ¤í…œ ë¼ìš°íŠ¸** â†’ 6. **afterFiles** â†’ 7. **ë™ì  ë¼ìš°íŠ¸** â†’ 8. **fallback**
        
        ---
        
        ## **2. middleware.ts**
        
        **ì„¤ëª…**
        
        - `/redirect-me`ë¡œ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ `/redirected`ë¡œ ë¦¬ë””ë ‰ì…˜
        - `/rewrite-me`ë¡œ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ `/rewritten`ìœ¼ë¡œ ì¬ì‘ì„±
        - ê°„ë‹¨í•œ ì¸ì¦ ë¡œì§ ì˜ˆì‹œ: `auth-token` ì¿ í‚¤ê°€ ì—†ìœ¼ë©´ `/login`ìœ¼ë¡œ ë¦¬ë””ë ‰ì…˜
        
        ```
        ts
        ë³µì‚¬
        // middleware.ts
        import { NextResponse } from 'next/server';
        import type { NextRequest } from 'next/server';
        
        export function middleware(request: NextRequest) {
          const { pathname } = request.nextUrl;
        
          // (3) Middleware ë‹¨ê³„ ì˜ˆì‹œ
          if (pathname === '/redirect-me') {
            // ë¦¬ë””ë ‰ì…˜
            return NextResponse.redirect(new URL('/redirected', request.url));
          }
        
          if (pathname === '/rewrite-me') {
            // ì¬ì‘ì„±
            return NextResponse.rewrite(new URL('/rewritten', request.url));
          }
        
          // ì¸ì¦ ì¿ í‚¤ ìœ ë¬´ í™•ì¸
          if (!request.cookies.has('auth-token') && pathname.startsWith('/member-only')) {
            return NextResponse.redirect(new URL('/login', request.url));
          }
        
          // ë‚˜ë¨¸ì§€ ìš”ì²­ì€ ê·¸ëŒ€ë¡œ ì§„í–‰
          return NextResponse.next();
        }
        
        ```
        
        ---
        
        ## **3. íŒŒì¼ ì‹œìŠ¤í…œ ë¼ìš°íŠ¸ (pages/)**
        
        ### **(5) ì˜ˆì‹œ: /about**
        
        ```
        js
        ë³µì‚¬
        // pages/about.js
        export default function About() {
          return <h1>About Page - í—¤ë”ê°€ ì¶”ê°€ë©ë‹ˆë‹¤.</h1>;
        }
        
        ```
        
        - `/about`ìœ¼ë¡œ ì ‘ê·¼ ì‹œ, `next.config.js`ì˜ `headers` ì„¤ì •ì— ë”°ë¼ **`x-custom-header`*ê°€ ì‘ë‹µ í—¤ë”ë¡œ ì¶”ê°€ë¨.
        
        ### **(5) ì˜ˆì‹œ: /new-route**
        
        ```
        js
        ë³µì‚¬
        // pages/new-route.js
        export default function NewRoute() {
          return <h1>This is the New Route Page</h1>;
        }
        
        ```
        
        - `/old-route` â†’ `/new-route`ë¡œ **ë¦¬ë””ë ‰ì…˜(redirects)**
        - ë¦¬ë””ë ‰ì…˜ í›„ ì—¬ê¸°ì„œ í˜ì´ì§€ë¥¼ ë Œë”ë§.
        
        ### **(5) ì˜ˆì‹œ: /rewritten-before**
        
        ```
        js
        ë³µì‚¬
        // pages/rewritten-before.js
        export default function RewrittenBefore() {
          return <h1>Page Rewritten Before Files</h1>;
        }
        
        ```
        
        - `/before-rewrite` â†’ `/rewritten-before` (**beforeFiles**).
        
        ### **(5) ì˜ˆì‹œ: /rewritten-after**
        
        ```
        js
        ë³µì‚¬
        // pages/rewritten-after.js
        export default function RewrittenAfter() {
          return <h1>Page Rewritten After Files</h1>;
        }
        
        ```
        
        - `/after-rewrite` â†’ `/rewritten-after` (**afterFiles**).
        
        ### **(5) ì˜ˆì‹œ: /redirected**
        
        ```
        js
        ë³µì‚¬
        // pages/redirected.js
        export default function Redirected() {
          return <h1>Redirected by Middleware</h1>;
        }
        
        ```
        
        - ë¯¸ë“¤ì›¨ì–´ì—ì„œ `/redirect-me`ë¥¼ `/redirected`ë¡œ ë¦¬ë””ë ‰ì…˜í–ˆì„ ë•Œ ë Œë”ë§ë˜ëŠ” í˜ì´ì§€.
        
        ### **(5) ì˜ˆì‹œ: /rewritten**
        
        ```
        js
        ë³µì‚¬
        // pages/rewritten.js
        export default function Rewritten() {
          return <h1>Rewritten by Middleware</h1>;
        }
        
        ```
        
        - ë¯¸ë“¤ì›¨ì–´ì—ì„œ `/rewrite-me`ë¥¼ `/rewritten`ìœ¼ë¡œ ì¬ì‘ì„±í–ˆì„ ë•Œ ë Œë”ë§ë˜ëŠ” í˜ì´ì§€.
        
        ### **(7) ë™ì  ë¼ìš°íŠ¸ ì˜ˆì‹œ: /blog/[slug].js**
        
        ```
        js
        ë³µì‚¬
        // pages/blog/[slug].js
        import { useRouter } from 'next/router';
        
        export default function BlogPost() {
          const router = useRouter();
          const { slug } = router.query;
        
          return <h1>Blog Slug: {slug}</h1>;
        }
        
        ```
        
        - `/blog/some-post` ë“± ë™ì  ê²½ë¡œë¥¼ ì²˜ë¦¬í•œë‹¤.
        
        ### **(8) fallback ì˜ˆì‹œ: /fallback/index.js**
        
        ```
        js
        ë³µì‚¬
        // pages/fallback/index.js
        export default function Fallback() {
          return <h1>This is the fallback page</h1>;
        }
        
        ```
        
        - `fallback` ì„¤ì •ì— ë”°ë¼ `/fallback/anything` â†’ `/404` ëŒ€ì‹  `/fallback/index.js`ë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´,
            - ì—¬ê¸°ì„œ ë³„ë„ì˜ í˜ì´ì§€ë¥¼ ë Œë”ë§í•˜ê±°ë‚˜
            - 404 í˜ì´ì§€ë¡œ ì•ˆë‚´í•˜ëŠ” ë¡œì§ì„ ë‘˜ ìˆ˜ ìˆìŒ.
        
        ### **(8) 404 í˜ì´ì§€ ì˜ˆì‹œ: /404.js**
        
        ```
        js
        ë³µì‚¬
        // pages/404.js
        export default function Custom404() {
          return <h1>404 - Page Not Found</h1>;
        }
        
        ```
        
        - **fallback** ë‹¨ê³„ì—ì„œ ìµœì¢…ì ìœ¼ë¡œ ë§¤ì¹­ë˜ì§€ ì•ŠëŠ” ê²½ìš° ì´ í˜ì´ì§€ê°€ ë Œë”ë§ëœë‹¤.
        
        ---
        
        ## **ë™ì‘ ì‹œë‚˜ë¦¬ì˜¤**
        
        1. **/about** â†’ **Headers**
            - `x-custom-header: my-custom-value`ê°€ ì‘ë‹µ í—¤ë”ì— ì¶”ê°€ë¨.
            - ì´í›„ íŒŒì¼ ì‹œìŠ¤í…œ ë¼ìš°íŠ¸(`pages/about.js`) ë Œë”ë§.
        2. **/old-route** â†’ **Redirects**
            - `next.config.js`ì˜ `redirects` ê·œì¹™ìœ¼ë¡œ `/new-route`ë¡œ **301** ë¦¬ë””ë ‰ì…˜.
        3. **/redirect-me** â†’ **Middleware**
            - ë¯¸ë“¤ì›¨ì–´ì—ì„œ `/redirected`ë¡œ **ë¦¬ë””ë ‰ì…˜**, ê²°ê³¼ì ìœ¼ë¡œ `pages/redirected.js` ë Œë”ë§.
        4. **/before-rewrite** â†’ **beforeFiles**
            - íŒŒì¼ ì‹œìŠ¤í…œ ë¼ìš°íŠ¸ë¥¼ í™•ì¸í•˜ê¸° ì „ì— `/rewritten-before`ë¡œ ì¬ì‘ì„±.
            - ìµœì¢…ì ìœ¼ë¡œ `pages/rewritten-before.js` ë Œë”ë§.
        5. **íŒŒì¼ ì‹œìŠ¤í…œ ë¼ìš°íŠ¸**
            - `/images/logo.png` â†’ `public/images/logo.png`
            - `/blog/my-post` â†’ `pages/blog/[slug].js` (ë™ì  ë¼ìš°íŠ¸ ì „í™˜ì€ (7) ë‹¨ê³„ì—ì„œ ì²˜ë¦¬)
        6. **/after-rewrite** â†’ **afterFiles**
            - íŒŒì¼ ì‹œìŠ¤í…œ ë¼ìš°íŠ¸ì™€ ë§¤ì¹­ë˜ì§€ ì•ŠëŠ”ë‹¤ë©´ â†’ `/rewritten-after`ë¡œ ì¬ì‘ì„±
            - `pages/rewritten-after.js` ë Œë”ë§.
        7. **ë™ì  ë¼ìš°íŠ¸**
            - `/blog/[slug]` í˜•íƒœ ìš”ì²­ ì‹œ, **ì •ì  ë¼ìš°íŠ¸**ì— ë§¤ì¹­ë˜ì§€ ì•Šìœ¼ë©´(ë™ì  ë§¤ì¹­) `pages/blog/[slug].js`ê°€ ë Œë”ë§ë¨.
        8. **fallback**
            - ì˜ˆ: `/fallback/any-route`ê°€ ë“¤ì–´ì˜¤ë©´ `/404`ë¡œ ì¬ì‘ì„± â†’ `pages/404.js` ë Œë”ë§
            - ëª¨ë“  ê·œì¹™ì— ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ ì—¬ê¸°ì„œ ìµœì¢…ì ìœ¼ë¡œ ì²˜ë¦¬.

ë¯¸ë“¤ì›¨ì–´ê°€ ì‹¤í–‰ë  ê²½ë¡œë¥¼ ì •ì˜í•˜ëŠ” ë°©ë²•ì—ëŠ” 2ê°€ì§€ê°€ ìˆë‹¤.

1. ì»¤ìŠ¤í…€ ë§¤ì²˜ ì„¤ì •
2. ì¡°ê±´ë¬¸ ì‚¬ìš©

### 6.3.1 Matcher

`matcher` ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ íŠ¹ì • ê²½ë¡œì—ë§Œ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì ìš©í•  ìˆ˜ ìˆë‹¤.

ì •ê·œ í‘œí˜„ì‹ì„ ì™„ì „íˆ ì§€ì›í•˜ë¯€ë¡œ ë¶€ì •í˜• ì „ë°© íƒìƒ‰ ë“± ë¬¸ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

ë‹¨ì¼ ê²½ë¡œ ë˜ëŠ” ë°°ì—´ì„ ì‚¬ìš©í•´ ì—¬ëŸ¬ ê²½ë¡œ ë§¤ì¹­ë„ ê°€ëŠ¥í•˜ë‹¤.

matcher ê°’ì€ ë¹Œë“œ ì‹œì ì— ì •ì ìœ¼ë¡œ ë¶„ì„ ê°€ëŠ¥í•´ì•¼ í•˜ë¯€ë¡œ ìƒìˆ˜ë¡œ ì„ ì–¸í•´ì•¼ í•œë‹¤. ë³€ìˆ˜ ê°™ì€ ë™ì  ê°’ì€ ë¬´ì‹œëœë‹¤.

í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ„í•´ Next.jsëŠ” í•­ìƒ `/public` ì„ `/public/index` ë¡œ ì·¨ê¸‰í•œë‹¤. ë”°ë¼ì„œ , `/public/:path` ë§¤ì²˜ëŠ” ì •ìƒì ìœ¼ë¡œ ë§¤ì¹­ëœë‹¤.

**Configured matchers ì œì•½ ì¡°ê±´:**

- ë¬´ì¡°ê±´ `/`ë¡œ ì‹œì‘í•´ì•¼ í•¨
- \*ì´ë¦„ ìˆëŠ” íŒŒë¼ë¯¸í„°(named parameters)\*\*ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒì˜ˆ) `/about/:path`ëŠ” `/about/a`ì™€ `/about/b`ë¥¼ ë§¤ì¹­í•˜ì§€ë§Œ `/about/a/c`ëŠ” ë§¤ì¹­í•˜ì§€ ì•ŠìŒ
- \*íŒŒë¼ë¯¸í„°ì— ìˆ˜ì •ì(modifier)\*\*ë¥¼ ë¶™ì¼ ìˆ˜ ìˆìŒ
  - ``: 0ê°œ ì´ìƒ
  - `?`: 0ê°œ ë˜ëŠ” 1ê°œ
  - `+`: 1ê°œ ì´ìƒì˜ˆ) `/about/:path*`ëŠ” `/about/a/b/c`ë„ ë§¤ì¹­
- **ì •ê·œ í‘œí˜„ì‹ì„ ê´„í˜¸ë¡œ ê°ì‹¸ì„œ ì‚¬ìš© ê°€ëŠ¥**ì˜ˆ) `/about/(.*)`ëŠ” `/about/:path*`ì™€ ë™ì¼

```tsx
// íŠ¹ì • ê²½ë¡œë¥¼ ì œì™¸í•˜ê³  ëª¨ë‘ ë§¤ì¹­í•˜ëŠ” ì˜ˆì‹œ
export const config = {
  matcher: ["/((?!api|_next/static|_next/image|favicon.ico).*)"],
};

export const config = {
  matcher: [
    {
      source: "/((?!api|_next/static|_next/image|favicon.ico).*)",
      missing: [
        { type: "header", key: "next-router-prefetch" },
        { type: "header", key: "purpose", value: "prefetch" },
      ],
    },
    {
      source: "/((?!api|_next/static|_next/image|favicon.ico).*)",
      has: [
        { type: "header", key: "next-router-prefetch" },
        { type: "header", key: "purpose", value: "prefetch" },
      ],
    },
    {
      source: "/((?!api|_next/static|_next/image|favicon.ico).*)",
      has: [{ type: "header", key: "x-present" }],
      missing: [{ type: "header", key: "x-missing", value: "prefetch" }],
    },
  ],
};
```

### 6.3.2 ì¡°ê±´ë¬¸ ì‚¬ìš©

```tsx
// middleware.ts
import { NextResponse } from "next/server";
import type { NextRequest } from "next/server";

export function middleware(request: NextRequest) {
  if (request.nextUrl.pathname.startsWith("/about")) {
    return NextResponse.rewrite(new URL("/about-2", request.url));
  }

  if (request.nextUrl.pathname.startsWith("/dashboard")) {
    return NextResponse.rewrite(new URL("/dashboard/user", request.url));
  }
}
```

## 6.4 NextResponse

`NextResponse` APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ìŒ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

1. redirect: ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ë‹¤ë¥¸ URLë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
2. rewrite: íŠ¹ì • URLì„ í‘œì‹œí•˜ë„ë¡ ì‘ë‹µ ì¬ì‘ì„±
3. ìš”ì²­ í—¤ë” ì„¤ì •: API Routes, getServerSideProps, rewrite ëŒ€ìƒ ë“±ì— í—¤ë” ì¶”ê°€
4. ì‘ë‹µ ì¿ í‚¤ ì„¤ì •
5. ì‘ë‹µ í—¤ë” ì„¤ì •

ë¯¸ë“¤ì›¨ì–´ì—ì„œ ì‘ë‹µì„ ìƒì„±í•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

- ë‹¤ë¥¸ ë¼ìš°íŠ¸(í˜ì´ì§€ë‚˜ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬)ë¡œ rewrite í•´ì„œ, ê·¸ ë¼ìš°íŠ¸ê°€ ì‘ë‹µì„ ìƒì„±í•˜ë„ë¡ í•¨
- `NextResponse` ë¥¼ ì§ì ‘ ë°˜í™˜

## 6.5 ì¿ í‚¤ ì‚¬ìš©

ì¿ í‚¤ëŠ” ì¼ë°˜ì ì¸ í—¤ë”ì— ì†í•œë‹¤. ìš”ì²­ì—ì„œëŠ” `Cookie` í—¤ë”ë¥¼ í†µí•´, ì‘ë‹µì—ì„œëŠ” `Set-Cookie` í—¤ë”ë¥¼ í†µí•´ ì „ë‹¬ëœë‹¤.

Next.jsëŠ” `NextRequest`ì™€ `NextResponse`ì˜ cookies í™•ì¥ì„ í†µí•´ ì¿ í‚¤ë¥¼ ì‰½ê²Œ ë‹¤ë£° ìˆ˜ ìˆëŠ” APIë¥¼ ì œã…ê³µí•œë‹¤.

- **ë“¤ì–´ì˜¤ëŠ” ìš”ì²­**: `request.cookies`
  - `get`, `getAll`, `set`, `delete`, `has`, `clear` ë“±ì˜ ë©”ì„œë“œ
- **ë‚˜ê°€ëŠ” ì‘ë‹µ**: `response.cookies`
  - `get`, `getAll`, `set`, `delete` ë©”ì„œë“œ

```tsx
// middleware.ts
import { NextResponse } from "next/server";
import type { NextRequest } from "next/server";

export function middleware(request: NextRequest) {
  // ì˜ˆ: "Cookie: nextjs=fast" í—¤ë”ê°€ ìš”ì²­ì— í¬í•¨ë˜ì–´ ìˆë‹¤ê³  ê°€ì •
  let cookie = request.cookies.get("nextjs");
  console.log(cookie); // => { name: 'nextjs', value: 'fast', Path: '/' }
  const allCookies = request.cookies.getAll();
  console.log(allCookies); // => [{ name: 'nextjs', value: 'fast' }]

  request.cookies.has("nextjs"); // => true
  request.cookies.delete("nextjs");
  request.cookies.has("nextjs"); // => false

  // ì‘ë‹µì— ì¿ í‚¤ë¥¼ ì„¤ì •
  const response = NextResponse.next();
  response.cookies.set("vercel", "fast");
  response.cookies.set({
    name: "vercel",
    value: "fast",
    path: "/",
  });
  cookie = response.cookies.get("vercel");
  console.log(cookie); // => { name: 'vercel', value: 'fast', Path: '/' }
  // ìµœì¢… ì‘ë‹µ í—¤ë”ì— `Set-Cookie: vercel=fast; path=/`ê°€ ì¶”ê°€ë¨

  return response;
}
```

## 6.6 í—¤ë” ì„¤ì •

`NextResponse` APë¥¼ ì‚¬ìš©í•´ ìš”ì²­ ë° ì‘ë‹µ í—¤ë”ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤. (v13ë¶€í„°)

```tsx
// middleware.ts
import { NextResponse } from "next/server";
import type { NextRequest } from "next/server";

export function middleware(request: NextRequest) {
  // ìš”ì²­ í—¤ë” ë³µì‚¬ í›„, `x-hello-from-middleware1` í—¤ë”ë¥¼ ì¶”ê°€
  const requestHeaders = new Headers(request.headers);
  requestHeaders.set("x-hello-from-middleware1", "hello");

  // NextResponse.rewriteì—ì„œ ìš”ì²­ í—¤ë”ë¥¼ ì„¤ì •í•  ìˆ˜ë„ ìˆìŒ
  const response = NextResponse.next({
    request: {
      headers: requestHeaders,
    },
  });

  // ì‘ë‹µ í—¤ë” `x-hello-from-middleware2` ì„¤ì •
  response.headers.set("x-hello-from-middleware2", "hello");
  return response;
}
```

ì£¼ì˜: ë„ˆë¬´ í° í—¤ë”ë¥¼ ì„¤ì •í•˜ë©´ 431 Request Header Fields Too Large ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆì–´, ì„œë²„ ì„¤ì •ì— ë”°ë¼ ì£¼ì˜ê°€ í•„ìš”í•˜ë‹¤.

## 6.7 CORS

ë¯¸ë“¤ì›¨ì–´ì—ì„œ CORS í—¤ë”ë¥¼ ì„¤ì •í•´ êµì°¨ ì¶œì²˜ ìš”ì²­ì„ í—ˆìš©í•  ìˆ˜ ìˆë‹¤.

íŠ¹ì • ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œë„ CORS í—¤ë”ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

```tsx
// middleware.ts
import { NextRequest, NextResponse } from "next/server";

const allowedOrigins = ["https://acme.com", "https://my-app.org"];

const corsOptions = {
  "Access-Control-Allow-Methods": "GET, POST, PUT, DELETE, OPTIONS",
  "Access-Control-Allow-Headers": "Content-Type, Authorization",
};

export function middleware(request: NextRequest) {
  // ìš”ì²­ì˜ Origin í™•ì¸
  const origin = request.headers.get("origin") ?? "";
  const isAllowedOrigin = allowedOrigins.includes(origin);

  // ì‚¬ì „ ìš”ì²­(OPTIONS) í™•ì¸
  const isPreflight = request.method === "OPTIONS";

  if (isPreflight) {
    const preflightHeaders = {
      ...(isAllowedOrigin && { "Access-Control-Allow-Origin": origin }),
      ...corsOptions,
    };
    return NextResponse.json({}, { headers: preflightHeaders });
  }

  // ì¼ë°˜ ìš”ì²­ ì²˜ë¦¬
  const response = NextResponse.next();

  if (isAllowedOrigin) {
    response.headers.set("Access-Control-Allow-Origin", origin);
  }

  Object.entries(corsOptions).forEach(([key, value]) => {
    response.headers.set(key, value);
  });

  return response;
}

export const config = {
  matcher: "/api/:path*",
};
```

## 6.8 ì‘ë‹µ ìƒì„±

ë¯¸ë“¤ì›¨ì–´ì—ì„œ ì§ì ‘ ì‘ë‹µì„ë°˜í™˜í•˜ë ¤ë©´, `Response` ë˜ëŠ” `NextResponse` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•˜ë¼. (v.13.1.0ë¶€í„° ê°€ëŠ¥)

```tsx
// middleware.ts
import { NextRequest } from "next/server";
import { isAuthenticated } from "@lib/auth";

// /api/ ê²½ë¡œë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ìš”ì²­ì—ë§Œ ë¯¸ë“¤ì›¨ì–´ ì ìš©
export const config = {
  matcher: "/api/:function*",
};

export function middleware(request: NextRequest) {
  // ì¸ì¦ í•¨ìˆ˜ë¡œ ìš”ì²­ í™•ì¸
  if (!isAuthenticated(request)) {
    // JSON ì‘ë‹µì„ ì§ì ‘ ë°˜í™˜ (401)
    return Response.json(
      { success: false, message: "authentication failed" },
      { status: 401 }
    );
  }
}
```

## 6.9 waitUntilê³¼ NextFetchEvent

`NextFetchEvent` ê°ì²´ëŠ” ê¸°ë³¸ FetchEventë¥¼ í™•ì¥í•˜ë©°, `waitUntil()` ë©”ì„œë“œë¥¼ ì œê³µí•œë‹¤.

- waitUntil ì€ í”„ë¼ë¯¸ìŠ¤ë¥¼ ì¸ìë¡œ ë°›ì•„, ê·¸ í”„ë¼ë¯¸ìŠ¤ê°€ resolveë  ë•Œê¹Œì§€ ë¯¸ë“¤ì›¨ì–´ ìˆ˜ëª…ì„ í™•ì¥í•œë‹¤.
- ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ”ë° ìœ ìš©í•˜ë‹¤.

```tsx
import { NextResponse } from "next/server";
import type { NextFetchEvent, NextRequest } from "next/server";

export function middleware(req: NextRequest, event: NextFetchEvent) {
  event.waitUntil(
    fetch("https://my-analytics-platform.com", {
      method: "POST",
      body: JSON.stringify({ pathname: req.nextUrl.pathname }),
    })
  );

  return NextResponse.next();
}
```

## 6.10 ê³ ê¸‰ ë¯¸ë“¤ì›¨ì–´ í”Œë˜ê·¸

v13.1ì—ì„œ ë‘ê°€ì§€ ì¶”ê°€ í”Œë˜ê·¸ê°€ ë¯¸ë“¤ì›¨ì–´ì— ë„ì…ëë‹¤.

### 1. skipTrailingSlashRedirect

Next.jsì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ URLì— ìŠ¬ë˜ì‹œê°€ ëˆ„ë½ë˜ì—ˆê±°ë‚˜ ê³¼ë„í•˜ê²Œ ë¶™ì€ ê²½ìš° ìë™ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ë¥¼ ìˆ˜í–‰í•œë‹¤.

ì´ ì˜µì…˜ì´ í™œì„±í™”ë˜ë©´ ìœ„ ë™ì‘ì„ ë„ê³ , ë¯¸ë“¤ì›¨ì–´ ë‚´ë¶€ì—ì„œ ì§ì ‘ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

```tsx
module.exports = {
  skipTrailingSlashRedirect: true,
};
```

```tsx
const legacyPrefixes = ["/docs", "/blog"];

export default async function middleware(req) {
  const { pathname } = req.nextUrl;

  if (legacyPrefixes.some((prefix) => pathname.startsWith(prefix))) {
    return NextResponse.next();
  }

  // íŠ¸ë ˆì¼ë§ ìŠ¬ë˜ì‹œ ì²˜ë¦¬
  if (
    !pathname.endsWith("/") &&
    !pathname.match(/((?!\.well-known(?:\/.*)?)(?:[^/]+\/)*[^/]+\.\w+)/)
  ) {
    req.nextUrl.pathname += "/";
    return NextResponse.redirect(req.nextUrl);
  }
}
```

### 2. skipMiddlewareUrlNormalize

ì´ ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ Next.jsì˜ URL ì •ê·œí™”ë¥¼ ë¹„í™œì„±í™”í•˜ì—¬, ì§ì ‘ ë°©ë¬¸ê³¼ í´ë¼ì´ì–¸íŠ¸ ì „í™˜ ê°„ ë™ì‘ì„ ë™ì¼í•˜ê²Œ ì²˜ë¦¬í• ìˆ˜ ìˆë‹¤.

## 6.11 ëŸ°íƒ€ì„

ë¯¸ë“¤ì›¨ì–´ëŠ” í˜„ì¬ ì—£ì§€ ëŸ°íƒ€ì„ë§Œ ì§€ì›í•œë‹¤.
