# 1. Project Organization and File Colocation

라우팅 폴더 및 파일 규칙 외에, Next.js는 프로젝트 파일을 구성하거나 배치하는 방식에 대해 특별한 의견을 제시하지 않는다.

이 파트는 프로젝트를 구성하는데 사용할 수 있는 기본 동작과 기능을 공유한다.

## 1.1 안전한 파일 배치 (기본 동작)

`app` 디렉토리안에, 중첩된 폴더 계층이 라우트 구조를 정의한다.

각 폴더들은 라우트 세그먼트를 나타내며, 이는 URL 경로의 해당 세그먼트에 매핑된다.

하지만, 라우트 세그먼트는 page.js 또는 route.js 파일이 추가되기 전까지 해당 라우트는 공개적으로 접근할 수 없다.

- 라우트가 공개적으로 접근 가능하려면 해당 세그먼트 이름의 폴더에 page.js or route.js 파일 존재해야함.
- 라우트가 공개되어도, page.js or route.js 파일이 반환하는 내용만 클라이언트에 전달됨.
  - 다른 파일명은 노출 안됨.

<aside>
🌟

알아두면 좋은 점

- pages 디렉토리와 app 디렉토리는 다르다. pages 디렉토리 내의 모든 파일은 라우트로 간주된다.
- 파일을 app 디렉토리 내에 배치할 수는 있으나, 그렇게 해야만 하는 것은 아니다. 원한다면, app 디렉토리 밖에 배치할 수도 있다.
</aside>

## 1.2 프로젝트 구조화 기능

### 1.2.1 비공개 폴더

폴더 이름 앞에 `_` 를 붙여 비공개 폴더 생성.

라우팅 시스템에서 제외되며, 해당 폴더와 하위 폴더들은 라우팅에서 제외된다.

- UI 로직과 라우팅 로직을 분리할 때
- 프로젝트 및 Next.js 생태계 전반에서 내부 파일을 일관되게 구성할 때
- 코드 에디터에서 파일을 정렬하거나 그룹화할 때
- 향후 Next.js 파일 컨벤션과 잠재적 네이밍 충돌 방지

<aside>
🌟

알아두면 좋은 점

- 프레임워크의 관례는 아니지만, 비공개 폴더 외부에 있는 파일도 동일한 밑줄(`_`) 패턴을 사용하여 "비공개"로 표시하는 것을 고려할 수 있다.
- URL 세그먼트가 밑줄로 시작해야 하는 경우, 폴더 이름에 URL 인코딩된 값인 `%5F`를 붙여 사용할 수 있다. `%5FfolderName`
</aside>

### 1.2.2 라우트 그룹

폴더 이름을 괄호로 감싸면 라우트 그룹을 생성할 수 있다.

구조적 목적으로만 사용되며, 라우트의 URL 경로에 포함되지 않음을 나타낸다.

- 사이트 섹션, 의도, 팀별로 라우트를 그룹화
- 동일한 세그먼트 레벨 내에서 중첩된 레이아웃 생성
  - 여러 중첩 레이아웃 생성
  - 공통 세그먼트 내 일부 라으트에 레이아웃 추가

### 1.2.3 `src` 디렉토리

Next.js는 애플리케이션 코드(`app` 을 포함해서)를 선택적으로 src 디렉토리 안에 저장하는 것을 지원한다.

이는 프로젝트 설정 파일(주로 루트에 위치)과 애플리케이션 코드를 분리한다.

### 1.2.4 module path aliases (모듈 경로 별칭)

Next.js는 모듈 경로에 대한 별칭을 정의할 수 있어, 깊이 중첩된 파일 간의 import를 읽고 유지 관리하기 쉽게 만든다.

## 프로젝트 구조화 전략

프로젝트 파일과 폴더를 구성하는 데 있어 정답은 없다.

중요한 점은 팀과 자신에게 적합한 전략을 선택하고 일관성을 유지하는 것이다.

1. app 디렉토리 외부에 프로젝트 파일 저장

- 모든 코드를 프로젝트 루트에 공유 폴더로 저장하고, app 하위는 순전히 라우팅 목적으로만 사용

1. app 내부의 상위 폴더에 프로젝트 파일 저장

   - 모든 코드를 app 폴더 내부의 공유 폴더에 저장

2. 기능 또는 라우트 별로 프로젝트 파일 분리

   - 전역적으로 공유되는 코드는 루트 app 폴더에 저장하고, 더 구체적인 코드는 이를 사용하는 라우트 세그먼트로 나누어 저장

# 2. Dynamic Routes

동적 라우팅은 특정 경로 세그먼트 이름을 알 수 없을 때 사용한다. 동적 데이터로부터 생성된 경로를 생성하고, 요청 시점에 세그먼트를 채우거나 빌드 시점에 프리 렌더링할 수 있다.

## 2.1 컨벤션

동적 세그먼트는 폴더 이름을 대괄호로 감싸는 방식으로 생성할 수 있다.

- [id]
- [slug]

동적 세그먼트는 `layout` , `page`, `route`, 그리고 `generateMetadata` 함수에 props로 전달된다.

### 예시

블로그 프로젝트를 예로 들면, `app/blog/[slug]/page.js` 경로에서 `[slug]` 는 블로그 게시글의 동적 세그먼트 역할을 한다.

```jsx
export default function Page({ params }: { params: { slug: string } }) {
  return <div>My Post: {params.slug}</div>;
}
```

## 2.2 정적 매개변수(Static Params) 생성

`generateStaticParams` 함수는 동적 세그먼트와 함께 사용하여 빌드 시점에 정적 경로를 생성할 수 있다.

```jsx
// app/blog/[slug]/page.tsx

export async function generateStaticParams() {
  const posts = await fetch("https://.../posts").then((res) => res.json());

  return posts.map((post) => ({
    slug: post.slug,
  }));
}
```

`generateStaticParams` 함수의 장점은 fetch 요청을 통해 가져온 데이터를 자동으로 메모이제이션 해준다는 것이다. 동일한 인수에 대해서 `generateStaticParams`, layouts, pages에서 호출될 경우 한 번만 요청된다.

## 2.3 Catch-all Segments

`[...folderName]` 와 같이 대괄호 내부에 줄임표 (…)를 추가하면 특정 세그먼트 이후 모든 경로를 포착할 수 있다.

`app/shop/[...slug]/page.js` 는 아래와 같은 경로와 매칭된다.

- `/shop/clothes`
- `/shop/clothes/tops`
- `/shop/clothes/tops/t-shirts` 등

| **Route**                    | **Example URL** | **`params`**                |
| ---------------------------- | --------------- | --------------------------- |
| `app/shop/[...slug]/page.js` | `/shop/a`       | `{ slug: ['a'] }`           |
| `app/shop/[...slug]/page.js` | `/shop/a/b`     | `{ slug: ['a', 'b'] }`      |
| `app/shop/[...slug]/page.js` | `/shop/a/b/c`   | `{ slug: ['a', 'b', 'c'] }` |

## 2.4 Optional Catch-all Segments

Catch-All 세그먼트를 선택적으로 만들려면 대괄호를 한 번 더 감싸 `[[...folderName]]` 형태로 정의한다.

:`app/shop/[[...slug]]/page.js`는 다음과 같은 경로와 매칭된다.

- `/shop`
- `/shop/clothes`
- `/shop/clothes/tops`
- `/shop/clothes/tops/t-shirts`

### 차이점

- Catch-All: 매개변수가 필요. (`/shop` 은 매칭되지 않음)
- Optional Catch-All: 매개변수가 없어도 경로가 매칭. (`/shop` 포함)

| **Route**                      | **Example URL** | **`params`**                |
| ------------------------------ | --------------- | --------------------------- |
| `app/shop/[[...slug]]/page.js` | `/shop`         | `{}`                        |
| `app/shop/[[...slug]]/page.js` | `/shop/a`       | `{ slug: ['a'] }`           |
| `app/shop/[[...slug]]/page.js` | `/shop/a/b`     | `{ slug: ['a', 'b'] }`      |
| `app/shop/[[...slug]]/page.js` | `/shop/a/b/c`   | `{ slug: ['a', 'b', 'c'] }` |

## 2.5 TypeScript

설정한 라우트 세그먼트에 따라 params 타입을 정의한다.

| **Route**                           | **`params` Type Definition**             |
| ----------------------------------- | ---------------------------------------- |
| `app/blog/[slug]/page.js`           | `{ slug: string }`                       |
| `app/shop/[...slug]/page.js`        | `{ slug: string[] }`                     |
| `app/shop/[[...slug]]/page.js`      | `{ slug?: string[] }`                    |
| `app/[categoryId]/[itemId]/page.js` | `{ categoryId: string, itemId: string }` |
