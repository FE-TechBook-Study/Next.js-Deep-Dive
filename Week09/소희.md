# TypeScript

Next.js는 React 애플리케이션을 개발할 때 TypeScript 우선 환경을 제공한다.

기본적으로 TypeScript를 지원하며, 필요한 패키지를 자동으로 설치하고 적절한 설정을 구성해준다.

또한, 개발 환경을 돕기 위한 TypeScript 플러그인이 포함되어 있어 ide에서도 사용할 수 있다.

## TypeScript 플러그인

Next.js는 VS Code 및 기타 코드 편집기에서 사용 가능한 커스텀 TypeScript 플러그인과 타입 검사기를 포함하고 있다.

### VS Code에서 TypeScript 플러그인 활성화하기

1. **명령 팔레트(Command Palette) 열기**

   `Ctrl` + `Shift` + `P` (Windows) 또는 `⌘` + `Shift` + `P` (Mac)

2. **"TypeScript: Select TypeScript Version" 검색**
3. **"Use Workspace Version" 선택**

이제 파일을 편집하면 Next.js 의 TypeScript 플러그인이 활성화도니다.

또한 next build를 실행할 때, Next.js의 커스텀 타입 검사기가 사용된다.

### **플러그인이 제공하는 기능**

- **올바르지 않은 설정 값**을 사용하면 경고 표시
- **사용 가능한 옵션과 문서 제공**
- `"use client"` 지시어가 올바르게 사용되었는지 검사
- `useState`, `useEffect` 같은 **클라이언트 훅이 Client Components에서만 사용되도록 검사**

## **TypeScript 최소 버전**

TypeScript **v4.5.2 이상**을 사용하는 것이 권장된다.

이 버전 이상을 사용하면 **import 이름의 타입 수정 기능** 및 **성능 향상** 등의 혜택을 받을 수 있다.

## **정적 타입 검사(Statically Typed Links)**

Next.js는 `next/link`를 사용할 때 **링크 URL의 타입 검사를 지원**하여 잘못된 경로 입력을 방지한다.

이 기능을 사용하려면 **`experimental.typedRoutes` 옵션을 활성화해야 한다.**

**`next.config.js` 설정 예시**

```jsx
/** @type {import('next').NextConfig} */
const nextConfig = {
  experimental: {
    typedRoutes: true,
  },
};

module.exports = nextConfig;
```

### **타입이 적용된 링크 사용 예시**

Next.js는 `.next/types` 내부에 **모든 유효한 라우트 정보를 포함한 타입 정의 파일**을 자동으로 생성한다.

```tsx

import type { Route } from 'next';
import Link from 'next/link';

// ✅ 올바른 라우트 (TypeScript 오류 없음)
<Link href="/about" />
<Link href="/blog/nextjs" />
<Link href={`/blog/${slug}`} />
<Link href={('/blog' + slug) as Route} />

// ❌ 잘못된 라우트 (TypeScript 오류 발생)
<Link href="/aboot" />

```

### **사용자 정의 컴포넌트에서 타입 지정**

사용자 정의 컴포넌트에서 `next/link`를 감싸는 경우, 제네릭(Generic)을 활용해 `href`의 타입을 지정할 수 있다.

```tsx
import type { Route } from "next";
import Link from "next/link";

function Card<T extends string>({ href }: { href: Route<T> | URL }) {
  return (
    <Link href={href}>
      <div>My Card</div>
    </Link>
  );
}
```

## **엔드 투 엔드 타입 안정성(End-to-End Type Safety)**

Next.js의 **App Router**는 데이터의 타입 안정성을 강화했다.

- **데이터를 직렬화할 필요 없음:**
  서버에서 데이터를 가져올 때 `Date`, `Map`, `Set` 등의 객체를 변환할 필요 없이 사용할 수 있다.
- **컴포넌트 간 데이터 흐름이 간소화됨:**`_app.js` 없이 **루트 레이아웃을 사용**하므로 데이터 흐름이 더 명확해졌다.

### **타입 안정성이 적용된 데이터 가져오기 예시**

```tsx
async function getData() {
  const res = await fetch("https://api.example.com/...");
  return res.json(); // 직렬화 없이 바로 사용 가능
}

export default async function Page() {
  const name = await getData();
  return "...";
}
```

---

## **비동기 Server Component 타입 오류 해결**

**TypeScript v5.1.3 이상과 @types/react v18.2.8 이상**을 사용해야 `Promise<Element>` 오류를 방지할 수 있다.

## **경로 별칭(Path Aliases) 및 baseUrl 설정**

Next.js는 `tsconfig.json`에서 **"paths"** 및 **"baseUrl"** 옵션을 자동으로 지원한다.

## **next.config.js에서 TypeScript 검사**

`next.config.js`는 JavaScript 파일이므로 TypeScript에서 직접 검사되지 않는다.

대신 **JSDoc 주석**을 사용하면 일부 타입 검사를 수행할 수 있다.

```jsx
// @ts-check

/**
 * @type {import('next').NextConfig}
 **/
const nextConfig = {
  /* 설정 옵션 */
};

module.exports = nextConfig;
```

## **점진적 타입 검사(Incremental Type Checking)**

Next.js v10.2.1부터 **점진적 타입 검사**가 추가되었으며, `tsconfig.json`에서 활성화할 수 있다.

이 기능은 **대규모 프로젝트에서 타입 검사 속도를 향상**시키는 데 유용하다.

## **TypeScript 오류 무시하기**

Next.js는 **TypeScript 오류가 있는 상태에서 `next build`를 실행하면 빌드를 중단**한다.

하지만, **위험을 감수하고라도 빌드를 강제로 진행**할 수도 있다.

**`next.config.js` 설정 예시**

```jsx
module.exports = {
  typescript: {
    // !! 경고 !!
    // TypeScript 오류가 있어도 빌드가 강제 완료됨
    ignoreBuildErrors: true,
  },
};
```

💡 **주의:**

이 옵션을 활성화하면 **타입 오류를 놓칠 위험이 크므로** 빌드 또는 배포 프로세스에서 타입 검사를 따로 실행해야 한다.

## **사용자 정의 타입 선언**

Next.js는 자동으로 `next-env.d.ts` 파일을 생성하지만, 이 파일을 직접 수정하면 **덮어씌워지므로** 새로운 타입 파일을 별도로 만들어야 한다.

```jsx
// tsconfig.json
{
  "compilerOptions": {
    "skipLibCheck": true},
  "include": [
    "new-types.d.ts",
    "next-env.d.ts",
    ".next/types/**/*.ts",
    "**/*.ts",
    "**/*.tsx"
  ],
  "exclude": ["node_modules"]
}
```
