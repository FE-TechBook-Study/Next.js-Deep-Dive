# 하린

# 개요

구글이 웹사이트 사용자 경험을 평가하기 위해 제안한 웹 품질 평가 지료로 Core Web Vitals는 LCP, INP, CLS로 구성됩니다.

이 지표들은 사용자 경험과 직결되며, SEO에도 영향을 미칩니다.

# 1. LCP(Largest Contentful Paint)

페이지에서 가장 큰 콘텐츠가 로드되는 시점을 측정하는 로딩 성능 지표.

사용자가 웹 사이트를 방문했을 때 주요 콘텐츠가 얼마나 빨리 표시되는지 나타냅니다.

- 좋은 점수 : 2.5s 이하
- 개선 필요 : 2.5s ~ 4.0s
- 나쁜 점수 : 4.0s 초과

## 1.1 측정 대상

- `<img />` 요소
- `<svg />` 요소 내의 `<image />` 요소
- `<video>` 요소(포스터 이미지 또는 첫 프레임)
- URL()로 로드된 배경 이미지가 있는 요소
- 텍스트 노드가 포함된 블록 수준 요소

## 1.2 LCP 분석

네트워크 폭포식 다이어그램으로 LCP 요소를 렌더링하는 데 이미지 요청이 필요한 일반적인 페이지의 리소스를 시각화할 수 있습니다.

<img width="800" alt="Image" src="https://github.com/user-attachments/assets/7b68f696-bce3-4ffe-9c1a-e0276f800308" />

_4개의 LCP 하위 카테고리_

최적화된 페이지의 경우 LCP 리소스 요청이 최대한 빨리 로드되도록 하고 LCP 리소스 로드가 완료된 후 LCP 요소가 최대한 빨리 렌더링되도록 해야 합니다. 특정 페이지가 이 원칙을 준수하는지 시각화하려면 총 LCP 시간을 다음 하위 부분으로 분류할 수 있습니다.

1. [첫 바이트까지의 시간 (TTFB)](https://web.dev/articles/ttfb?hl=ko)

   사용자가 페이지 로드를 시작한 시점부터 브라우저가 HTML 문서 응답의 첫 번째 바이트를 수신할 때까지의 시간입니다.

2. 리소스 로드 지연

   TTFB와 브라우저가 LCP 리소스 로드를 시작하는 시점 사이의 시간입니다. LCP 요소를 렌더링하는 데 리소스 로드가 필요하지 않은 경우 (예: 요소가 시스템 글꼴로 렌더링된 텍스트 노드인 경우) 이 시간은 0입니다.

3. 리소스 로드 시간

   LCP 리소스 자체를 로드하는 데 걸리는 시간입니다. LCP 요소를 렌더링하는 데 리소스 로드가 필요하지 않은 경우 이 시간은 0입니다.

4. 요소 렌더링 지연

   LCP 리소스 로드가 완료된 시점과 LCP 요소가 완전히 렌더링된 시점 사이의 시간입니다.

LCP를 최적화할 때는 이러한 하위 부분을 개별적으로 모두 최적화하는 것이 좋습니다.

예를 들어, 이미지를 더 압축하거나 더 최적화된 형식 (예: AVIF 또는 WebP)으로 전환하여 이미지의 파일 크기를 줄이면 **리소스 로드 시간**은 줄어들지만 시간이 **요소 렌더링 지연** 하위 부분으로 이동하기 때문에 실제로 LCP는 개선되지 않습니다.

<img width="800" alt="Image" src="https://github.com/user-attachments/assets/4ed39406-f398-40b8-8580-fca7c7401eac" />

_리소스 로드 시간을 줄이면 LCP가 감소하지 않고 요소 렌더링 지연이 증가_

## 1.3 최적의 하위 부분 시간

하위 부분 4개 중 2개에는 이름에 '지연'이라는 단어가 포함되어 있습니다. 이 시간을 최대한 0에 가깝게 유지해야 히고, 나머지 두 부분은 본질적으로 시간이 걸리는 네트워크 요청과 관련이 있습니다.

| LCP 하위 파트        | LCP 비율 |
| -------------------- | -------- |
| 첫 바이트까지의 시간 | ~40%     |
| 리소스 로드 지연     | 10% 미만 |
| 리소스 로드 시간     | ~40%     |
| 요소 렌더링 지연     | 10% 미만 |
| **합계**             | **100%** |

이러한 시간 분류는 가이드라인일 뿐이며 엄격한 규칙이 아닙니다. 페이지의 LCP 시간이 2.5초 이내에 일관되게 유지되는 경우 상대 비율은 중요하지 않습니다. 하지만 '지연' 부분 중 하나에서 불필요하게 많은 시간을 소비하면 [2.5초 타겟](https://web.dev/articles/lcp?hl=ko#what_is_a_good_lcp_score)을 지속적으로 달성하기가 매우 어려워집니다.

## 1.4 각 부분 최적화 방법

### 리소스 로드 지연 제거

LCP 리소스(주요 이미지나 텍스트 블록)가 최대한 빨리 로드되도록 해야 합니다. 이상적으로는 페이지의 첫 번째 리소스와 동시에 로드되어야 합니다.

1. 리소스 발견 시점 최적화 : LCP 요소를 초기 HTML 마크업에 직접 포함시켜 브라우저의 preload scanner가 즉시 발견할 수 있도록 합니다.

   - 이미지는 `<img>` 태그로 직접 포함시키고, CSS 배경 이미지나 웹 글꼴은 `<link rel="preload">`로 미리 로드합니다.
   - JavaScript로 동적 삽입되는 이미지, 지연 로드 라이브러리 사용, CSS 배경 이미지는 브라우저가 즉시 발견하지 못하므로 피해야 합니다.

1. 리소스 우선순위 최적화 : LCP 요소일 가능성이 높다고 생각되면 `fetchpriority="high"` 속성을 추가하여 브라우저에 중요성을 알립니다.

   ```html
   <img fetchpriority="high" src="/path/to/hero-image.webp" />
   ```

   - 중요하지 않은 이미지(예: 초기 화면에 보이지 않는 캐러셀 슬라이드)에는 `fetchpriority="low"`를 설정합니다.
   - 가능하면 LCP 리소스를 HTML 문서와 동일한 출처에 호스팅하여 연결 설정 시간을 절약합니다.

<img width="800" alt="Image" src="https://github.com/user-attachments/assets/c4890033-1106-423c-82e2-8f0599d6ad09" />

_LCP 리소스가 스타일 시트와 동시에 로드_

### 요소 렌더링 지연 제거

리소스 로드가 완료된 후 LCP 요소가 즉시 렌더링될 수 있도록 해야 합니다.

1. 렌더링 차단 스타일시트 최적화

   HTML 마크업에서 로드된 스타일 시트는 그 뒤에 오는 모든 콘텐츠의 렌더링을 차단합니다. 일반적으로 스타일이 지정되지 않은 HTML을 렌더링하고 싶지 않으므로 이는 좋은 점입니다. 그러나 스타일 시트가 너무 커서 LCP 리소스보다 로드하는 데 훨씬 더 오래 걸리는 경우 다음 예와 같이 리소스 로드가 완료된 후에도 LCP 요소가 렌더링되지 않습니다.

   <img width="800" alt="Image" src="https://github.com/user-attachments/assets/4d227f4d-ae55-475b-a345-591b22f77187" />

   _스타일 시트가 준비될 때까지 이미지를 렌더링할 수 없다._

   해결하려면

   - 작은 스타일시트는 HTML에 인라인으로 포함하여 추가 네트워크 요청을 방지합니다.
   - 스타일시트가 큰 경우, 크기를 줄이는 방법:
     - 사용하지 않는 CSS 제거
     - 비중요 CSS를 지연 로드
     - CSS 축소 및 압축

2. 렌더링 차단 JavaScript 최적화

   - `<head>`에 동기식 스크립트는 가능한 피합니다.
   - 필수 스크립트는 매우 작은 경우에만 인라인으로 포함합니다.
   - 그 외에는 `async` 또는 `defer` 속성을 사용합니다.

3. 서버 사이드 렌더링(SSR) 활용

   - SSR은 이미지 리소스가 HTML 소스에서 바로 발견되고, 페이지 렌더링 전에 추가 JavaScript 요청이 필요하지 않도록 합니다.
   - 정적 사이트 생성(SSG) 또는 사전 렌더링도 비슷한 효과를 제공합니다.

4. 긴 작업 분할
   - 기본 스레드를 차단하는 대용량 JavaScript 파일은 이미지가 다운로드되어도 렌더링을 지연시킬 수 있습니다.
   - 복잡한 JavaScript 로직을 작은 청크로 분할하여 기본 스레드 차단을 최소화합니다.

### 리소스 로드 시간 줄이기

네트워크를 통해 리소스의 바이트를 사용자 기기로 전송하는 데 걸리는 시간을 최적화합니다.

1. 리소스 크기 줄이기
   - 이미지 최적화:
     - 적절한 크기의 이미지 제공
     - WebP, AVIF 같은 최신 이미지 형식 사용
     - 효율적인 압축 적용
   - 웹 글꼴 크기 줄이기:
     - WOFF2 압축 형식 사용
2. 리소스 전송 거리 줄이기
   - CDN(콘텐츠 전송 네트워크)을 활용하여 사용자와 지리적으로 가까운 곳에서 리소스 제공
   - 이미지 CDN은 전송 거리를 줄이면서 자동으로 크기 최적화도 제공
3. 네트워크 대역폭 경합 줄이기
   - 중요 리소스에 높은 우선순위를 부여하고 불필요한 리소스 로드를 최소화
   - 초기 로드에 필요하지 않은 리소스는 지연 로드
4. 네트워크 요청 제거
   - 효율적인 캐시 제어 정책으로 반복 방문 시 네트워크 요청을 줄입니다.
   - 웹 글꼴의 경우 `font-display` 속성을 `auto` or `block` 이외의 값으로 조정하여 렌더링 차단을 방지합니다.
   - 매우 작은 리소스는 데이터 URL로 인라인 처리하여 추가 요청을 제거합니다.

### 첫 바이트까지의 시간(TTFB) 줄이기

초기 HTML을 최대한 빨리 전송하도록 최적화합니다.

### TTFB 개선 방법

- 리디렉션 최소화: 광고나 단축 URL을 통한 다중 리디렉션은 TTFB를 크게 늘립니다.
- CDN 캐싱 최적화: 불필요한 URL 매개변수를 피하고 효율적인 캐싱 전략을 사용합니다.
- 서버 처리 시간 단축: 데이터베이스 쿼리 최적화, 애플리케이션 로직 간소화, 서버 리소스 확장
- HTTP/2 또는 HTTP/3 사용: 최신 프로토콜로 연결 효율성 향상

## 2. INP(Interaction to Next Paint)

상호작용에 대한 페이지의 전반적인 응답성을 평가하는 지표

사용자가 페이지를 방문하는 전체 기간 동안 발생하는 클릭, 탭, 키보드 상호작용의 지연 시간을 관찰하는 방식으로 측정됩니다. 최종 INP 값은 관찰된 가장 긴 상호작용을 기준으로 합니다.

- 좋은 점수 : 200ms 이하
- 개선 필요 : 200ms ~ 500ms
- 나쁜 점수 : 500ms 초과

세가지 지표

- 입력 지연
- 처리 시간
- 표시 지연

## 3. CLS(Cumulative Layout Shift)

페이지 로드 과정에서 예기치 않은 레이아웃 이동을 측정하는 시각적 안정성 지표

예를 들어, 사용자가 읽던 문장이 갑자기 밀려나거나, 버튼 위치가 바뀌어 잘못 클릭되는 현상 등이 CLS의 사례에 해당합니다.

- 좋은 점수 : 0.1 이하
- 개선 필요 : 0.1 ~ 0.25
- 나쁜 점수 : 0.25 초과
