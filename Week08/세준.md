# íŒ¨í‚¤ì§€ ë²ˆë“¤ë§ ìµœì í™”

ì„œë²„ ì»´í¬ë„ŒíŠ¸ì™€ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ ë‚´ë¶€ì—ì„œ ê°€ì ¸ì˜¨ íŒ¨í‚¤ì§€ëŠ” ìë™ìœ¼ë¡œ ë²ˆë“¤ë§ëœë‹¤.

## ìë°”ìŠ¤í¬ë¦½íŠ¸ ë²ˆë“¤ë§ ë¶„ì„

[`@next/bundle-analyzer`](https://www.npmjs.com/package/@next/bundle-analyzer)Â ë¡œ ë²ˆë“¤ë§ ë¶„ì„ ê°€ëŠ¥ ìì„¸í•œê±´ ë¬¸ì„œ ë³´ë„ë¡â€¦!

## í•„ìš”í•œ ëª¨ë“ˆë§Œ ë²ˆë“¤ë§

ì¼ë¶€ íŒ¨í‚¤ì§€(ì•„ì´ì½˜, ìœ í‹¸ë¦¬í‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ ë“±)ëŠ” ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ëª¨ë“ˆì„ í¬í•¨í•  ìˆ˜ ìˆìŒ

ê·¸ë˜ì„œ ì‹¤ì œë¡œ ì‚¬ìš©í•˜ëŠ” ëª¨ë“ˆë§Œ ë²ˆë“¤ë§í•˜ì—¬ ìµœì í™” ê°€ëŠ¥

`optimizePackageImports` ì˜µì…˜ì„ í†µí•´ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ë§Œ ë²ˆë“¤ë§ë˜ë„ë¡ ìµœì í™”.

```tsx
// next.config.js

const nextConfig = {
  experimental: {
    optimizePackageImports: ['icon-library'], // ìµœì í™”í•  íŒ¨í‚¤ì§€ ì§€ì •
  },
};
```

ê¸°ë³¸ì ìœ¼ë¡œ ë²ˆë“¤ë§ì„ ìµœì í™”í•´ì£¼ëŠ” íŒ¨í‚¤ì§€ëŠ” ë‹¤ìŒ ë§í¬ë¥¼ í†µí•´ í™•ì¸ ê°€ëŠ¥

[next.config.js: optimizePackageImports](https://nextjs.org/docs/app/api-reference/config/next-config-js/optimizePackageImports)

## ì„œë²„ ì „ìš© íŒ¨í‚¤ì§€ë¥¼ ë²ˆë“¤ì—ì„œ ì œì™¸í•˜ê¸°

ì¼ë°˜ì ìœ¼ë¡œ ë„¥ìŠ¤íŠ¸ì—ì„œëŠ” ì„œë²„ ì»´í¬ë„ŒíŠ¸ì™€ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ì‚¬ìš©ëœ íŒ¨í‚¤ì§€ë¥¼ ìë™ìœ¼ë¡œ ë²ˆë“¤ë§í•¨.

í•˜ì§€ë§Œ íŠ¹ì • íŒ¨í‚¤ì§€ë¥¼ ë²ˆë“¤ì—ì„œ ì œì™¸í•˜ê³  ì„œë²„ì—ì„œ ì§ì ‘ ë¡œë“œí•˜ëŠ” ê²ƒì´ íš¨ìœ¨ì ì¼ ìˆ˜ë„ ìˆìŒ.

ì´ë¥¼ í†µí•´ ì„œë²„ì—ì„œ ì§ì ‘ ë¡œì»¬ `node_modules`ì—ì„œ ë¶ˆëŸ¬ì˜¤ë„ë¡ ì„¤ì • ê°€ëŠ¥

`serverExternalPackages` ì˜µì…˜ì„ í†µí•´ ì„¤ì • ê°€ëŠ¥

```tsx
const nextConfig = {
  serverExternalPackages: ['package-name'],
};
```

ë§ˆì°¬ê°€ì§€ë¡œ ê¸°ë³¸ì ìœ¼ë¡œ ì„¤ì •í•´ì£¼ëŠ” íŒ¨í‚¤ì§€ë“¤ì´ ìˆìŒ.

[next.config.js: serverExternalPackages](https://nextjs.org/docs/app/api-reference/config/next-config-js/serverExternalPackages)

# Lazy Loading

ì§€ì—°ë¡œë”©ì„ í†µí•´ ì´ˆê¸° ë¡œë”© ì„±ëŠ¥ì„ ê°œì„ í•  ìˆ˜ ìˆìŒ.

í•„ìš”í•  ë•Œë§Œ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì™€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë²ˆë“¤ì„ ìš”ì²­í•˜ëŠ” í˜•íƒœ

## `next/dynamic`

`next/dynamic`ì€ `React.lazy()`ì™€ `Suspense`ì˜ ê¸°ëŠ¥ì„ í•©ì¹œ ê²ƒ

```tsx
'use client';

import { useState } from 'react';
import dynamic from 'next/dynamic';

// í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ ë™ì  ë¡œë”©
const ComponentA = dynamic(() => import('../components/A'));
const ComponentB = dynamic(() => import('../components/B'));
const ComponentC = dynamic(() => import('../components/C'), { ssr: false });

export default function ClientComponentExample() {
  const [showMore, setShowMore] = useState(false);

  return (
    <div>
      {/* ì¦‰ì‹œ ë¡œë“œë˜ì§€ë§Œ ë³„ë„ì˜ í´ë¼ì´ì–¸íŠ¸ ë²ˆë“¤ë¡œ ë¶„ë¦¬ë¨ */}
      <ComponentA />

      {/* showMore ê°’ì´ trueì¼ ë•Œë§Œ ë¡œë“œë¨ (ì¡°ê±´ë¶€ ë¡œë”©) */}
      {showMore && <ComponentB />}
      <button onClick={() => setShowMore(!showMore)}>Toggle</button>

      {/* í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œë§Œ ë¡œë“œë¨ (SSR ë¹„í™œì„±í™”) */}
      <ComponentC />
    </div>
  );
}
```

## SSR ë¹„í™œì„±í™”

`next/dynamic`ì€ ê¸°ë³¸ì ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ê°€ ì„œë²„ì—ì„œ ì‚¬ì „ ë Œë”ë§ë¨.

SSRì„ ë¹„í™œì„±í™”í•˜ë ¤ë©´ `ssr:false` ì˜µì…˜ ì‚¬ìš©. ì„œë²„ ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” ì§€ì›í•˜ì§€ ì•ŠìŒ

```tsx
const ComponentC = dynamic(() => import('../components/C'), { ssr: false });
```

## ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë™ì  ë¡œë”©

`import()`ë¥¼ í†µí•´ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•  ë•Œë§Œ ë¡œë“œí•  ìˆ˜ ìˆìŒ.

```tsx
'use client';

import { useState } from 'react';

const names = ['Tim', 'Joe', 'Bel', 'Lee'];

export default function Page() {
  const [results, setResults] = useState();

  return (
    <div>
      <input
        type="text"
        placeholder="Search"
        onChange={async e => {
          const { value } = e.currentTarget;
          // fuse.jsë¥¼ ë™ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
          const Fuse = (await import('fuse.js')).default;
          const fuse = new Fuse(names);

          setResults(fuse.search(value));
        }}
      />
      <pre>Results: {JSON.stringify(results, null, 2)}</pre>
    </div>
  );
}
```

## Fallback UI

`Suspense`ì˜ `fallback`ì²˜ëŸ¼ ë¡œë”© í‘œì‹œí•  UIë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŒ

```tsx
// ë¡œë”© UIë¥¼ í¬í•¨í•œ ë™ì  ë¡œë”©
const WithCustomLoading = dynamic(
  () => import('../components/WithCustomLoading'),
  {
    loading: () => <p>Loading...</p>, // ë¡œë”© ì¤‘ì¼ ë•Œ í‘œì‹œí•  UI
  },
);
```

## Named Export ë™ì  ë¡œë”©

ê¸°ë³¸ ë‚´ë³´ë‚´ê¸°(`export default`)ê°€ ì•„ë‹Œ ì´ë¦„ ë‚´ë³´ë‚´ê¸°(`export {}`)ë¡œ ì •ì˜ëœ ì»´í¬ë„ŒíŠ¸ë„ ë™ì ìœ¼ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ.

**`Named Export`**

```tsx
'use client';

export function Hello() {
  return <p>Hello!</p>;
}
```

**`Dynamic Import`**

```tsx
import dynamic from 'next/dynamic';

// Named Export ë™ì  ë¡œë”©
const ClientComponent = dynamic(() =>
  import('../components/hello').then(mod => mod.Hello),
);
```

# Analytics

Next.jsì˜ `useReportWebVitals` í›…ì„ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ ì„±ëŠ¥ ë°ì´í„°ë¥¼ ì¸¡ì •

- `â€œuse clientâ€` ì‚¬ìš©
- ì»´í¬ë„ŒíŠ¸ë¥¼ ë”°ë¡œ ë¹¼ì„œ ë£¨íŠ¸ ë ˆì´ì•„ì›ƒì—ì„œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ ê¶Œì¥

```tsx
'use client';

import { useReportWebVitals } from 'next/web-vitals';

export function WebVitals() {
  useReportWebVitals(metric => {
    console.log(metric); // ì„±ëŠ¥ ì§€í‘œë¥¼ ì½˜ì†”ì— ì¶œë ¥
  });
}
```

**`ì„±ëŠ¥ ë°ì´í„° ê°œë³„ ì²˜ë¦¬ ë°©ë²•`**

```tsx
'use client';

import { useReportWebVitals } from 'next/web-vitals';

export function WebVitals() {
  useReportWebVitals(metric => {
    switch (metric.name) {
      case 'FCP': {
        console.log('FCP ì¸¡ì •ê°’:', metric.value);
        break;
      }
      case 'LCP': {
        console.log('LCP ì¸¡ì •ê°’:', metric.value);
        break;
      }
      case 'CLS': {
        console.log('CLS ì¸¡ì •ê°’:', metric.value);
        break;
      }
      case 'INP': {
        console.log('INP ì¸¡ì •ê°’:', metric.value);
        break;
      }
      default:
        console.log(metric.name, metric.value);
    }
  });
}
```

# Instrumentation

- ì„œë²„ ìš”ì²­ ì¶”ì 
- ë¡œê¹…
- ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

## Instrumentation ì„¤ì • ë°©ë²•

- ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— `instrumentation.ts` ìƒì„±. src ì‚¬ìš©í•˜ëŠ” ê²½ìš° í•´ë‹¹ í´ë” ë‚´ë¶€ì— ë°°ì¹˜
- `register` í•¨ìˆ˜ ì •ì˜.
  - `instrumentation.ts` íŒŒì¼ ë‚´ì—ì„œ `register` í•¨ìˆ˜ë¥¼ ë‚´ë³´ë‚´ì•¼í•¨
  - Next.js ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ê°€ ì‹œì‘ë  ë•Œ í•œ ë²ˆ í˜¸ì¶œë¨

## ì‚¬ì´ë“œ ì´í™íŠ¸ ìˆëŠ” íŒŒì¼ ê°€ì ¸ì˜¤ê¸°

ì „ì—­ ë³€ìˆ˜ ì„¤ì • ë˜ëŠ” ì´ˆê¸°í™” ì½”ë“œ ì‹¤í–‰ ë“±ì˜ ë¶€ì‘ìš©ì„ ì¼ìœ¼í‚¤ëŠ” ê²½ìš° `import`ë¥¼ `register` í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ê¶Œì¥ëœë‹¤ê³  í•œë‹¤.

**`ì˜ˆì‹œë¡œ ì„¼íŠ¸ë¦¬ ì„¤ì •`**

- `@sentry/nextjs`ê°€ ìë™ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ë©´ì„œ Next.js ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì˜¤ë¥˜ë¥¼ ê°ì§€í•˜ê³  ë¡œê¹…
- `register()` í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ `import`ë¥¼ ì‹¤í–‰í•˜ë©´, í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ë©° ë¶ˆí•„ìš”í•œ ê¸€ë¡œë²Œ importë¥¼ ë°©ì§€

```tsx
export async function register() {
  await import('@sentry/nextjs');
}
```

## ëŸ°íƒ€ì„ í™˜ê²½ë³„ë¡œ ë‹¤ë¥¸ ì½”ë“œ ì‹¤í–‰

Edgeì™€ Node ê°ê°ì˜ í™˜ê²½ì—ì„œ ì‹¤í–‰ë  ì½”ë“œë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŒ.

```tsx
export async function register() {
  if (process.env.NEXT_RUNTIME === 'nodejs') {
    await import('./instrumentation-node'); // Node.js ì „ìš© ë¡œê¹… ì„¤ì •
  }

  if (process.env.NEXT_RUNTIME === 'edge') {
    await import('./instrumentation-edge'); // Edge ì „ìš© ë¡œê¹… ì„¤ì •
  }
}
```

# public í´ë” ì •ì  íŒŒì¼

Next.jsëŠ” ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì˜ `public` í´ë” ë‚´ì— ìœ„ì¹˜í•œ ì •ì  íŒŒì¼ì„ ì œê³µ

`public` í´ë” ì•ˆì— ìˆëŠ” íŒŒì¼ë“¤ì€ `ê¸°ë³¸ URL(/)`ì„ ê¸°ì¤€ìœ¼ë¡œ ì§ì ‘ ì°¸ì¡°í•  ìˆ˜ ìˆìŒ

## ì˜ˆì‹œ

`public/avatars/me.pn`g íŒŒì¼ì„ ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ `/avatars/me.png` ê²½ë¡œë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆìŒ

```tsx
import Image from 'next/image';

export function Avatar({ id, alt }) {
  return <Image src={`/avatars/${id}.png`} alt={alt} width="64" height="64" />;
}

export function AvatarOfMe() {
  return <Avatar id="me" alt="A portrait of me" />;
}
```

## ì •ì  íŒŒì¼ ìºì‹±

`public` í´ë”ì— ìˆëŠ” íŒŒì¼ì„ ì•ˆì „í•˜ê²Œ ìºì‹±í•  ìˆ˜ ì—†ìŒ. ì™œëƒí•˜ë©´ í•´ë‹¹ íŒŒì¼ë“¤ì´ ì–¸ì œë“ ì§€ ë³€ê²½ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì„.

ê·¸ë˜ì„œ ë‹¤ìŒê³¼ ê°™ì€ ìºì‹± í—¤ë”ê°€ ê¸°ë³¸ì ìœ¼ë¡œ ì ìš©ë¨.

```tsx
Cache-Control: public, max-age=0
```

## ì •ì  ë©”íƒ€ë°ì´í„° íŒŒì¼ ê´€ë¦¬

`robots.txt`, `favicon.ico` ê°™ì€ íŒŒì¼ë“¤ì€ app í´ë” ë‚´ë¶€ì—ì„œ ê´€ë¦¬í•˜ëŠ”ê²Œ ì¢‹ìŒ

# ë©”ëª¨ë¦¬ ì‚¬ìš© ìµœì í™”

Nextjs ë©”ëª¨ë¦¬ ìµœì í™” ì „ëµì— ëŒ€í•´ ì•„ë¼ë³´ìŸˆ.

## 1. ì¢…ì†ì„± ì¤„ì´ê¸°

- ë§ì€ ì˜ì¡´ì„± í¬í•¨í•˜ë©´ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëŠ˜ìŒ.
- ë²ˆë“¤ ë¶„ì„ê¸°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¶ˆí•„ìš”í•œ ì¢…ì†ì„±ì„ ì°¾ì•„ ì œê±°
- `@next/bundle-analyzer`

## 2. ì›¹íŒ© ë©”ëª¨ë¦¬ ìµœì í™” í™œì„±í™”

- nextjs.15ë¶€í„° `experimental.webpackMemoryOptimizations` ì˜µì…˜ ì‚¬ìš© ê°€ëŠ¥
- ì´ ì˜µì…˜ í™œì„±í™”í•˜ë©´ ìµœëŒ€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¤„ì–´ë“¤ì§€ë§Œ, ì»´íŒŒì¼ ì‹œê°„ì´ ì•½ê°„ ì¦ê°€í•  ìˆ˜ ìˆìŒ

```tsx
/** @type {import('next').NextConfig} */
const nextConfig = {
  experimental: {
    webpackMemoryOptimizations: true,
  },
};

module.exports = nextConfig;
```

## 3. next build ì‹¤í–‰ ì‹œì— ë©”ëª¨ë¦¬ ì‚¬ìš© ë””ë²„ê¹…

- ì´ ì˜µì…˜ í™œì„±í™”í•˜ë©´ ë¹Œë“œ ì¤‘ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì§€ì†ì ìœ¼ë¡œ ì¶œë ¥
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì„¤ì •ëœ í•œê³„ì— ê°€ê¹Œì›Œì§ˆ ê²½ìš° ìë™ìœ¼ë¡œ í™ ìŠ¤ëƒ…ìƒ· ìƒì„±

```tsx
next build --experimental-debug-memory-usage
```

## 4. í™ ìŠ¤ëƒ…ìƒ· ë¶„ì„

Chrome DevToolsì—ì„œ ë””ë²„ê¹… í¬íŠ¸ë¡œ ì—°ê²°í•˜ì—¬ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë¶„ì„

ë¶„ì„ ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ìŒ.

1. `chrome://inspect` í˜ì´ì§€ë¡œ ì´ë™
2. `Target` ëª©ë¡ì—ì„œ `Next.js` í”„ë¡œì„¸ìŠ¤ë¥¼ ì°¾ì•„ **"Inspect" í´ë¦­**
3. **"Memory" íƒ­ì—ì„œ "Take Heap Snapshot" ë²„íŠ¼ì„ í´ë¦­**í•˜ì—¬ í™ ìŠ¤ëƒ…ìƒ·ì„ ê¸°ë¡

```tsx
NODE_OPTIONS=--inspect next build
```

## 5. ì›¹íŒ© ë¹Œë“œ ì›Œì»¤ ì‚¬ìš©

ì›¹íŒ© ë¹Œë“œ ì›Œì»¤ë¥¼ ì‚¬ìš©í•˜ë©´ ì›¹íŒ© ì»´íŒŒì¼ì„ ë³„ë„ì˜ Node.js ì›Œì»¤ì—ì„œ ì‹¤í–‰í•˜ì—¬ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¤„ì„

- 14ë²„ì „ ì´ìƒì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”
- ì›¹íŒ© ì»¤ìŠ¤í…€í•˜ê²Œ ì„¤ì •í–ˆë‹¤ë©´ ë‹¤ìŒ ì˜µì…˜ ì¶”ê°€í•´ì•¼í•¨

```tsx
const nextConfig = {
  experimental: {
    webpackBuildWorker: true,
  },
};
```

## 6. ì›¹íŒ© ìºì‹œ ë¹„í™œì„±í™”

ì›¹íŒ©ì€ ëª¨ë“ˆì„ ë©”ëª¨ë¦¬ ë˜ëŠ” ë””ìŠ¤í¬ì— ìºì‹œí•˜ì—¬ ë¹Œë“œ ì†ë„ë¥¼ í–¥ìƒì‹œí‚¤ì§€ë§Œ, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¦ê°€

- `dev` ëª¨ë“œì—ì„œëŠ” ìºì‹œë¥¼ ìœ ì§€
- í”„ë¡œë•ì…˜ ëª¨ë“œì—ì„œëŠ” ë©”ëª¨ë¦¬ ìºì‹œë¥¼ ë¹„í™œì„±í™”

```tsx
/** @type {import('next').NextConfig} */
const nextConfig = {
  webpack: (config, { dev }) => {
    if (config.cache && !dev) {
      config.cache = Object.freeze({
        type: 'memory',
      });
    }
    return config;
  },
};

export default nextConfig;
```

## 7. ì •ì  ë¶„ì„ ë¹„í™œì„±í™”

íƒ€ì… ì²´í¬ì™€ ë¦°íŠ¸ ê²€ì‚¬ë¡œ ì¸í•œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¦ê°€í•˜ë¯€ë¡œ ë¡œì»¬ ë¹Œë“œì—ì„œëŠ” ë¹„í™œì„±í™”

```tsx
/** @type {import('next').NextConfig} */
const nextConfig = {
  eslint: {
    ignoreDuringBuilds: true,
  },
  typescript: {
    ignoreBuildErrors: true, // ğŸš¨ í”„ë¡œë•ì…˜ ë¹Œë“œì—ì„œ íƒ€ì… ì˜¤ë¥˜ë¥¼ ë¬´ì‹œí•˜ë¯€ë¡œ ì£¼ì˜ í•„ìš”
  },
};

export default nextConfig;
```

## 8. ì†ŒìŠ¤ë§µ ìƒì„± ë¹„í™œì„±í™”

ì†ŒìŠ¤ë§µ ìƒì„±ì„ ë¹„í™œì„±í™”
