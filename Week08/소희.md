# Bundle Analyzer

@next/bundle-analyzerëŠ” Next.jsì—ì„œ ìë°”ìŠ¤í¬ë¦½íŠ¸ ëª¨ë“ˆì˜ í¬ê¸°ë¥¼ ê´€ë¦¬í•˜ëŠ” ë° ë„ì›€ì´ ë˜ëŠ” í”ŒëŸ¬ê·¸ì¸ì´ë‹¤.

ì´ í”ŒëŸ¬ê·¸ì¸ì€ ê° ëª¨ë“ˆê³¼ í•´ë‹¹ ì¢…ì†ì„±ì˜ í¬ê¸°ì— ëŒ€í•œ ì‹œê°ì  ë³´ê³ ì„œë¥¼ ìƒì„±í•œë‹¤.

ì´ ì •ë³´ë¥¼ í™œìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

- **í° ì¢…ì†ì„± ì œê±°**
- **ì½”ë“œ ë¶„í•  (Code Splitting)**
- **ì¼ë¶€ ëª¨ë“ˆë§Œ ë¡œë“œí•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ì†¡ë˜ëŠ” ë°ì´í„°ëŸ‰ ê°ì†Œ**

### ì„¤ì¹˜

```jsx
npm i @next/bundle-analyzer
# ë˜ëŠ”
yarn add @next/bundle-analyzer
# ë˜ëŠ”
pnpm add @next/bundle-analyzer
```

### **next.config.js ì„¤ì •**

```jsx
const withBundleAnalyzer = require("@next/bundle-analyzer")({
  enabled: process.env.ANALYZE === "true",
});

/** @type {import('next').NextConfig} */
const nextConfig = {};

module.exports = withBundleAnalyzer(nextConfig);
```

ìœ„ ì½”ë“œì—ì„œ í™˜ê²½ ë³€ìˆ˜ ANALYZEë¥¼ trueë¡œ ì„¤ì •í•´ì•¼ ë²ˆë“¤ ë¶„ì„ì´ ì‹¤í–‰ëœë‹¤.

### ë²ˆë“¤ ë¶„ì„ ì‹¤í–‰í•˜ê¸°

```jsx
ANALYZE=true npm run build
# ë˜ëŠ”
ANALYZE=true yarn build
# ë˜ëŠ”
ANALYZE=true pnpm build
```

ëª…ë ¹ì–´ ì‹¤í–‰ í›„ ë¸Œë¼ìš°ì €ì—ì„œ ì„¸ ê°œì˜ ìƒˆ íƒ­ì´ ì—´ë¦¬ë©° ë²ˆë“¤ ë¶„ì„ ë³´ê³ ì„œë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

ê°œë°œ ì¤‘ ë˜ëŠ” ë°°í¬ ì „ì— ì •ê¸°ì ìœ¼ë¡œ ë²ˆë“¤ í¬ê¸°ë¥¼ ë¶„ì„í•˜ë©´ í° ë²ˆë“¤ì„ ì¡°ê¸°ì— ì‹ë³„í•  ìˆ˜ ìˆìœ¼ë©°,

ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë” ì„±ëŠ¥ ìµœì í™”ëœ êµ¬ì¡°ë¡œ ì„¤ê³„í•  ìˆ˜ ìˆë‹¤.

# Lazy Loading

Next.jsì—ì„œ **Lazy Loading(ì§€ì—° ë¡œë”©)**ì€ ì´ˆê¸° í˜ì´ì§€ ë¡œë”© ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ëŠ” ê¸°ë²•ìœ¼ë¡œ, íŠ¹ì • ë¼ìš°íŠ¸(Route)ë¥¼ ë Œë”ë§í•˜ëŠ” ë° í•„ìš”í•œ **JavaScriptì˜ ì–‘ì„ ì¤„ì´ëŠ” ì—­í• **ì„ í•œë‹¤.

ì´ë¥¼ í†µí•´ **í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸(Client Components)ì™€ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬(Imported Libraries)ì˜ ë¡œë”©ì„ ì§€ì—°**ì‹œí‚¬ ìˆ˜ ìˆìœ¼ë©°,

í•´ë‹¹ ìš”ì†Œê°€ ì‹¤ì œë¡œ í•„ìš”í•  ë•Œë§Œ í´ë¼ì´ì–¸íŠ¸ ë²ˆë“¤ì— í¬í•¨ë˜ë„ë¡ í•  ìˆ˜ ìˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ëª¨ë‹¬ ì°½ì„ ì‚¬ìš©ì í´ë¦­ ì‹œì—ë§Œ ë¡œë“œí•˜ë„ë¡ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

## **Next.jsì—ì„œ Lazy Loadingì„ êµ¬í˜„í•˜ëŠ” ë‘ ê°€ì§€ ë°©ë²•**

1. **next/dynamicì„ ì‚¬ìš©í•œ ë™ì  import (Dynamic Imports with `next/dynamic`)**
2. **React.lazy()ì™€ Suspenseë¥¼ í™œìš©í•œ ë°©ë²•**

> ê¸°ë³¸ì ìœ¼ë¡œ **ì„œë²„ ì»´í¬ë„ŒíŠ¸(Server Components)**ëŠ” ìë™ìœ¼ë¡œ ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…ì´ ì´ë£¨ì–´ì§€ë©°,
>
> ìŠ¤íŠ¸ë¦¬ë°(Streaming) ê¸°ëŠ¥ì„ í™œìš©í•´ UIë¥¼ ì ì§„ì ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ì— ì „ì†¡í•  ìˆ˜ ìˆë‹¤.
>
> í•˜ì§€ë§Œ **Lazy Loadingì€ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸(Client Components)ì— ì ìš©ëœë‹¤.**

## 1. `next/dynamic` ì„ ì‚¬ìš©í•œ Lazy Loading

`next/dynamic`ì€ **React.lazy()ì™€ Suspenseì˜ ì¡°í•©**ìœ¼ë¡œ,

**app ë””ë ‰í† ë¦¬**ì™€ **pages ë””ë ‰í† ë¦¬**ì—ì„œ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ë™ì‘í•˜ì—¬ ì ì§„ì ì¸ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ê°€ëŠ¥í•˜ê²Œ í•œë‹¤.

### `next/dynamic` ì„ ì‚¬ìš©í•œ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ ë™ì  ê°€ì ¸ì˜¤ê¸°

`app/page.js`

```jsx
"use client"; // í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ ì„¤ì •

import { useState } from "react";
import dynamic from "next/dynamic";

// í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ ë™ì  import
const ComponentA = dynamic(() => import("../components/A"));
const ComponentB = dynamic(() => import("../components/B"));
const ComponentC = dynamic(() => import("../components/C"), { ssr: false });

export default function ClientComponentExample() {
  const [showMore, setShowMore] = useState(false);

  return (
    <div>
      {/* ì¦‰ì‹œ ë¡œë“œë˜ì§€ë§Œ ë³„ë„ì˜ í´ë¼ì´ì–¸íŠ¸ ë²ˆë“¤ë¡œ ë¡œë“œë¨ */}
      <ComponentA />

      {/* íŠ¹ì • ì¡°ê±´ì´ ì¶©ì¡±ë  ë•Œë§Œ ë¡œë“œë¨ */}
      {showMore && <ComponentB />}
      <button onClick={() => setShowMore(!showMore)}>Toggle</button>

      {/* ì˜¤ì§ í´ë¼ì´ì–¸íŠ¸ì—ì„œë§Œ ë¡œë“œë¨ (SSR ë¹„í™œì„±í™”) */}
      <ComponentC />
    </div>
  );
}
```

### SSR ê±´ë„ˆë›°ê¸°

ê¸°ë³¸ì ìœ¼ë¡œ **React.lazy() ë° Suspenseë¥¼ ì‚¬ìš©í•˜ë©´ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ê°€ ìë™ìœ¼ë¡œ SSRëœë‹¤.**

í•˜ì§€ë§Œ íŠ¹ì • ì»´í¬ë„ŒíŠ¸ì˜ **SSRì„ ë¹„í™œì„±í™”**í•˜ê³  ì‹¶ë‹¤ë©´ `{ ssr: false }` ì˜µì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤

```jsx
const ComponentC = dynamic(() => import("../components/C"), { ssr: false });
```

ì´ë ‡ê²Œ ì„¤ì •í•˜ë©´ **í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ëŠ” ì„œë²„ì—ì„œ ë Œë”ë§ë˜ì§€ ì•Šê³ , ì˜¤ì§ í´ë¼ì´ì–¸íŠ¸ì—ì„œë§Œ ë¡œë“œëœë‹¤.**

### ì„œë²„ ì»´í¬ë„ŒíŠ¸ ê°€ì ¸ì˜¤ê¸°

ë§Œì•½ **ì„œë²„ ì»´í¬ë„ŒíŠ¸ë¥¼ ë™ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ë ¤ëŠ” ê²½ìš°**,

ì„œë²„ ì»´í¬ë„ŒíŠ¸ ìì²´ëŠ” Lazy Loadingë˜ì§€ ì•Šìœ¼ë©°,

**ê·¸ í•˜ìœ„ì˜ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ë§Œ Lazy Loadingì´ ì ìš©ëœë‹¤.**

### `app/page.js`

```jsx
import dynamic from "next/dynamic";

// ì„œë²„ ì»´í¬ë„ŒíŠ¸
const ServerComponent = dynamic(() => import("../components/ServerComponent"));

export default function ServerComponentExample() {
  return (
    <div>
      <ServerComponent />
    </div>
  );
}
```

ì´ë ‡ê²Œ í•˜ë©´ ì„œë²„ ì»´í¬ë„ŒíŠ¸ëŠ” ë™ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ì§€ë§Œ, ê·¸ ì•ˆì˜ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ë§Œ ì§€ì—° ë¡œë”©ëœë‹¤.

## 2. ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë™ì  ë¡œë”©

ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” `import()` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ í•„ìš”í•  ë•Œë§Œ ë¡œë“œí•  ìˆ˜ ìˆë‹¤.

ì•„ë˜ ì˜ˆì œì—ì„œëŠ” **Fuse.js(í¼ì§€ ê²€ìƒ‰ ë¼ì´ë¸ŒëŸ¬ë¦¬)**ë¥¼ ë™ì ìœ¼ë¡œ ë¡œë“œí•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤€ë‹¤.

### `app/page.js`

```jsx
"use client";

import { useState } from "react";

const names = ["Tim", "Joe", "Bel", "Lee"];

export default function Page() {
  const [results, setResults] = useState();

  return (
    <div>
      <input
        type="text"
        placeholder="Search"
        onChange={async (e) => {
          const { value } = e.currentTarget;
          // fuse.jsë¥¼ ë™ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
          const Fuse = (await import("fuse.js")).default;
          const fuse = new Fuse(names);

          setResults(fuse.search(value));
        }}
      />
      <pre>Results: {JSON.stringify(results, null, 2)}</pre>
    </div>
  );
}
```

**ìœ„ ì½”ë“œì˜ ë™ì‘ ë°©ì‹**

1. ì‚¬ìš©ìê°€ ê²€ìƒ‰ ì…ë ¥ì„ í•˜ë©´ **ì…ë ¥ ê°’ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ ì´ë²¤íŠ¸ê°€ ì‹¤í–‰ëœë‹¤.**
2. `import('fuse.js')`ë¥¼ ì‚¬ìš©í•˜ì—¬ **Fuse.js ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë™ì ìœ¼ë¡œ ê°€ì ¸ì˜¨ë‹¤.**
3. ê°€ì ¸ì˜¨ Fuse.jsë¥¼ ì‚¬ìš©í•˜ì—¬ ì…ë ¥ê°’ê³¼ ì¼ì¹˜í•˜ëŠ” ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë°˜í™˜í•œë‹¤.
4. í•„ìš”í•œ ê²½ìš°ì—ë§Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¡œë“œí•˜ê¸° ë•Œë¬¸ì— **ë¶ˆí•„ìš”í•œ ë²ˆë“¤ í¬ê¸° ì¦ê°€ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.**

### **3. ì»¤ìŠ¤í…€ ë¡œë”© ì»´í¬ë„ŒíŠ¸ ì¶”ê°€í•˜ê¸°**

ì»´í¬ë„ŒíŠ¸ê°€ ë¡œë”©ë  ë•Œ ì‚¬ìš©ìì—ê²Œ **ë¡œë”© UI**ë¥¼ ë³´ì—¬ì£¼ë ¤ë©´ `loading` ì˜µì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

### `app/page.js`

```jsx
import dynamic from "next/dynamic";

const WithCustomLoading = dynamic(
  () => import("../components/WithCustomLoading"),
  {
    loading: () => <p>Loading...</p>, // ë¡œë”© ì¤‘ì¼ ë•Œ í‘œì‹œí•  UI
  }
);

export default function Page() {
  return (
    <div>
      {/* ì»´í¬ë„ŒíŠ¸ê°€ ë¡œë”©ë  ë•Œ "Loading..."ì´ ë¨¼ì € í‘œì‹œë¨ */}
      <WithCustomLoading />
    </div>
  );
}
```

ì´ë ‡ê²Œ í•˜ë©´ `WithCustomLoading`ì´ **ì™„ì „íˆ ë¡œë“œë  ë•Œê¹Œì§€ "Loading..."ì´ë¼ëŠ” ë¬¸êµ¬ê°€ í‘œì‹œëœë‹¤.**

### **4. Named Export**

ì¼ë°˜ì ìœ¼ë¡œ `import()`ë¥¼ ì‚¬ìš©í•  ë•Œ **ê¸°ë³¸(default) exportë§Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.**

í•˜ì§€ë§Œ **Named Exportë¥¼ ê°€ì ¸ì˜¤ë ¤ë©´ `then(mod => mod.<ExportedFunction>)`ì„ ì‚¬ìš©**í•´ì•¼ í•œë‹¤.

### `components/hello.js`

```jsx
"use client";

export function Hello() {
  return <p>Hello!</p>;
}
```

### `app/page.js`

```jsx
import dynamic from "next/dynamic";

// Named Export ê°€ì ¸ì˜¤ê¸°
const ClientComponent = dynamic(() =>
  import("../components/hello").then((mod) => mod.Hello)
);

export default function Page() {
  return (
    <div>
      <ClientComponent />
    </div>
  );
}
```

ì´ë ‡ê²Œ í•˜ë©´ `Hello`ë¼ëŠ” í•¨ìˆ˜í˜• ì»´í¬ë„ŒíŠ¸ë§Œ **ë™ì ìœ¼ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.**

# Analytics

Next.jsëŠ” **ì›¹ í˜ì´ì§€ì˜ ì„±ëŠ¥ì„ ì¸¡ì •í•˜ê³  ë³´ê³ í•˜ëŠ” ê¸°ëŠ¥ì„ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•œë‹¤**.

ì´ë¥¼ í†µí•´ ì›¹ì‚¬ì´íŠ¸ì˜ ì„±ëŠ¥ì„ ë¶„ì„í•˜ê³  ê°œì„ í•  ìˆ˜ ìˆë‹¤.

**ë‘ ê°€ì§€ ë°©ë²•**ìœ¼ë¡œ ì„±ëŠ¥ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•  ìˆ˜ ìˆë‹¤.

1. **`useReportWebVitals` í›…ì„ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ ê´€ë¦¬**
2. **Vercelì˜ ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ í™œìš© (ìë™ìœ¼ë¡œ ë°ì´í„° ìˆ˜ì§‘ ë° ì‹œê°í™”)**

## **1. ì§ì ‘ ì„±ëŠ¥ ë°ì´í„° ìˆ˜ì§‘í•˜ê¸°**

### **`useReportWebVitals`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„±ëŠ¥ ì§€í‘œ ì¶œë ¥í•˜ê¸°**

ë‹¤ìŒê³¼ ê°™ì´ `useReportWebVitals` í›…ì„ ì‚¬ìš©í•˜ì—¬ **ì›¹ ì„±ëŠ¥ ì§€í‘œ(Web Vitals)ë¥¼ ì¸¡ì •í•˜ê³  ì½˜ì†”ì— ì¶œë ¥**í•  ìˆ˜ ìˆë‹¤.

### `app/_components/web-vitals.js`

```jsx
"use client";

import { useReportWebVitals } from "next/web-vitals";

export function WebVitals() {
  useReportWebVitals((metric) => {
    console.log(metric); // ì¸¡ì •ëœ ì„±ëŠ¥ ë°ì´í„° ì½˜ì†” ì¶œë ¥
  });
}
```

ì´ì œ ìœ„ì—ì„œ ë§Œë“  `WebVitals` ì»´í¬ë„ŒíŠ¸ë¥¼ **ë ˆì´ì•„ì›ƒì— ì¶”ê°€í•œ**ë‹¤.

### `app/layout.js`

```jsx
import { WebVitals } from "./_components/web-vitals";

export default function Layout({ children }) {
  return (
    <html>
      <body>
        <WebVitals />
        {children}
      </body>
    </html>
  );
}
```

---

## **`use client`ë¥¼ ì‚¬ìš©í•œ ì„±ëŠ¥ ìµœì í™”**

- `useReportWebVitals`ëŠ” **í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì—ì„œë§Œ ë™ì‘**í•˜ê¸° ë•Œë¬¸ì— `"use client"` ì§€ì‹œì–´ê°€ í•„ìš”í•˜ë‹¤.
- ë”°ë¼ì„œ ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•´ **í´ë¼ì´ì–¸íŠ¸ ë°”ìš´ë”ë¦¬ë¥¼ `WebVitals` ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ë¡œ í•œì •**í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
  - ì´ë ‡ê²Œ í•˜ë©´ **ë¶ˆí•„ìš”í•œ ë Œë”ë§ì„ ìµœì†Œí™”**í•  ìˆ˜ ìˆë‹¤.

---

## **2. Web Vitals (ì›¹ ì„±ëŠ¥ ì§€í‘œ)**

Web VitalsëŠ” **ì‚¬ìš©ìì˜ ì›¹ í˜ì´ì§€ ê²½í—˜ì„ ì¸¡ì •í•˜ê¸° ìœ„í•œ ì£¼ìš” ì§€í‘œ**ë‹¤.

Next.jsëŠ” **ë‹¤ìŒê³¼ ê°™ì€ ì£¼ìš” ì„±ëŠ¥ ì§€í‘œë¥¼ ìë™ìœ¼ë¡œ ì¸¡ì •**í•œë‹¤.

| ì§€í‘œ                                | ì„¤ëª…                                                       |
| ----------------------------------- | ---------------------------------------------------------- |
| **Time to First Byte (TTFB)**       | ì„œë²„ì—ì„œ ì²˜ìŒ ì‘ë‹µì„ ë°›ì„ ë•Œê¹Œì§€ ê±¸ë¦¬ëŠ” ì‹œê°„               |
| **First Contentful Paint (FCP)**    | ì²« ë²ˆì§¸ ì½˜í…ì¸ (í…ìŠ¤íŠ¸, ì´ë¯¸ì§€ ë“±)ê°€ í™”ë©´ì— ë Œë”ë§ë˜ëŠ” ì‹œê°„ |
| **Largest Contentful Paint (LCP)**  | ê°€ì¥ í° ì½˜í…ì¸ (ì˜ˆ: íˆì–´ë¡œ ì´ë¯¸ì§€)ê°€ í™”ë©´ì— ë Œë”ë§ë˜ëŠ” ì‹œê°„ |
| **First Input Delay (FID)**         | ì‚¬ìš©ìê°€ ì²˜ìŒìœ¼ë¡œ í˜ì´ì§€ì™€ ìƒí˜¸ì‘ìš©í•  ë•Œê¹Œì§€ì˜ ì§€ì—° ì‹œê°„   |
| **Cumulative Layout Shift (CLS)**   | í˜ì´ì§€ ë¡œë“œ ì¤‘ ë°œìƒí•˜ëŠ” ë ˆì´ì•„ì›ƒ ì´ë™ì˜ ì´ëŸ‰               |
| **Interaction to Next Paint (INP)** | ì‚¬ìš©ìì˜ ì¸í„°ë™ì…˜ í›„ ë‹¤ìŒ í™”ë©´ ì—…ë°ì´íŠ¸ê¹Œì§€ ê±¸ë¦¬ëŠ” ì‹œê°„    |

> ğŸ’¡ ëª¨ë“  ì„±ëŠ¥ ì§€í‘œ ê²°ê³¼ëŠ” name ì†ì„±ì„ í†µí•´ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤.

## **3. íŠ¹ì • ì„±ëŠ¥ ì§€í‘œ ì²˜ë¦¬í•˜ê¸° (TypeScript ì˜ˆì œ)**

ì•„ë˜ ì½”ë“œì—ì„œëŠ” `useReportWebVitals`ë¥¼ ì‚¬ìš©í•˜ì—¬ **ê° ì„±ëŠ¥ ì§€í‘œë³„ë¡œ ë‹¤ë¥¸ ì²˜ë¦¬ë¥¼ ì ìš©í•œë‹¤.**

### `app/_components/web-vitals.tsx`

```tsx
"use client";

import { useReportWebVitals } from "next/web-vitals";

export function WebVitals() {
  useReportWebVitals((metric) => {
    switch (metric.name) {
      case "FCP": {
        // FCP ì„±ëŠ¥ ì§€í‘œ ì²˜ë¦¬ ë¡œì§
        console.log("First Contentful Paint:", metric.value);
        break;
      }
      case "LCP": {
        // LCP ì„±ëŠ¥ ì§€í‘œ ì²˜ë¦¬ ë¡œì§
        console.log("Largest Contentful Paint:", metric.value);
        break;
      }
      // ì¶”ê°€ì ì¸ ì„±ëŠ¥ ì§€í‘œ ì²˜ë¦¬ ê°€ëŠ¥
    }
  });
}
```

> ğŸ“Œ íŠ¹ì • ì„±ëŠ¥ ì§€í‘œì— ëŒ€í•œ ê°œë³„ì ì¸ ë¡œì§ì„ ì¶”ê°€í•˜ì—¬ ì›í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ í™œìš©í•  ìˆ˜ ìˆë‹¤.

## **4. ì„±ëŠ¥ ë°ì´í„°ë¥¼ ì™¸ë¶€ ì‹œìŠ¤í…œìœ¼ë¡œ ì „ì†¡í•˜ê¸°**

ì›¹ ì„±ëŠ¥ ë°ì´í„°ë¥¼ ì„œë²„ ë˜ëŠ” ì™¸ë¶€ ì• ë„ë¦¬í‹±ìŠ¤ ì„œë¹„ìŠ¤ë¡œ ì „ì†¡í•  ìˆ˜ ìˆë‹¤.

ì•„ë˜ ì˜ˆì œì—ì„œëŠ” **ì„±ëŠ¥ ë°ì´í„°ë¥¼ íŠ¹ì • ì—”ë“œí¬ì¸íŠ¸ë¡œ ì „ì†¡í•˜ëŠ” ë°©ë²•**ì„ ë³´ì—¬ì¤€ë‹¤.

```jsx
useReportWebVitals((metric) => {
  const body = JSON.stringify(metric);
  const url = "https://example.com/analytics"; // ì„±ëŠ¥ ë°ì´í„°ë¥¼ ì „ì†¡í•  ì—”ë“œí¬ì¸íŠ¸

  // `navigator.sendBeacon()`ì´ ì§€ì›ë˜ë©´ ì´ë¥¼ ì‚¬ìš©í•˜ê³ , ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ `fetch()` ì‚¬ìš©
  if (navigator.sendBeacon) {
    navigator.sendBeacon(url, body);
  } else {
    fetch(url, { body, method: "POST", keepalive: true });
  }
});
```

**ìœ„ ì½”ë“œì˜ ë™ì‘ ë°©ì‹**

1. **ì¸¡ì •ëœ ì„±ëŠ¥ ë°ì´í„°ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ë³€í™˜**
2. **ì„œë²„ë¡œ ì „ì†¡ (`navigator.sendBeacon()` ë˜ëŠ” `fetch()`)**
   - `navigator.sendBeacon(url, body)`ëŠ” **í˜ì´ì§€ê°€ ì–¸ë¡œë“œ(ì´íƒˆ)ë˜ë”ë¼ë„ ìš”ì²­ì„ ë³´ì¥í•œ**ë‹¤.
   - ì§€ì›ë˜ì§€ ì•ŠëŠ” ê²½ìš°, `fetch(url, { method: 'POST', keepalive: true })`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì „ì†¡í•œë‹¤.

## **5. Google Analyticsë¡œ ì„±ëŠ¥ ë°ì´í„° ì „ì†¡í•˜ê¸°**

Google Analyticsë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, **ë©”íŠ¸ë¦­ ë°ì´í„°ë¥¼ `gtag`ë¥¼ í†µí•´ ì „ì†¡í•  ìˆ˜ ìˆë‹¤.**

ì´ë¥¼ í™œìš©í•˜ë©´ **í¼ì„¼íƒ€ì¼(percentile) ê³„ì‚° ë“± ì¶”ê°€ì ì¸ ë¶„ì„ì´ ê°€ëŠ¥í•˜**ë‹¤.

```jsx
useReportWebVitals((metric) => {
  // Google Analyticsì— ë°ì´í„° ì „ì†¡
  window.gtag("event", metric.name, {
    value: Math.round(
      metric.name === "CLS" ? metric.value * 1000 : metric.value
    ), // CLS ê°’ì€ 1000ì„ ê³±í•´ ì •ìˆ˜ ë³€í™˜
    event_label: metric.id, // í˜„ì¬ í˜ì´ì§€ ë¡œë“œì— ëŒ€í•œ ê³ ìœ  ID
    non_interaction: true, // ë°”ìš´ìŠ¤ìœ¨(Bounce Rate)ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šë„ë¡ ì„¤ì •
  });
});
```

**ì£¼ìš” ì„¤ì •**

- `metric.name`: ì–´ë–¤ ì„±ëŠ¥ ì§€í‘œì¸ì§€ (ì˜ˆ: `LCP`, `CLS`, `FID` ë“±)
- `metric.value`: ì¸¡ì •ëœ ì„±ëŠ¥ ê°’
- `metric.id`: í˜„ì¬ í˜ì´ì§€ ë¡œë“œì— ëŒ€í•œ **ê³ ìœ  ID**
- `non_interaction: true`: **ë°”ìš´ìŠ¤ìœ¨(Bounce Rate)ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šë„ë¡ ì„¤ì •**

> ğŸ”— ì°¸ê³ : Google Analyticsë¡œ ì„±ëŠ¥ ë°ì´í„° ë³´ë‚´ê¸°

# Instrumentation

**Instrumentation**ì€ **ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹… ë„êµ¬ë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì— í†µí•©í•˜ëŠ” ê³¼ì •**ì„ ì˜ë¯¸í•œë‹¤.

ì´ ê¸°ëŠ¥ì„ í™œìš©í•˜ë©´ **ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„±ëŠ¥ ë° ë™ì‘ì„ ì¶”ì **í•  ìˆ˜ ìˆìœ¼ë©°, **í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ë””ë²„ê¹…**í•˜ëŠ” ë° ë„ì›€ì„ ë°›ì„ ìˆ˜ ìˆë‹¤.

## **1. Convention (íŒŒì¼ êµ¬ì¡° ë° ì„¤ì •)**

Next.jsì—ì„œ ì¸ìŠ¤íŠ¸ë£¨ë©˜í…Œì´ì…˜ì„ ì„¤ì •í•˜ë ¤ë©´ **í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— `instrumentation.ts` ë˜ëŠ” `instrumentation.js` íŒŒì¼ì„ ìƒì„±**í•´ì•¼ í•œë‹¤.

> ğŸ“Œ ë§Œì•½ src í´ë”ë¥¼ ì‚¬ìš© ì¤‘ì´ë¼ë©´ src í´ë” ì•ˆì— ë°°ì¹˜í•  ìˆ˜ë„ ìˆë‹¤.

ì´ íŒŒì¼ì—ì„œ `register` í•¨ìˆ˜ë¥¼ **export**í•´ì•¼ í•œë‹¤.

ì´ í•¨ìˆ˜ëŠ” **ìƒˆë¡œìš´ Next.js ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ê°€ ì‹œì‘ë  ë•Œ í•œ ë²ˆ ì‹¤í–‰ëœ**ë‹¤.

## **2. OpenTelemetry & Vercel ì„¤ì • ì˜ˆì œ**

ë‹¤ìŒ ì˜ˆì œì—ì„œëŠ” **Next.jsì—ì„œ OpenTelemetryì™€ `@vercel/otel`ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•**ì„ ë³´ì—¬ì¤€ë‹¤.

**`instrumentation.ts` ì˜ˆì œ**

```tsx
import { registerOTel } from "@vercel/otel";

export function register() {
  registerOTel("next-app");
}
```

ìœ„ ì½”ë“œëŠ” **OpenTelemetry(OTel)ë¥¼ ì‚¬ìš©í•˜ì—¬ Next.js ì• í”Œë¦¬ì¼€ì´ì…˜(`next-app`)ì„ ëª¨ë‹ˆí„°ë§**í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•œë‹¤.

ì´ë¥¼ í†µí•´ **ì„œë²„ ì„±ëŠ¥ ë°ì´í„° ë° ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœë¥¼ ì¶”ì í•  ìˆ˜ ìˆë‹¤.**

## **3. ì¤‘ìš”í•œ ì‚¬í•­ (Good to know)**

- ì´ ê¸°ëŠ¥ì€ **ì‹¤í—˜ì (Experimental) ê¸°ëŠ¥**ì´ë¯€ë¡œ, ì‚¬ìš©í•˜ë ¤ë©´ `next.config.js`ì—ì„œ **ëª…ì‹œì ìœ¼ë¡œ í™œì„±í™”í•´ì•¼ í•œë‹¤.**
  **`next.config.js` ì„¤ì •**
  ```jsx
  module.exports = {
    experimental: {
      instrumentationHook: true, // ì¸ìŠ¤íŠ¸ë£¨ë©˜í…Œì´ì…˜ ê¸°ëŠ¥ í™œì„±í™”
    },
  };
  ```
- `instrumentation.ts` íŒŒì¼ì€ ë°˜ë“œì‹œ **í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ìœ„ì¹˜í•´ì•¼ í•œë‹¤.**
  (ì¦‰, `app/` ë˜ëŠ” `pages/` ë””ë ‰í† ë¦¬ ì•ˆì— ë„£ìœ¼ë©´ ì•ˆ ëœë‹¤.)
- **`src` í´ë”ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°**, `instrumentation.ts`ëŠ” `src` í´ë” ë‚´ì—ì„œ `pages` ë° `app` ë””ë ‰í† ë¦¬ì™€ ê°™ì€ ë ˆë²¨ì— ìœ„ì¹˜í•´ì•¼ í•œë‹¤.
- **`pageExtensions` ì„¤ì •ì„ ì‚¬ìš© ì¤‘ì¸ ê²½ìš°**, `instrumentation.ts` íŒŒì¼ëª…ë„ ì´ì— ë§ì¶° ì—…ë°ì´íŠ¸í•´ì•¼ í•œë‹¤.

## **4. Importing files with side effects (ë¶€ìˆ˜ íš¨ê³¼ê°€ ìˆëŠ” íŒŒì¼ ê°€ì ¸ì˜¤ê¸°)**

ë•Œë•Œë¡œ **íŠ¹ì • íŒŒì¼ì„ ê°€ì ¸ì˜¤ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ë¶€ìˆ˜ íš¨ê³¼(side effect)ê°€ ë°œìƒ**í•  ìˆ˜ ìˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, **ì „ì—­ ë³€ìˆ˜ë¥¼ ì •ì˜í•˜ëŠ” íŒŒì¼ì„ ê°€ì ¸ì˜¬ ë•Œ** í•´ë‹¹ íŒŒì¼ì„ ëª…ì‹œì ìœ¼ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šë”ë¼ë„ ì „ì—­ ë³€ìˆ˜ë¥¼ í™œìš©í•  ìˆ˜ ìˆë‹¤.

### **Import ì‚¬ìš© ì˜ˆì œ (`instrumentation.ts`)**

```tsx
export async function register() {
  await import("package-with-side-effect"); // íŠ¹ì • íŒ¨í‚¤ì§€ë¥¼ ë™ì ìœ¼ë¡œ ë¡œë“œ
}
```

## **Best Practice (ê¶Œì¥ ë°©ì‹)**

**íŒŒì¼ì„ ì „ì—­ì—ì„œ importí•˜ì§€ ì•Šê³  `register` í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ì¢‹ë‹¤.**

ì´ë ‡ê²Œ í•˜ë©´ **ë¶€ìˆ˜ íš¨ê³¼ë¥¼ í•œ ê³³ì— ëª¨ì•„ì„œ ê´€ë¦¬**í•  ìˆ˜ ìˆìœ¼ë©°,

**ì „ì—­ importë¡œ ì¸í•´ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì˜ˆìƒì¹˜ ëª»í•œ ë¬¸ì œë¥¼ ë°©ì§€**í•  ìˆ˜ ìˆë‹¤.

## **5. Importing runtime-specific code (íŠ¹ì • ëŸ°íƒ€ì„ í™˜ê²½ë³„ ì½”ë“œ ë¡œë“œ)**

Next.jsëŠ” **ëª¨ë“  í™˜ê²½(Node.js, Edge ë“±)ì—ì„œ `register` í•¨ìˆ˜ë¥¼ í˜¸ì¶œ**í•˜ê¸° ë•Œë¬¸ì—,

íŠ¹ì • ëŸ°íƒ€ì„(Node.js, Edge ë“±)ì—ì„œë§Œ ì‹¤í–‰í•´ì•¼ í•˜ëŠ” ì½”ë“œê°€ ìˆë‹¤ë©´ **ì¡°ê±´ë¶€ë¡œ import**í•´ì•¼ í•œë‹¤.

ì´ë¥¼ ìœ„í•´ **`NEXT_RUNTIME` í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚¬ìš©**í•˜ì—¬ í˜„ì¬ ëŸ°íƒ€ì„ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

### **ëŸ°íƒ€ì„ë³„ ì½”ë“œ ë¡œë“œ (`instrumentation.ts`)**

```tsx
export async function register() {
  if (process.env.NEXT_RUNTIME === "nodejs") {
    await import("./instrumentation-node"); // Node.js í™˜ê²½ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œ
  }

  if (process.env.NEXT_RUNTIME === "edge") {
    await import("./instrumentation-edge"); // Edge í™˜ê²½ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œ
  }
}
```

> ğŸ’¡ ì´ë ‡ê²Œ ì„¤ì •í•˜ë©´ ëŸ°íƒ€ì„ í™˜ê²½ë³„ë¡œ ì ì ˆí•œ ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

# Static Assets

Next.jsëŠ” í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì˜ `public` í´ë”ì— ìˆëŠ” **ì •ì  íŒŒì¼**ì„ ì œê³µí•  ìˆ˜ ìˆë‹¤.

ì´ í´ë”ì— ìˆëŠ” íŒŒì¼ì€ **ê¸°ë³¸ URL(`/`)ì„ ê¸°ì¤€ìœ¼ë¡œ ì ‘ê·¼**í•  ìˆ˜ ìˆë‹¤.

## **1. `public` í´ë”ì—ì„œ ì •ì  íŒŒì¼ ì œê³µ**

ì˜ˆë¥¼ ë“¤ì–´, `public/avatars/me.png` íŒŒì¼ì´ ìˆë‹¤ë©´ **ë¸Œë¼ìš°ì €ì—ì„œ `/avatars/me.png` ê²½ë¡œë¡œ ì ‘ê·¼**í•  ìˆ˜ ìˆë‹¤.

### **ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡°**

```
/public
 â”œâ”€â”€ /avatars
 â”‚    â”œâ”€â”€ me.png
```

### **`avatar.js` ì½”ë“œ**

```jsx
import Image from "next/image";

export function Avatar({ id, alt }) {
  return <Image src={`/avatars/${id}.png`} alt={alt} width="64" height="64" />;
}

export function AvatarOfMe() {
  return <Avatar id="me" alt="A portrait of me" />;
}
```

- `/avatars/me.png` íŒŒì¼ì„ **Next.js `Image` ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•´ í‘œì‹œí•œë‹¤.**
- `Avatar` ì»´í¬ë„ŒíŠ¸ëŠ” `id` ê°’ì„ ë°›ì•„ `src={/avatars/${id}.png}`ë¡œ ë™ì ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ì„¤ì •í•œë‹¤.
- `AvatarOfMe` ì»´í¬ë„ŒíŠ¸ëŠ” `id="me"`ë¥¼ ì „ë‹¬í•˜ì—¬ **`/avatars/me.png` ì´ë¯¸ì§€ë¥¼ í‘œì‹œí•œë‹¤.**

> ğŸ”— ì°¸ê³ : next/imageë¥¼ ì‚¬ìš©í•˜ë©´ ìë™ìœ¼ë¡œ ìµœì í™”(Otimization) ë° Lazy Loading(ì§€ì—° ë¡œë”©) ì ìš©ëœë‹¤.

## **2. Caching (ìºì‹±)**

Next.jsëŠ” **`public` í´ë”ì˜ ì •ì  ìì‚°ì„ ì•ˆì „í•˜ê²Œ ìºì‹œí•  ìˆ˜ ì—†ë‹¤.**

ì´ëŠ” **íŒŒì¼ì´ ë³€ê²½ë  ê°€ëŠ¥ì„±ì´ ìˆê¸° ë•Œë¬¸ì´**ë‹¤.

**Next.jsì˜ ê¸°ë³¸ ìºì‹± í—¤ë”**

```
Cache-Control: public, max-age=0
```

ì´ ì„¤ì •ì€ **ë¸Œë¼ìš°ì € ìºì‹œë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ , í•­ìƒ ìµœì‹  íŒŒì¼ì„ ê°€ì ¸ì˜¤ë„ë¡ ê°•ì œí•œ**ë‹¤.

## **3. Robots, Favicons ë“±ì˜ ì •ì  ë©”íƒ€ë°ì´í„° íŒŒì¼**

- `robots.txt`, `favicon.ico` ë“±ì˜ **ë©”íƒ€ë°ì´í„° íŒŒì¼**ì„ ì‚¬ìš©í•  ê²½ìš°,
  Next.js **`app/` ë””ë ‰í† ë¦¬ ë‚´ì— íŠ¹ë³„í•œ ë©”íƒ€ë°ì´í„° íŒŒì¼ì„ ìƒì„±**í•´ì•¼ í•œë‹¤.

**ì˜ˆì œ: `app/robots.txt`**

```
User-agent: *
Disallow: /private/
```

**ğŸ“Œ ì˜ˆì œ: `app/favicon.ico`**

- ë¸Œë¼ìš°ì €ì—ì„œ **`/favicon.ico`** ê²½ë¡œë¡œ ìë™ ì ‘ê·¼ëœë‹¤.

> ğŸ’¡ public í´ë”ì— ë°°ì¹˜í•´ë„ ì ‘ê·¼ ê°€ëŠ¥í•˜ì§€ë§Œ, Next.jsì—ì„œëŠ” app/ í´ë”ì—ì„œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ë” ê¶Œì¥ëœë‹¤.

## **Good to Know**

### **`public` í´ë” ê´€ë ¨ ê·œì¹™**

- `public` í´ë”ì˜ ì´ë¦„ì€ **ë³€ê²½í•  ìˆ˜ ì—†ë‹¤.**
- **Next.jsê°€ ì •ì  íŒŒì¼ì„ ì œê³µí•  ìˆ˜ ìˆëŠ” ìœ ì¼í•œ í´ë”ëŠ” `public` ì´ë‹¤.**
- **ë¹Œë“œ ì‹œì (Build Time)**ì— `public` í´ë”ì— ìˆëŠ” íŒŒì¼ë§Œ ì œê³µëœë‹¤.
- **ìš”ì²­(Request) ì‹œì ì— ì¶”ê°€ëœ íŒŒì¼ì€ ì œê³µë˜ì§€ ì•ŠëŠ”ë‹¤.**
- **íŒŒì¼ì„ ì§€ì†ì ìœ¼ë¡œ ì €ì¥í•˜ë ¤ë©´ Vercel Blob ê°™ì€ ì™¸ë¶€ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.**

> ğŸ’¡ ìš”ì²­ í›„ ë™ì ìœ¼ë¡œ íŒŒì¼ì„ ì¶”ê°€í•´ì•¼ í•˜ëŠ” ê²½ìš°ì—ëŠ” public ëŒ€ì‹  S3, Cloudinary, Vercel Blob ê°™ì€ ì™¸ë¶€ ì €ì¥ì†Œë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥ëœë‹¤.

# Third Party Libraries

`@next/third-parties`ëŠ” **Next.js ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì¸ê¸° ìˆëŠ” ì„œë“œíŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‰½ê²Œ í†µí•©**í•  ìˆ˜ ìˆë„ë¡ ì œê³µë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.

ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” **ì„±ëŠ¥ ìµœì í™” ë° ê°œë°œì ê²½í—˜ ê°œì„ ì„ ìœ„í•´ ìµœì í™”**ë˜ì–´ ìˆë‹¤.

## **1. ì„¤ì¹˜ ë° ì‹œì‘í•˜ê¸°**

```
npm install @next/third-parties@latest next@latest
```

í˜„ì¬ **ì‹¤í—˜ì (Experimental) ë¼ì´ë¸ŒëŸ¬ë¦¬**ì´ë¯€ë¡œ **ìµœì‹ (`latest`) ë˜ëŠ” `canary` ë²„ì „ìœ¼ë¡œ ì„¤ì¹˜í•  ê²ƒì„ ê¶Œì¥**

## **2. Google ê´€ë ¨ ì„œë“œíŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬**

`@next/third-parties/google`ì—ì„œ Googleê³¼ ê´€ë ¨ëœ ëª¨ë“  í†µí•© ê¸°ëŠ¥ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

### **2.1 Google Tag Manager (GTM)**

### **Google Tag Managerë€?**

Google Tag Manager(GTM)ëŠ” **ì›¹ì‚¬ì´íŠ¸ì—ì„œ ë‹¤ì–‘í•œ íŠ¸ë˜í‚¹ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‰½ê²Œ ê´€ë¦¬**í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ë„êµ¬ë‹¤.

`@next/third-parties/google`ì„ ì‚¬ìš©í•˜ë©´ **ìë™ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”ëœ ë°©ì‹ìœ¼ë¡œ GTMì„ ë¡œë“œ**í•  ìˆ˜ ìˆë‹¤.

### **GTM ì„¤ì • (ëª¨ë“  ë¼ìš°íŠ¸ì— ì ìš©)**

`app/layout.tsx`ì—ì„œ GTMì„ ì¶”ê°€í•˜ì—¬ **ëª¨ë“  í˜ì´ì§€ì—ì„œ GTMì„ ì‹¤í–‰**í•  ìˆ˜ ìˆë‹¤.

```tsx
import { GoogleTagManager } from "@next/third-parties/google";

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <GoogleTagManager gtmId="GTM-XYZ" />
      <body>{children}</body>
    </html>
  );
}
```

- `GoogleTagManager` ì»´í¬ë„ŒíŠ¸ë¥¼ `layout.tsx`ì— ì¶”ê°€í•˜ì—¬ **ëª¨ë“  í˜ì´ì§€ì—ì„œ GTMì´ ì‹¤í–‰**ë˜ë„ë¡ ì„¤ì •í•œë‹¤.
- `gtmId="GTM-XYZ"` ë¶€ë¶„ì„ **ì‹¤ì œ GTM ì»¨í…Œì´ë„ˆ IDë¡œ ë³€ê²½**í•´ì•¼ í•œë‹¤.

### **íŠ¹ì • í˜ì´ì§€ì—ì„œë§Œ GTM ì ìš©**

GTMì„ **íŠ¹ì • í˜ì´ì§€ì—ì„œë§Œ ì‹¤í–‰**í•˜ê³  ì‹¶ë‹¤ë©´, í•´ë‹¹ í˜ì´ì§€ì—ì„œ ì§ì ‘ `GoogleTagManager`ë¥¼ í˜¸ì¶œí•˜ë©´ ëœë‹¤.

```jsx
import { GoogleTagManager } from "@next/third-parties/google";

export default function Page() {
  return <GoogleTagManager gtmId="GTM-XYZ" />;
}
```

### **ì´ë²¤íŠ¸ ì „ì†¡ (ì‚¬ìš©ì í–‰ë™ ì¶”ì )**

GTMì„ í†µí•´ **ì‚¬ìš©ì ì´ë²¤íŠ¸(ì˜ˆ: ë²„íŠ¼ í´ë¦­)ë¥¼ ì „ì†¡**í•  ìˆ˜ ìˆë‹¤.

```jsx
"use client";

import { sendGTMEvent } from "@next/third-parties/google";

export function EventButton() {
  return (
    <div>
      <button
        onClick={() => sendGTMEvent({ event: "buttonClicked", value: "xyz" })}
      >
        Send Event
      </button>
    </div>
  );
}
```

- `sendGTMEvent()`ë¥¼ ì‚¬ìš©í•˜ì—¬ **GTMì˜ `dataLayer`ì— ì´ë²¤íŠ¸ë¥¼ ì „ì†¡í•œ**ë‹¤.
- ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ `{ event: 'buttonClicked', value: 'xyz' }` ì´ë²¤íŠ¸ê°€ GTMì— ì „ë‹¬ëœë‹¤.

## **2.2 Google Analytics (GA4)**

### **Google Analyticsë€?**

Google AnalyticsëŠ” **ì›¹ì‚¬ì´íŠ¸ ë°©ë¬¸ì ìˆ˜, ì‚¬ìš©ì í–‰ë™, ì´ë²¤íŠ¸ ë“±ì„ ì¸¡ì •í•  ìˆ˜ ìˆëŠ” ë„êµ¬ì´ë‹¤.**

> ğŸ“Œ ì°¸ê³ : Google Tag Manager(GTM)ë¥¼ ì´ë¯¸ ì‚¬ìš©í•˜ê³  ìˆë‹¤ë©´, GAë¥¼ ë³„ë„ë¡œ ì¶”ê°€í•  í•„ìš” ì—†ì´ GTMì—ì„œ ì„¤ì •í•˜ëŠ” ê²ƒì´ ë” íš¨ìœ¨ì ì´ë‹¤.

### **GA ì„¤ì • (ëª¨ë“  ë¼ìš°íŠ¸ì— ì ìš©)**

`app/layout.tsx`ì—ì„œ **GA4ë¥¼ ì „ì—­ì ìœ¼ë¡œ ì‹¤í–‰**í•  ìˆ˜ ìˆë‹¤.

```tsx
import { GoogleAnalytics } from "@next/third-parties/google";

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body>{children}</body>
      <GoogleAnalytics gaId="G-XYZ" />
    </html>
  );
}
```

- `GoogleAnalytics` ì»´í¬ë„ŒíŠ¸ë¥¼ `layout.tsx`ì— ì¶”ê°€í•˜ì—¬ **ëª¨ë“  í˜ì´ì§€ì—ì„œ GAê°€ ì‹¤í–‰**ë˜ë„ë¡ ì„¤ì •í•œë‹¤.
- `gaId="G-XYZ"` ë¶€ë¶„ì„ **ì‹¤ì œ GA ì¸¡ì • IDë¡œ ë³€ê²½**í•´ì•¼ í•œë‹¤.

### **íŠ¹ì • í˜ì´ì§€ì—ì„œë§Œ GA ì ìš©**

GAë¥¼ **íŠ¹ì • í˜ì´ì§€ì—ì„œë§Œ ì‹¤í–‰**í•˜ê³  ì‹¶ë‹¤ë©´, í•´ë‹¹ í˜ì´ì§€ì—ì„œ ì§ì ‘ `GoogleAnalytics`ë¥¼ í˜¸ì¶œí•˜ë©´ ëœë‹¤.

```jsx
import { GoogleAnalytics } from "@next/third-parties/google";

export default function Page() {
  return <GoogleAnalytics gaId="G-XYZ" />;
}
```

---

### **ì´ë²¤íŠ¸ ì „ì†¡ (ì‚¬ìš©ì í–‰ë™ ì¶”ì )**

GAë¥¼ í†µí•´ **ì‚¬ìš©ì ì´ë²¤íŠ¸(ì˜ˆ: ë²„íŠ¼ í´ë¦­)ë¥¼ ì „ì†¡**í•  ìˆ˜ ìˆë‹¤.

```jsx
"use client";

import { sendGAEvent } from "@next/third-parties/google";

export function EventButton() {
  return (
    <div>
      <button
        onClick={() => sendGAEvent({ event: "buttonClicked", value: "xyz" })}
      >
        Send Event
      </button>
    </div>
  );
}
```

- `sendGAEvent()`ë¥¼ ì‚¬ìš©í•˜ì—¬ **GAì— ì‚¬ìš©ì ì´ë²¤íŠ¸ë¥¼ ê¸°ë¡**
- ë²„íŠ¼ í´ë¦­ ì‹œ `{ event: 'buttonClicked', value: 'xyz' }` ì´ë²¤íŠ¸ê°€ GAì— ì „ë‹¬

## **2.3 Google Maps Embed**

Google ì§€ë„(`Google Maps Embed`)ë¥¼ ì‰½ê²Œ ì‚½ì…í•  ìˆ˜ ìˆë‹¤.

### **Google Maps ì¶”ê°€ ì˜ˆì œ**

```jsx
import { GoogleMapsEmbed } from "@next/third-parties/google";

export default function Page() {
  return (
    <GoogleMapsEmbed
      apiKey="XYZ"
      height={200}
      width="100%"
      mode="place"
      q="Brooklyn+Bridge,New+York,NY"
    />
  );
}
```

- `GoogleMapsEmbed` ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ **Google ì§€ë„ ì‚½ì…**
- `apiKey="XYZ"` â†’ **Google Maps API í‚¤ ì…ë ¥**
- `q="Brooklyn+Bridge,New+York,NY"` â†’ **ì§€ë„ì—ì„œ íŠ¹ì • ìœ„ì¹˜ í‘œì‹œ**

## **2.4 YouTube Embed**

YouTube ì˜ìƒì„ ë” ë¹ ë¥´ê²Œ ë¡œë“œí•  ìˆ˜ ìˆë„ë¡ ìµœì í™”ëœ `YouTubeEmbed`ë¥¼ ì œê³µí•œë‹¤.

### **YouTube ë™ì˜ìƒ ì¶”ê°€ ì˜ˆì œ**

```jsx
import { YouTubeEmbed } from "@next/third-parties/google";

export default function Page() {
  return (
    <YouTubeEmbed videoid="ogfYd705cRs" height={400} params="controls=0" />
  );
}
```

- `videoid="ogfYd705cRs"` â†’ **YouTube ë™ì˜ìƒì˜ ID ì…ë ¥**
- `height={400}` â†’ **ë™ì˜ìƒ ë†’ì´ ì„¤ì •**
- `params="controls=0"` â†’ **ì˜ìƒ í”Œë ˆì´ì–´ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ ìˆ¨ê¹€**

| ê¸°ëŠ¥                   | ì„¤ëª…                                                            |
| ---------------------- | --------------------------------------------------------------- |
| **Google Tag Manager** | ì›¹ì‚¬ì´íŠ¸ì—ì„œ ë‹¤ì–‘í•œ íŠ¸ë˜í‚¹ ìŠ¤í¬ë¦½íŠ¸(GA, Facebook Pixel ë“±) ê´€ë¦¬ |
| **Google Analytics**   | ë°©ë¬¸ì ìˆ˜, ì‚¬ìš©ì í–‰ë™ ë¶„ì„                                     |
| **Google Maps Embed**  | Google ì§€ë„ ì‚½ì… ë° ìœ„ì¹˜ í‘œì‹œ                                   |
| **YouTube Embed**      | YouTube ë™ì˜ìƒì„ ìµœì í™”ëœ ë°©ì‹ìœ¼ë¡œ ì‚½ì…                         |

# Memory Usage

Next.js ì• í”Œë¦¬ì¼€ì´ì…˜ì´ **ì ì  ì»¤ì§€ê³  ê¸°ëŠ¥ì´ ë§ì•„ì§ˆìˆ˜ë¡**,

ë¡œì»¬ ê°œë°œ í™˜ê²½ì´ë‚˜ **í”„ë¡œë•ì…˜ ë¹Œë“œ ì‹œ ë” ë§ì€ ë©”ëª¨ë¦¬**ë¥¼ ìš”êµ¬í•  ìˆ˜ ìˆë‹¤.

## **1. ì˜ì¡´ì„±(Dependencies) ì¤„ì´ê¸°**

ì• í”Œë¦¬ì¼€ì´ì…˜ì— **ì˜ì¡´ì„±ì´ ë§ì•„ì§ˆìˆ˜ë¡ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ë„ ì¦ê°€í•œ**ë‹¤.

### **í•´ê²° ë°©ë²•**

- **Bundle Analyzer(`@next/bundle-analyzer`)ë¥¼ ì‚¬ìš©**í•˜ì—¬ í° ì˜ì¡´ì„±ì„ ì°¾ì•„ ì œê±°
- í•„ìš” ì—†ëŠ” **ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì œê±°í•˜ê±°ë‚˜ ë” ê°€ë²¼ìš´ ëŒ€ì²´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©**

## **2. ë¹Œë“œ ì‹œ ë©”ëª¨ë¦¬ ì‚¬ìš© ë””ë²„ê¹…**

Next.js `v14.2.0`ë¶€í„° **ë¹Œë“œ ê³¼ì •ì—ì„œ ì‹¤ì‹œê°„ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì¶œë ¥**í•  ìˆ˜ ìˆë‹¤.

```
next build --experimental-debug-memory-usage
```

**ì‹¤í–‰ ê²°ê³¼**

- **í™(Heap) ì‚¬ìš©ëŸ‰** ë° **Garbage Collection(GC) í†µê³„ ì¶œë ¥**
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ **ì„¤ì •ëœ ì œí•œì— ê·¼ì ‘í•˜ë©´ ìë™ìœ¼ë¡œ Heap ìŠ¤ëƒ…ìƒ· ìƒì„±**

**âš ï¸ ì£¼ì˜:**

ì´ ê¸°ëŠ¥ì€ **Webpack Build Worker ì˜µì…˜ê³¼ í˜¸í™˜ë˜ì§€ ì•ŠëŠ”ë‹¤**.

(ì‚¬ìš©ì ì •ì˜ Webpack ì„¤ì •ì´ ì—†ì„ ê²½ìš°, ê¸°ë³¸ì ìœ¼ë¡œ Webpack Build Workerê°€ í™œì„±í™”ë¨)

## **3. Heap Profile ê¸°ë¡í•˜ê¸° (ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë¶„ì„)**

### **Heap Profile ìƒì„± ëª…ë ¹ì–´**

```
node --heap-prof node_modules/next/dist/bin/next build
```

**ì‹¤í–‰ ê²°ê³¼**

- ë¹Œë“œ ì™„ë£Œ í›„, **`.heapprofile` íŒŒì¼ì´ ìƒì„±ë¨**
- Chrome DevToolsì—ì„œ **Memory íƒ­ â†’ "Load Profile" í´ë¦­**í•˜ì—¬ ë¶„ì„ ê°€ëŠ¥

## **4. Heap Snapshot ë¶„ì„í•˜ê¸° (ë©”ëª¨ë¦¬ ì ìœ  í™•ì¸)**

### **`next build` ë˜ëŠ” `next dev` ì‹¤í–‰ ì‹œ Inspector ëª¨ë“œ í™œì„±í™”**

```
NODE_OPTIONS=--inspect next build
```

**ì‹¤í–‰ ê²°ê³¼**

- Chrome DevToolsë¡œ **ë””ë²„ê¹… í¬íŠ¸ì— ì—°ê²° í›„ Heap ìŠ¤ëƒ…ìƒ· ë¶„ì„ ê°€ëŠ¥**

**ë””ë²„ê¹… í¬íŠ¸ì— ì—°ê²°í•˜ëŠ” ë°©ë²•**

1. Chromeì—ì„œ `chrome://inspect` ì´ë™
2. "Remote Target"ì—ì„œ Next.js í”„ë¡œì„¸ìŠ¤ ì„ íƒ
3. **Memory íƒ­ â†’ "Take Snapshot"** í´ë¦­í•˜ì—¬ ë¶„ì„

> ğŸ“Œ --inspect-brk ì˜µì…˜ ì‚¬ìš© ì‹œ, ì‚¬ìš©ì ì½”ë“œ ì‹¤í–‰ ì „ ì¤‘ë‹¨ ê°€ëŠ¥

```
NODE_OPTIONS=--inspect-brk next build
```

**ğŸ“Œ Next.js `v14.2.0` ì´ìƒì—ì„œëŠ” `SIGUSR2` ì‹ í˜¸ë¥¼ ë³´ë‚´ Heap Snapshot ì €ì¥ ê°€ëŠ¥**

```
kill -USR2 <Next.js í”„ë¡œì„¸ìŠ¤ ID>
```

- ì €ì¥ëœ Heap Snapshot íŒŒì¼ì€ **í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ì €ì¥ë¨**
- Chrome DevToolsì—ì„œ **ë¶ˆí•„ìš”í•˜ê²Œ ìœ ì§€ë˜ëŠ” ë©”ëª¨ë¦¬ ê°ì²´ í™•ì¸ ê°€ëŠ¥**

## **5. Webpack Build Worker ì‚¬ìš©**

Next.js `v14.1.0`ë¶€í„° **Webpack Build Workerê°€ ê¸°ë³¸ í™œì„±í™”**ë˜ì–´,

Webpack ë¹Œë“œë¥¼ ë³„ë„ì˜ Node.js ì›Œì»¤ì—ì„œ ì‹¤í–‰í•˜ì—¬ **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì¤„ì¼ ìˆ˜ ìˆë‹¤**.

**Webpack Build Worker ìˆ˜ë™ í™œì„±í™” ë°©ë²•**
(ì‚¬ìš©ì ì •ì˜ Webpack ì„¤ì •ì„ ì‚¬ìš© ì¤‘ì¼ ê²½ìš°)

```jsx
// next.config.js
module.exports = {
  experimental: {
    webpackBuildWorker: true, // Webpack ë¹Œë“œ ì›Œì»¤ í™œì„±í™”
  },
};
```

**âš ï¸ ì£¼ì˜:**

ì¼ë¶€ **ì»¤ìŠ¤í…€ Webpack í”ŒëŸ¬ê·¸ì¸ê³¼ í˜¸í™˜ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ**.

## **6. Webpack ìºì‹œ ë¹„í™œì„±í™” (ë©”ëª¨ë¦¬ ì ˆì•½)**

Webpack ìºì‹œëŠ” **ë¹Œë“œ ì†ë„ë¥¼ í–¥ìƒ**ì‹œí‚¤ì§€ë§Œ, **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ë„ ì¦ê°€**ì‹œí‚¨ë‹¤.

### **Webpack ìºì‹œ ë¹„í™œì„±í™” ì˜ˆì œ**

```jsx
// next.config.mjs
/** @type {import('next').NextConfig} */
const nextConfig = {
  webpack: (
    config,
    { buildId, dev, isServer, defaultLoaders, nextRuntime, webpack }
  ) => {
    if (config.cache && !dev) {
      config.cache = Object.freeze({
        type: "memory",
      });
    }
    return config;
  },
};

export default nextConfig;
```

**ìœ„ ì„¤ì • ì ìš© ì‹œ**

- **ê°œë°œ ëª¨ë“œ(dev)ì—ì„œëŠ” Webpack ìºì‹œ ì‚¬ìš©** (ì†ë„ ìœ ì§€)
- **í”„ë¡œë•ì…˜ ë¹Œë“œ ì‹œ Webpack ìºì‹œ ë¹„í™œì„±í™”** (ë©”ëª¨ë¦¬ ì ˆì•½)

## **7. Source Map ë¹„í™œì„±í™” (ë¹Œë“œ ë©”ëª¨ë¦¬ ì ˆì•½)**

Source Mapì€ **ë””ë²„ê¹…ì— ìœ ìš©í•˜ì§€ë§Œ, ì¶”ê°€ì ì¸ ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•œ**ë‹¤.

### **Source Map ë¹„í™œì„±í™” ì„¤ì •**

```jsx
// next.config.js
module.exports = {
  productionBrowserSourceMaps: false, // ë¸Œë¼ìš°ì €ìš© Source Map ë¹„í™œì„±í™”
  experimental: {
    serverSourceMaps: false, // ì„œë²„ìš© Source Map ë¹„í™œì„±í™”
  },
};
```

**ì ìš© íš¨ê³¼**

- **ë¹Œë“œ ê³¼ì •ì—ì„œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê°ì†Œ**
- **ë¹Œë“œ ì†ë„ í–¥ìƒ**

> âš ï¸ ì£¼ì˜: ì¼ë¶€ Webpack í”ŒëŸ¬ê·¸ì¸ì€ ìë™ìœ¼ë¡œ Source Mapì„ í™œì„±í™”í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ
>
> **ì¶”ê°€ ì„¤ì •ì´ í•„ìš”í•  ìˆ˜ë„ ìˆìŒ**.

## **8. Edge ëŸ°íƒ€ì„ ë©”ëª¨ë¦¬ ë¬¸ì œ í•´ê²°**

Next.js **v14.1.3ì—ì„œ Edge ëŸ°íƒ€ì„ ë©”ëª¨ë¦¬ ë¬¸ì œë¥¼ ìˆ˜ì •**í•˜ì˜€ë‹¤.

**í•´ê²° ë°©ë²•**

- **Next.jsë¥¼ ìµœì‹  ë²„ì „(`v14.1.3` ì´ìƒ)ìœ¼ë¡œ ì—…ë°ì´íŠ¸**

```
npm update next
```

**ì—…ë°ì´íŠ¸ í›„ì—ë„ ë¬¸ì œê°€ ë°œìƒí•˜ë©´ `node` ëŸ°íƒ€ì„ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒë„ ê³ ë ¤ ê°€ëŠ¥**

## **ì •ë¦¬**

| **ë¬¸ì œ**                         | **í•´ê²° ë°©ë²•**                                                        |
| -------------------------------- | -------------------------------------------------------------------- |
| **ì˜ì¡´ì„± ë§ìŒ**                  | `@next/bundle-analyzer` ì‚¬ìš©í•˜ì—¬ ë¶ˆí•„ìš”í•œ íŒ¨í‚¤ì§€ ì œê±°                |
| **ë¹Œë“œ ì‹œ ë©”ëª¨ë¦¬ ê³¼ë¶€í•˜**        | `next build --experimental-debug-memory-usage` ì‹¤í–‰í•˜ì—¬ ë¶„ì„         |
| **ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ íƒìƒ‰**             | `node --heap-prof next build` ì‹¤í–‰ í›„ Chrome DevToolsë¡œ ë¶„ì„         |
| **Heap Snapshot ì €ì¥**           | `NODE_OPTIONS=--inspect next build` ì‹¤í–‰ í›„ Chrome DevToolsì—ì„œ í™•ì¸ |
| **Webpack Build Worker í™œì„±í™”**  | `experimental.webpackBuildWorker: true` ì„¤ì •                         |
| **Webpack ìºì‹œ ë¹„í™œì„±í™”**        | `next.config.js`ì—ì„œ `config.cache = { type: 'memory' }` ì„¤ì •        |
| **Source Map ë¹„í™œì„±í™”**          | `productionBrowserSourceMaps: false` ì„¤ì •                            |
| **Edge ëŸ°íƒ€ì„ ë©”ëª¨ë¦¬ ë¬¸ì œ í•´ê²°** | Next.js `v14.1.3` ì´ìƒìœ¼ë¡œ ì—…ë°ì´íŠ¸                                  |
